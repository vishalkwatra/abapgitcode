sap.ui.define([                                                                                                                                                                                                                                                
	"./BaseController",                                                                                                                                                                                                                                           
	"sap/ui/model/json/JSONModel",                                                                                                                                                                                                                                
	"sap/m/MessageToast",                                                                                                                                                                                                                                         
	"sap/m/MessageBox",                                                                                                                                                                                                                                           
	"sap/ui/model/Filter",                                                                                                                                                                                                                                        
	"sap/ui/model/FilterOperator",                                                                                                                                                                                                                                
	"../model/formatter",                                                                                                                                                                                                                                         
	"sap/ui/core/routing/History",                                                                                                                                                                                                                                
	"sap/ui/generic/app/navigation/service/NavigationHandler"                                                                                                                                                                                                     
], function (BaseController, JSONModel, MessageToast, MessageBox, Filter, FilterOperator, formatter, History, NavigationHandler) {                                                                                                                             
	"use strict";                                                                                                                                                                                                                                                 
	let oSapUiCore = sap.ui.getCore();                                                                                                                                                                                                                            
	const sOriginal = "Original",                                                                                                                                                                                                                                 
		sCreate = "Create",                                                                                                                                                                                                                                          
		sUpdate = "Update";                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
	return BaseController.extend("ey.sap.fin.cs.managetiers.controller.Tiers", {                                                                                                                                                                                  
		formatter: formatter,                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		onInit: function () {                                                                                                                                                                                                                                        
			let oView = this.getView(),                                                                                                                                                                                                                                 
				//model for edit mode view                                                                                                                                                                                                                                 
				oModel = new JSONModel({                                                                                                                                                                                                                                   
					"edit": false                                                                                                                                                                                                                                             
				}),                                                                                                                                                                                                                                                        
				//model for delete flag logic                                                                                                                                                                                                                              
				oModelDelete = new JSONModel(),                                                                                                                                                                                                                            
				//model to display response msgs of batch calls                                                                                                                                                                                                            
				oModelMsgPopover = new JSONModel();                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			//intialize navigation handler                                                                                                                                                                                                                              
			this.oNavigationHandler = new NavigationHandler(this);                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
			// Defaulting Table Header                                                                                                                                                                                                                                  
			oView.byId("idHeadText").setText(this.getResourceBundle().getText("tiersTableTitle", [0]));                                                                                                                                                                 
                                                                                                                                                                                                                                                               
			oView.setModel(oModel, "editTierModel");                                                                                                                                                                                                                    
			oView.setModel(oModelDelete, "deleteModel");                                                                                                                                                                                                                
			oView.setModel(oModelMsgPopover, "message");                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			//inialize message popover                                                                                                                                                                                                                                  
			if (!this.oMessagePopover) {                                                                                                                                                                                                                                
				this.oMessagePopover = sap.ui.xmlfragment("ey.sap.fin.cs.managetiers.fragment.MessagePopover", this);                                                                                                                                                      
				this.oView.addDependent(this.oMessagePopover);                                                                                                                                                                                                             
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			// Type - Boolean --> Flag to check if SAVE is allowed.                                                                                                                                                                                                     
			this.bAllEntriesValidated = true;                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			//initialize router                                                                                                                                                                                                                                         
			this.oRouter = this.getOwnerComponent().getRouter();                                                                                                                                                                                                        
			this.oRouter.getRoute("TargetTiers").attachMatched(this._onRouteMatched, this);                                                                                                                                                                             
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* internal methods  -PRIVATE                                  */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		_onRouteMatched: function (oEvent) {                                                                                                                                                                                                                         
			let that = this,                                                                                                                                                                                                                                            
				oView = this.getView(),                                                                                                                                                                                                                                    
				bPressGO = false;                                                                                                                                                                                                                                          
			// Attching back button event                                                                                                                                                                                                                               
			this.getOwnerComponent().getService("ShellUIService").then(function (oShellService) {                                                                                                                                                                       
				oShellService.setBackNavigation(that._onPressShellNavBack.bind(that));                                                                                                                                                                                     
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			//handling startup parameters using navigation handler                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
			var oParseNavigationPromise = this.oNavigationHandler.parseNavigation();                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
			oParseNavigationPromise.done(function (oAppData, oURLParameters, sNavType) {                                                                                                                                                                                
				if (sNavType !== sap.ui.generic.app.navigation.service.NavType.initial) {                                                                                                                                                                                  
					if (oURLParameters.Country && oURLParameters.Country[0]) {                                                                                                                                                                                                
						oView.byId("idFilterCountryCode").setSelectedKey(oURLParameters.Country);                                                                                                                                                                                
						bPressGO = true;                                                                                                                                                                                                                                         
					} else {                                                                                                                                                                                                                                                  
						bPressGO = false;                                                                                                                                                                                                                                        
					}                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
					if (oURLParameters.FiscalYear && oURLParameters.FiscalYear[0]) {                                                                                                                                                                                          
						oView.byId("idFilterFiscalYear").setValue(oURLParameters.FiscalYear);                                                                                                                                                                                    
						bPressGO = true;                                                                                                                                                                                                                                         
					} else {                                                                                                                                                                                                                                                  
						bPressGO = false;                                                                                                                                                                                                                                        
					}                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
					if (oURLParameters.Intention && oURLParameters.Intention[0]) {                                                                                                                                                                                            
						let aParam = [oURLParameters.Country, oURLParameters.FiscalYear];                                                                                                                                                                                        
						that._fetchIntentionStatus(aParam);                                                                                                                                                                                                                      
						oView.byId("idIntentionComboBox").setSelectedKey(oURLParameters.Intention);                                                                                                                                                                              
						bPressGO = true;                                                                                                                                                                                                                                         
					} else {                                                                                                                                                                                                                                                  
						bPressGO = false;                                                                                                                                                                                                                                        
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
				if (bPressGO) {                                                                                                                                                                                                                                            
					that._fetchTiersData();                                                                                                                                                                                                                                   
					//that.getView().byId("idOverflowToolbar").setVisible(true);                                                                                                                                                                                              
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			oParseNavigationPromise.fail(jQuery.proxy(function (oError, oURLParameters, sNavType) {                                                                                                                                                                     
				// if e.g. the xapp state could not be loaded, nevertheless there may be URL parameters available                                                                                                                                                          
				MessageBox.error(that.getI18nText("navigationError"));                                                                                                                                                                                                     
			}, this));                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			//this._fetchIntentionData();                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			// var startupParams = this.getOwnerComponent().getComponentData().startupParameters; // get Startup params from Owner Component                                                                                                                            
			// if (startupParams.Country && startupParams.Country[0]) {                                                                                                                                                                                                 
			// 	oView.byId("idFilterCountryCode").setSelectedKey(startupParams.Country);                                                                                                                                                                                
			// 	bPressGO = true;                                                                                                                                                                                                                                        
			// } else {                                                                                                                                                                                                                                                 
			// 	bPressGO = false;                                                                                                                                                                                                                                       
			// }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			// if (startupParams.FiscalYear && startupParams.FiscalYear[0]) {                                                                                                                                                                                           
			// 	oView.byId("idFilterFiscalYear").setValue(startupParams.FiscalYear);                                                                                                                                                                                    
			// 	bPressGO = true;                                                                                                                                                                                                                                        
			// } else {                                                                                                                                                                                                                                                 
			// 	bPressGO = false;                                                                                                                                                                                                                                       
			// }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/*	_fetchIntentionData: function () {                                                                                                                                                                                                                        
				let oServiceCallModel = this.getModel(),                                                                                                                                                                                                                   
					sServiceURL = "/xEY1xSAV_C_ReadIntentVH",                                                                                                                                                                                                                 
					that = this;                                                                                                                                                                                                                                              
				this.getBusyDialog().open();                                                                                                                                                                                                                               
				oServiceCallModel.read(sServiceURL, {                                                                                                                                                                                                                      
					method: "GET",                                                                                                                                                                                                                                            
					sorters: [                                                                                                                                                                                                                                                
						new sap.ui.model.Sorter("SerialNumber")                                                                                                                                                                                                                  
					],                                                                                                                                                                                                                                                        
					success: function (oData, oResponse) {                                                                                                                                                                                                                    
						that.getBusyDialog().close();                                                                                                                                                                                                                            
						oData.results.splice(oData.results.map(item => item.Intent).indexOf("PER"), 1);                                                                                                                                                                          
						let oModel = new JSONModel(oData);                                                                                                                                                                                                                       
						that.getView().setModel(oModel, "intentionVHModel");                                                                                                                                                                                                     
					},                                                                                                                                                                                                                                                        
					error: function (oError) {                                                                                                                                                                                                                                
						that.getBusyDialog().close();                                                                                                                                                                                                                            
						MessageToast.show(that.getI18nText("errorFetchingIntentions"));                                                                                                                                                                                          
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			},*/                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		_fetchIntentionStatus: function (aParam) {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
			let oServiceCallModel = this.getModel();                                                                                                                                                                                                                    
			let sBunit = aParam[0],                                                                                                                                                                                                                                     
				sYear = aParam[1],                                                                                                                                                                                                                                         
				sServiceURL = "/xEY1xSAV_C_IntentionsStatus(p_bunit='" + sBunit + "')/Set",                                                                                                                                                                                
				oFilter = new Filter("Gjahr", FilterOperator.EQ, sYear),                                                                                                                                                                                                   
				that = this;                                                                                                                                                                                                                                               
			//	oView = that.getView(),                                                                                                                                                                                                                                  
			//oIntentionCtrl = oView.byId("idIntentionComboBox");                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			this.getBusyDialog().open();                                                                                                                                                                                                                                
			oServiceCallModel.read(sServiceURL, {                                                                                                                                                                                                                       
				method: "GET",                                                                                                                                                                                                                                             
				sorters: [                                                                                                                                                                                                                                                 
					new sap.ui.model.Sorter("SerialNumber")                                                                                                                                                                                                                   
				],                                                                                                                                                                                                                                                         
				filters: [oFilter],                                                                                                                                                                                                                                        
				success: function (oData, oResponse) {                                                                                                                                                                                                                     
					that.getBusyDialog().close();                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
					/*	if (oData.results.length === 0) {                                                                                                                                                                                                                      
							oIntentionCtrl.setSelectedKey('');                                                                                                                                                                                                                      
							oIntentionCtrl.setEnabled(false);                                                                                                                                                                                                                       
							//MessageBox.error(that.getI18nText("IntentionNotYetOpen") + sYear);                                                                                                                                                                                    
							//that._disableButton(false);                                                                                                                                                                                                                           
							return;                                                                                                                                                                                                                                                 
						}*/                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
					//oIntentionCtrl.setEnabled(true);                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
					//let oGlobalParamter = that.getView().getModel("viewConfigDataModel").getData().globalParameters;                                                                                                                                                        
					//oIntentionCtrl.setSelectedKey(oGlobalParamter.Intention);                                                                                                                                                                                               
					oData.results.splice(oData.results.map(item => item.Intention).indexOf("PER"), 1);                                                                                                                                                                        
					let oModel = new JSONModel(oData);                                                                                                                                                                                                                        
					that.getView().setModel(oModel, "intentionVHModel");                                                                                                                                                                                                      
					/*let oSelectedItem = oIntentionCtrl.getSelectedItem(),                                                                                                                                                                                                   
						oSelectedData = oSelectedItem.getBindingContext("intentionVHModel").getObject();                                                                                                                                                                         
					that._manageIntentionStatus(oSelectedItem);*/                                                                                                                                                                                                             
				},                                                                                                                                                                                                                                                         
				error: function (oError) {                                                                                                                                                                                                                                 
					that.getBusyDialog().close();                                                                                                                                                                                                                             
					MessageBox.error(that.getI18nText("errorFetchingIntentions"));                                                                                                                                                                                            
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
		_manageIntentionStatus: function (oSelectedData) {                                                                                                                                                                                                           
			let that = this;                                                                                                                                                                                                                                            
			if (oSelectedData.status === "Closed") {                                                                                                                                                                                                                    
				this._disableButton(false);                                                                                                                                                                                                                                
				return;                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
			} else if (oSelectedData.status === this.getI18nText("YetToOpen")) {                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
				that.getBusyDialog().close();                                                                                                                                                                                                                              
				//	MessageBox.error(oSelectedData.IntentDescription + " " + that.getI18nText("ThisIntentionNotYetOpen") + oSelectedData.Gjahr);                                                                                                                            
				this._disableButton(false);                                                                                                                                                                                                                                
				return;                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
			} else if (oSelectedData.status === "Open") {                                                                                                                                                                                                               
				this._disableButton(true);                                                                                                                                                                                                                                 
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		_disableButton: function (oValue) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		_onPressShellNavBack: function () {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			let bWarn = false,                                                                                                                                                                                                                                          
				oModel = this.getView().byId("idTiersTable").getModel("tiersTableModel");                                                                                                                                                                                  
			if (oModel) {                                                                                                                                                                                                                                               
				let aModelData = oModel.getData().results,                                                                                                                                                                                                                 
					aOriginalData = jQuery.extend(true, [], this._getOriginalTiersData().getData());                                                                                                                                                                          
				if (aModelData.length === aOriginalData.length) {                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
					// If both models have equal length, means no entry created or deleted only updated, check if any update, display warning msg.                                                                                                                            
					for (var i = 0; i < aModelData.length; i++) {                                                                                                                                                                                                             
						for (var j = 0; j < aOriginalData.length; j++) {                                                                                                                                                                                                         
							if (aModelData[i].CountryKey === aOriginalData[j].CountryKey && aModelData[i].FiscalYear === aOriginalData[j].FiscalYear &&                                                                                                                             
								aModelData[i].Intention === aOriginalData[j].Intention && parseInt(aModelData[i].Sequence, [10]) === parseInt(aOriginalData[j]                                                                                                                         
									.Sequence, [10]) && (aModelData[i].TierAmount !==                                                                                                                                                                                                     
									aOriginalData[j].TierAmount ||                                                                                                                                                                                                                        
									aModelData[i].TaxRate !== aOriginalData[j].TaxRate)) {                                                                                                                                                                                                
								// display warning                                                                                                                                                                                                                                     
								bWarn = true;                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
							}                                                                                                                                                                                                                                                       
						}                                                                                                                                                                                                                                                        
					}                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
				} else if (aModelData.length < aOriginalData.length) {                                                                                                                                                                                                     
					// display warning                                                                                                                                                                                                                                        
					bWarn = true;                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
				} else if (aModelData.length > aOriginalData.length) {                                                                                                                                                                                                     
					// display warning                                                                                                                                                                                                                                        
					bWarn = true;                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
				} else {                                                                                                                                                                                                                                                   
					// no warning                                                                                                                                                                                                                                             
					bWarn = false;                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				if (bWarn) {                                                                                                                                                                                                                                               
					this._unsavedChangesWarning();                                                                                                                                                                                                                            
				} else {                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
					window.history.go(-1);                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
			} else {                                                                                                                                                                                                                                                    
				window.history.go(-1);                                                                                                                                                                                                                                     
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_unsavedChangesWarning: function () {                                                                                                                                                                                                                        
			let sBtnAction = this.getResourceBundle().getText("btnTextLeavePage");                                                                                                                                                                                      
			MessageBox.warning(this.getResourceBundle().getText("errorMsgLeaveManageTiersScreen"), {                                                                                                                                                                    
				actions: [sBtnAction, MessageBox.Action.CANCEL],                                                                                                                                                                                                           
				emphasizedAction: sBtnAction,                                                                                                                                                                                                                              
				onClose: function (sAction) {                                                                                                                                                                                                                              
					if (sAction === sBtnAction) {                                                                                                                                                                                                                             
						window.history.go(-1);                                                                                                                                                                                                                                   
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//to get the max tier value +1 in order to generate tier name while adding new tier.                                                                                                                                                                         
		_getMaxTier: function (aTierData) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			let iMaxTierValue = 1;                                                                                                                                                                                                                                      
			if (aTierData.results.length > 0) { // If No Data exists in table - Use '1' else increment.                                                                                                                                                                 
				iMaxTierValue = Math.max(...aTierData.results.map(item => parseInt(item.Sequence, [10]))) + 1;                                                                                                                                                             
			}                                                                                                                                                                                                                                                           
			return String(iMaxTierValue);                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	-------------------	Service Call to Fetch Tiers Data	----------------------                                                                                                                                                                               
		_fetchTiersData: function () {                                                                                                                                                                                                                               
			let oView = this.getView(),                                                                                                                                                                                                                                 
				oServiceCallModel = this.getOwnerComponent().getModel(),                                                                                                                                                                                                   
				oTiersTable = oView.byId("idTiersTable"),                                                                                                                                                                                                                  
				oToggleEditBtn = oView.byId("idEditToggleBtn"),                                                                                                                                                                                                            
				iFiscalYrVal = oView.byId("idFilterFiscalYear").getValue(),                                                                                                                                                                                                
				sCountryVal = oView.byId("idFilterCountryCode").getSelectedItem().getBindingContext().getObject().Country,                                                                                                                                                 
				sIntention = oView.byId("idIntentionComboBox").getSelectedKey(),                                                                                                                                                                                           
				that = this,                                                                                                                                                                                                                                               
				oMandFilters = new Filter({                                                                                                                                                                                                                                
					filters: [new Filter("CountryKey", FilterOperator.EQ, sCountryVal),                                                                                                                                                                                       
						new Filter("FiscalYear", FilterOperator.EQ, iFiscalYrVal),                                                                                                                                                                                               
						new Filter("Intention", FilterOperator.EQ, sIntention)                                                                                                                                                                                                   
					],                                                                                                                                                                                                                                                        
					and: true                                                                                                                                                                                                                                                 
				});                                                                                                                                                                                                                                                        
			this.getBusyDialog().open();                                                                                                                                                                                                                                
			oToggleEditBtn.setEnabled(true);                                                                                                                                                                                                                            
			oServiceCallModel.read("/xEY1xSAV_C_TIERS", {                                                                                                                                                                                                               
				filters: [oMandFilters],                                                                                                                                                                                                                                   
				sorters: [                                                                                                                                                                                                                                                 
					new sap.ui.model.Sorter("Sequence")                                                                                                                                                                                                                       
				],                                                                                                                                                                                                                                                         
				method: "GET",                                                                                                                                                                                                                                             
				success: function (oData) {                                                                                                                                                                                                                                
					that.getBusyDialog().close();                                                                                                                                                                                                                             
					oData.results.map(obj => {                                                                                                                                                                                                                                
						obj.editFlag = sOriginal;                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
					});                                                                                                                                                                                                                                                       
					oTiersTable.setModel(new JSONModel(oData), "tiersTableModel");                                                                                                                                                                                            
					oTiersTable.getModel("tiersTableModel").setDefaultBindingMode("TwoWay");                                                                                                                                                                                  
					that.getView().byId("idHeadText").setText(that.getResourceBundle().getText("tiersTableTitle", [oTiersTable.getBinding("items")                                                                                                                            
						.getLength()                                                                                                                                                                                                                                             
					]));                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
					// Create Deep Copy for Original Data - Required for Final Save                                                                                                                                                                                           
					that._setOriginalTiersData(oData);                                                                                                                                                                                                                        
				},                                                                                                                                                                                                                                                         
				error: function (oError) {                                                                                                                                                                                                                                 
					that.getBusyDialog().close();                                                                                                                                                                                                                             
					MessageBox.error(that.getI18nText("TierGetServiceCallError"));                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//close the message popover                                                                                                                                                                                                                                  
		_closeMessagePopovers: function () {                                                                                                                                                                                                                         
			if (this.oMessagePopover) {                                                                                                                                                                                                                                 
				this.oMessagePopover.close();                                                                                                                                                                                                                              
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	-------------------	Set Tiers Original Data	----------------------                                                                                                                                                                                        
		_setOriginalTiersData: function (oData) {                                                                                                                                                                                                                    
			let aDeepCopy = jQuery.extend(true, [], oData.results);                                                                                                                                                                                                     
			aDeepCopy.map(item => delete item.__metadata);                                                                                                                                                                                                              
			this.getView().setModel(new JSONModel(aDeepCopy), "modelOriginalTiersData");                                                                                                                                                                                
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	-------------------	Get Tiers Original Data	----------------------                                                                                                                                                                                        
		_getOriginalTiersData: function () {                                                                                                                                                                                                                         
			return this.getView().getModel("modelOriginalTiersData");                                                                                                                                                                                                   
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	-------------------	Update Properties and Flags on Change Events	----------------------                                                                                                                                                                   
		_setUpdatedEntries: function (oEvent, sPropertyName) {                                                                                                                                                                                                       
			let oSrc = oEvent.getSource(),                                                                                                                                                                                                                              
				sValue = oSrc.getValue(),                                                                                                                                                                                                                                  
				sBinding = oSrc.getParent().getBindingContextPath(),                                                                                                                                                                                                       
				oTableModel = oSrc.getModel("tiersTableModel"),                                                                                                                                                                                                            
				regExDecimals = new RegExp(/[^0-9.-]/gi),                                                                                                                                                                                                                  
				regExpPerd = new RegExp(/.*\..*\..*/),                                                                                                                                                                                                                     
				indexChar, sTempValue, spChar,                                                                                                                                                                                                                             
				sCurrChar = this.getView().byId("idFilterCountryCode").getSelectedItem().getBindingContext().getObject().Currency;                                                                                                                                         
			if (sPropertyName === "TierAmount") {                                                                                                                                                                                                                       
				spChar = sCurrChar;                                                                                                                                                                                                                                        
			} else {                                                                                                                                                                                                                                                    
				spChar = "%";                                                                                                                                                                                                                                              
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			indexChar = sValue.toUpperCase().indexOf(spChar);                                                                                                                                                                                                           
			if (indexChar >= 0) {                                                                                                                                                                                                                                       
				let sValNoSpace = sValue.replace(/\s/g, '');                                                                                                                                                                                                               
				sTempValue = sValNoSpace.substr(0, sValNoSpace.length - spChar.length);                                                                                                                                                                                    
			} else {                                                                                                                                                                                                                                                    
				sTempValue = sValue;                                                                                                                                                                                                                                       
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			if (regExDecimals.exec(sTempValue) !== null) {                                                                                                                                                                                                              
				oSrc.setValue("");                                                                                                                                                                                                                                         
				this._validateInvalidEntry(oEvent, sPropertyName);                                                                                                                                                                                                         
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			if (regExpPerd.exec(sTempValue) !== null) {                                                                                                                                                                                                                 
				oSrc.setValue("");                                                                                                                                                                                                                                         
				this._validateInvalidEntry(oEvent, sPropertyName);                                                                                                                                                                                                         
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			let oTierEntry = oSrc.getParent().getBindingContext("tiersTableModel").getObject();                                                                                                                                                                         
			oTableModel.setProperty(sBinding + "/" + sPropertyName, sValue.toUpperCase());                                                                                                                                                                              
			if (oTierEntry.editFlag === sUpdate) {                                                                                                                                                                                                                      
				oTableModel.setProperty(sBinding + "/editFlag", sUpdate);                                                                                                                                                                                                  
			}                                                                                                                                                                                                                                                           
			this._validateInvalidEntry(oEvent, sPropertyName);                                                                                                                                                                                                          
			// let oSrc = oEvent.getSource(),                                                                                                                                                                                                                           
			// 	sBinding = oSrc.getParent().getBindingContextPath(),                                                                                                                                                                                                    
			// 	oTableModel = oSrc.getModel("tiersTableModel"),                                                                                                                                                                                                         
			// 	oValue = "0.00";                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			// if (oSrc.getValue()) {                                                                                                                                                                                                                                   
			// 	let oTierEntry = oSrc.getParent().getBindingContext("tiersTableModel").getObject();                                                                                                                                                                     
			// 	if (sPropertyName === "TaxRate") {                                                                                                                                                                                                                      
			// 		oValue = this.formatter.appendPercentageSign(oSrc.getValue());                                                                                                                                                                                         
			// 	} else {                                                                                                                                                                                                                                                
			// 		oValue = this.formatter.formatTierAmountDisplayAndEdit(oSrc.getValue(), true);                                                                                                                                                                         
			// 	}                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			// 	oTableModel.setProperty(sBinding + "/" + sPropertyName, oValue);                                                                                                                                                                                        
			// 	if (oTierEntry.editFlag === sUpdate) {                                                                                                                                                                                                                  
			// 		oTableModel.setProperty(sBinding + "/editFlag", sUpdate);                                                                                                                                                                                              
			// 	}                                                                                                                                                                                                                                                       
			// 	oTableModel.refresh();                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			// } else {                                                                                                                                                                                                                                                 
			// 	oTableModel.setProperty(sBinding + "/" + sPropertyName, oValue);                                                                                                                                                                                        
			// }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			// this._validateInvalidEntry(oEvent, sPropertyName);                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_setUpdatedFragmentAmount: function (oEvent, sPropertyName) {                                                                                                                                                                                                
			let oSrc = oEvent.getSource(),                                                                                                                                                                                                                              
				sValue = oSrc.getValue(),                                                                                                                                                                                                                                  
				regExDecimals = new RegExp(/[^0-9.-]/gi),                                                                                                                                                                                                                  
				regExpPerd = new RegExp(/.*\..*\..*/),                                                                                                                                                                                                                     
				indexChar, sTempValue, spChar,                                                                                                                                                                                                                             
				oValue,                                                                                                                                                                                                                                                    
				sCurrChar = this.getView().byId("idFilterCountryCode").getSelectedItem().getBindingContext().getObject().Currency;                                                                                                                                         
			if (sPropertyName === "TierAmount") {                                                                                                                                                                                                                       
				spChar = sCurrChar;                                                                                                                                                                                                                                        
			} else {                                                                                                                                                                                                                                                    
				spChar = "%";                                                                                                                                                                                                                                              
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			indexChar = sValue.toUpperCase().indexOf(spChar);                                                                                                                                                                                                           
			if (indexChar >= 0) {                                                                                                                                                                                                                                       
				let sValNoSpace = sValue.replace(/\s/g, '');                                                                                                                                                                                                               
				sTempValue = sValNoSpace.substr(0, sValNoSpace.length - spChar.length);                                                                                                                                                                                    
			} else {                                                                                                                                                                                                                                                    
				sTempValue = sValue;                                                                                                                                                                                                                                       
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			if (regExDecimals.exec(sTempValue) !== null) {                                                                                                                                                                                                              
				oSrc.setValue("");                                                                                                                                                                                                                                         
				this._validateInvalidEntry(oEvent, sPropertyName);                                                                                                                                                                                                         
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			if (regExpPerd.exec(sTempValue) !== null) {                                                                                                                                                                                                                 
				oSrc.setValue("");                                                                                                                                                                                                                                         
				this._validateInvalidEntry(oEvent, sPropertyName);                                                                                                                                                                                                         
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			if (sPropertyName === "TaxRate") {                                                                                                                                                                                                                          
				oValue = this.formatter.appendPercentageSign(sValue);                                                                                                                                                                                                      
			} else {                                                                                                                                                                                                                                                    
				oValue = this.formatter.formatTierAmountDisplayAndEdit(sValue, true, spChar);                                                                                                                                                                              
			}                                                                                                                                                                                                                                                           
			oSrc.setValue(oValue);                                                                                                                                                                                                                                      
			this._validateInvalidEntry(oEvent, sPropertyName);                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_validateInvalidEntry: function (oEvent, sPropertyName) {                                                                                                                                                                                                    
			let oSrc = oEvent.getSource(),                                                                                                                                                                                                                              
				sValue = oSrc.getValue();                                                                                                                                                                                                                                  
			//.replaceAll(/[^0-9.-]/gi, "").trim();                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
			// Find any value except 0 to 9 &'.'&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                
			// let regExDecimals = new RegExp(/[^0-9.-]/gi);                                                                                                                                                                                                            
			// if (regExDecimals.exec(sValue) !== null) {                                                                                                                                                                                                               
			// 	oSrc.setValue("0.00");                                                                                                                                                                                                                                  
			// 	oSrc.setValueState("Error");                                                                                                                                                                                                                            
			// 	this.bAllEntriesValidated = false;                                                                                                                                                                                                                      
			// 	return;                                                                                                                                                                                                                                                 
			// }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			// Check if Tax Rate value is > 100 - Throw error                                                                                                                                                                                                           
			if (sPropertyName === "TaxRate" && (!sValue || parseFloat(sValue, [10]) < 0 || parseFloat(sValue, [10]) > 100)) {                                                                                                                                           
				oSrc.setValueState("Error");                                                                                                                                                                                                                               
				this.bAllEntriesValidated = false;                                                                                                                                                                                                                         
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			// Default state                                                                                                                                                                                                                                            
			oSrc.setValueState("None");                                                                                                                                                                                                                                 
			this.bAllEntriesValidated = true;                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			if (!sValue || parseFloat(sValue, [10]) === 0) {                                                                                                                                                                                                            
				oSrc.setValueState("Error");                                                                                                                                                                                                                               
				this.bAllEntriesValidated = false;                                                                                                                                                                                                                         
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	-------------------	Change screen to Display Mode (Reset Screen)	----------------------                                                                                                                                                                   
		_setScreenToDisplayMode: function () {                                                                                                                                                                                                                       
			let oView = this.getView();                                                                                                                                                                                                                                 
			oView.getModel("deleteModel").setData([]);                                                                                                                                                                                                                  
			oView.getModel("editTierModel").setProperty("/edit", false);                                                                                                                                                                                                
			this._fetchTiersData();                                                                                                                                                                                                                                     
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	-------------------	clear message popover old messages	----------------------                                                                                                                                                                             
		_clearMessagesPopover: function () {                                                                                                                                                                                                                         
			let oMsgModel = this.getView().getModel("message");                                                                                                                                                                                                         
			oMsgModel.setData([]);                                                                                                                                                                                                                                      
			oMsgModel.refresh();                                                                                                                                                                                                                                        
			oSapUiCore.getMessageManager().removeAllMessages();                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	-------------------	get i18n Texts	----------------------                                                                                                                                                                                                 
		getI18nText: function (sTextKey) {                                                                                                                                                                                                                           
			return this.getResourceBundle().getText(sTextKey);                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/*	delete call to delete all the intentions data to be rolled over with new tiers                                                                                                                                                                            
			arguments: aDel: array of intentions' tiers to be deleted*/                                                                                                                                                                                                 
		_serviceCallDeleteTiers: function (aDel) {                                                                                                                                                                                                                   
			let oServiceCallModel = this.getOwnerComponent().getModel(),                                                                                                                                                                                                
				that = this;                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			for (var i = 0; i < aDel.length; i++) {                                                                                                                                                                                                                     
				let sDeleteServiceURL = "/xEY1xSAV_C_TIERS(CountryKey='" + aDel[i].CountryKey + "',FiscalYear='" + aDel[i]                                                                                                                                                 
					.FiscalYear + "',Intention='" + aDel[i].Intention +                                                                                                                                                                                                       
					"',Sequence='" + aDel[i].Sequence + "')";                                                                                                                                                                                                                 
				oServiceCallModel.remove(sDeleteServiceURL, {                                                                                                                                                                                                              
					groupId: "groupIdRollOver"                                                                                                                                                                                                                                
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			//return a promise in the form of resolve or reject in case of success or error.                                                                                                                                                                            
			return new Promise(function (resolve, reject) {                                                                                                                                                                                                             
				oServiceCallModel.submitChanges({                                                                                                                                                                                                                          
					groupId: "groupIdRollOver",                                                                                                                                                                                                                               
					success: function (oData, response) {                                                                                                                                                                                                                     
						let oChangeResponses;                                                                                                                                                                                                                                    
						// If no service call is sent.                                                                                                                                                                                                                           
						if (!oData.__batchResponses) {                                                                                                                                                                                                                           
							that._setScreenToDisplayMode();                                                                                                                                                                                                                         
							//reject promise                                                                                                                                                                                                                                        
							reject(oData);                                                                                                                                                                                                                                          
							return;                                                                                                                                                                                                                                                 
						}                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
						// If No response is received.                                                                                                                                                                                                                           
						oChangeResponses = oData.__batchResponses[0].__changeResponses;                                                                                                                                                                                          
						if (!oChangeResponses || oChangeResponses.length <= 0) {                                                                                                                                                                                                 
							that._setScreenToDisplayMode();                                                                                                                                                                                                                         
							//reject promise                                                                                                                                                                                                                                        
							reject(oData);                                                                                                                                                                                                                                          
							return;                                                                                                                                                                                                                                                 
						}                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
						let oOverAllResponse = JSON.parse(oChangeResponses.find(item => item.headers["sap-message"]).headers["sap-message"]);                                                                                                                                    
                                                                                                                                                                                                                                                               
						//	If header response is available & is success                                                                                                                                                                                                          
						if (oOverAllResponse && oOverAllResponse.severity.toUpperCase() === "SUCCESS") {                                                                                                                                                                         
							//resolve promise                                                                                                                                                                                                                                       
							resolve(oData);                                                                                                                                                                                                                                         
						} else if (oOverAllResponse && oOverAllResponse.message) { // If header response is available but other than success.                                                                                                                                    
                                                                                                                                                                                                                                                               
							MessageToast.show(that.getI18nText("genericMsgBatchRollOverError"));                                                                                                                                                                                    
							//reject promise                                                                                                                                                                                                                                        
							reject(oData);                                                                                                                                                                                                                                          
						}                                                                                                                                                                                                                                                        
						// If No response - default framework error to occur                                                                                                                                                                                                     
					},                                                                                                                                                                                                                                                        
					error: function (oError) {                                                                                                                                                                                                                                
						that._setScreenToDisplayMode();                                                                                                                                                                                                                          
						reject(oData);                                                                                                                                                                                                                                           
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/*service call to create tiers for the intentions to be rolled over                                                                                                                                                                                          
		arguments:aRollIntentions : intentions for which tiers will be created*/                                                                                                                                                                                     
		_sServiceCreateTiers: function (aRollIntentions) {                                                                                                                                                                                                           
			let oServiceCallModel = this.getOwnerComponent().getModel(),                                                                                                                                                                                                
				aModelData = this.getView().byId("idTiersTable").getModel("tiersTableModel").getData().results,                                                                                                                                                            
				that = this,                                                                                                                                                                                                                                               
				aCreateTiers = [];                                                                                                                                                                                                                                         
			if (aModelData.length > 0) {                                                                                                                                                                                                                                
				/*outer loop for intentions to be rolled with tier changes                                                                                                                                                                                                 
				inner loop for current intention data displayed inside the table*/                                                                                                                                                                                         
				aRollIntentions.map(y => {                                                                                                                                                                                                                                 
					aModelData.map(item => {                                                                                                                                                                                                                                  
						item.TierAmount = parseFloat(item.TierAmount, [10]).toFixed(2);                                                                                                                                                                                          
						delete item.__metadata;                                                                                                                                                                                                                                  
						delete item.editFlag;                                                                                                                                                                                                                                    
						delete item.Tier;                                                                                                                                                                                                                                        
						item.TaxRate = parseFloat(item.TaxRate).toFixed(2);                                                                                                                                                                                                      
						var b = Object.assign({}, item, {                                                                                                                                                                                                                        
							Intention: y.Intent                                                                                                                                                                                                                                     
						});                                                                                                                                                                                                                                                      
						aCreateTiers.push(b);                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
					});                                                                                                                                                                                                                                                       
				});                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
				for (var iEntry = 0; iEntry < aCreateTiers.length; iEntry++) {                                                                                                                                                                                             
					oServiceCallModel.create("/xEY1xSAV_C_TIERS", aCreateTiers[iEntry], {                                                                                                                                                                                     
						groupId: "groupIdRollOver"                                                                                                                                                                                                                               
					});                                                                                                                                                                                                                                                       
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				oServiceCallModel.submitChanges({                                                                                                                                                                                                                          
					groupId: "groupIdRollOver",                                                                                                                                                                                                                               
					success: function (oData, response) {                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
						let oChangeResponses;                                                                                                                                                                                                                                    
						// If no service call is sent.                                                                                                                                                                                                                           
						if (!oData.__batchResponses) {                                                                                                                                                                                                                           
							that._setScreenToDisplayMode();                                                                                                                                                                                                                         
							return;                                                                                                                                                                                                                                                 
						}                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
						// If No response is received.                                                                                                                                                                                                                           
						oChangeResponses = oData.__batchResponses[0].__changeResponses;                                                                                                                                                                                          
						if (!oChangeResponses || oChangeResponses.length <= 0) {                                                                                                                                                                                                 
							that._setScreenToDisplayMode();                                                                                                                                                                                                                         
							return;                                                                                                                                                                                                                                                 
						}                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
						let oOverAllResponse = JSON.parse(oChangeResponses.find(item => item.headers["sap-message"]).headers["sap-message"]);                                                                                                                                    
                                                                                                                                                                                                                                                               
						//	If header response is available & is success                                                                                                                                                                                                          
						if (oOverAllResponse && oOverAllResponse.severity.toUpperCase() === "SUCCESS") {                                                                                                                                                                         
                                                                                                                                                                                                                                                               
							MessageToast.show(that.getI18nText("genericMsgBatchRollOverSuccess"));                                                                                                                                                                                  
							that._setScreenToDisplayMode();                                                                                                                                                                                                                         
						} else if (oOverAllResponse && oOverAllResponse.message) { // If header response is available but other than success.                                                                                                                                    
                                                                                                                                                                                                                                                               
							MessageToast.show(that.getI18nText("genericMsgBatchError"));                                                                                                                                                                                            
						}                                                                                                                                                                                                                                                        
						// If No response - default framework error to occur                                                                                                                                                                                                     
					},                                                                                                                                                                                                                                                        
					error: function (oError) {                                                                                                                                                                                                                                
						that._setScreenToDisplayMode();                                                                                                                                                                                                                          
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			} else {                                                                                                                                                                                                                                                    
				MessageToast.show(that.getI18nText("genericMsgBatchRollOverSuccess"));                                                                                                                                                                                     
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		// ------------------------------------------------------------------------------------------------------------------------                                                                                                                                  
		// ------------------------------------------------------------------------------------------------------------------------                                                                                                                                  
		// ------------------------------	EVENT HANDLERS	-----------------------------------------------------------------------                                                                                                                                     
		// ------------------------------------------------------------------------------------------------------------------------                                                                                                                                  
		// ------------------------------------------------------------------------------------------------------------------------                                                                                                                                  
		//----------------On Date Change Call--------------                                                                                                                                                                                                          
		onChangeDatePickerFilter: function (oEvent) {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			let oDP = oEvent.getSource(),                                                                                                                                                                                                                               
				sBunit = this.getView().byId("idFilterCountryCode").getSelectedKey();                                                                                                                                                                                      
			if (oEvent.getParameter("valid")) {                                                                                                                                                                                                                         
				oDP.setValueState("None");                                                                                                                                                                                                                                 
				let sYear = oDP.getDateValue().getFullYear(),                                                                                                                                                                                                              
					aParam = [sBunit, sYear];                                                                                                                                                                                                                                 
				this._fetchIntentionStatus(aParam);                                                                                                                                                                                                                        
			} else {                                                                                                                                                                                                                                                    
				oDP.setValueState("Error");                                                                                                                                                                                                                                
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		//	--------------- Press event for Add new Tier Button -------------------                                                                                                                                                                                   
		onPressAddNewTier: function (oEvent) {                                                                                                                                                                                                                       
			let oView = this.getView();                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
			if (!this._oTierCreateFragment) {                                                                                                                                                                                                                           
				this._oTierCreateFragment = sap.ui.xmlfragment("tierCreate",                                                                                                                                                                                               
					"ey.sap.fin.cs.managetiers.fragment.TierCreate", this);                                                                                                                                                                                                   
				oView.addDependent(this._oTierCreateFragment);                                                                                                                                                                                                             
			}                                                                                                                                                                                                                                                           
			this._oTierCreateFragment.open();                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			let aDataTierTable = oView.byId("idTiersTable").getModel("tiersTableModel").getData(),                                                                                                                                                                      
				iMaxTierValue = this._getMaxTier(aDataTierTable);                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			// Defaulting New Fragment                                                                                                                                                                                                                                  
			oSapUiCore.byId("tierCreate--IdTier").setText("Tier " + iMaxTierValue);                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
			let oTierAmount = oSapUiCore.byId("tierCreate--IdTierAmnt"),                                                                                                                                                                                                
				oTaxRate = oSapUiCore.byId("tierCreate--IdTaxRate");                                                                                                                                                                                                       
			oTierAmount.setValue("");                                                                                                                                                                                                                                   
			oTaxRate.setValue("");                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
			oTierAmount.setValueState("None");                                                                                                                                                                                                                          
			oTaxRate.setValueState("None");                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	--------------- Press event for DELETE Tier Button -------------------                                                                                                                                                                                    
		onPressDeleteTier: function () {                                                                                                                                                                                                                             
			let oView = this.getView(),                                                                                                                                                                                                                                 
				oTiersTable = oView.byId("idTiersTable"),                                                                                                                                                                                                                  
				aSelectedItems = oTiersTable.getSelectedItems();                                                                                                                                                                                                           
			if (!aSelectedItems.length) {                                                                                                                                                                                                                               
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			let oModelDelete = oView.getModel("deleteModel"),                                                                                                                                                                                                           
				oModel = oTiersTable.getModel("tiersTableModel"),                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				arrIndex = [],                                                                                                                                                                                                                                             
				aDataTierTable = oTiersTable.getModel("tiersTableModel").getData(),                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
				//temporary model which will be emptied after data is set on final delete model                                                                                                                                                                            
				oModelTempDel = new JSONModel();                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			//select all delete scenario                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			if (oTiersTable.getSelectedItems().length === oTiersTable.getItems().length) {                                                                                                                                                                              
				//check if all are created now only no need to send backend request for delete                                                                                                                                                                             
				let arrDeleData = [];                                                                                                                                                                                                                                      
				aDataTierTable.results.map(x => {                                                                                                                                                                                                                          
					if (x.editFlag !== sCreate) {                                                                                                                                                                                                                             
						arrDeleData.push(x);                                                                                                                                                                                                                                     
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
				oModelTempDel.setData([]);                                                                                                                                                                                                                                 
				oModelTempDel.setData(arrDeleData);                                                                                                                                                                                                                        
				oModel.setData({                                                                                                                                                                                                                                           
					results: []                                                                                                                                                                                                                                               
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
			//few /one check box selected                                                                                                                                                                                                                               
			else {                                                                                                                                                                                                                                                      
				oModelTempDel.setData({});                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
				//getIndex of all the selected items                                                                                                                                                                                                                       
				arrIndex = aSelectedItems.map(x => oTiersTable.indexOfItem(x));                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
				//sort indices of all selected items in desc                                                                                                                                                                                                               
				arrIndex.sort(function (a, b) {                                                                                                                                                                                                                            
					return b - a;                                                                                                                                                                                                                                             
				});                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
				for (var k = 0; k < arrIndex.length; k++) {                                                                                                                                                                                                                
					//calculate everytime max tier value                                                                                                                                                                                                                      
					let iMaxTierVal = parseInt(this._getMaxTier(aDataTierTable), [10]) - 1;                                                                                                                                                                                   
					if (iMaxTierVal > parseInt(aDataTierTable.results[arrIndex[k]].Sequence, [10])) {                                                                                                                                                                         
						MessageToast.show(this.getI18nText("deletTierError"));                                                                                                                                                                                                   
						break;                                                                                                                                                                                                                                                   
					} else {                                                                                                                                                                                                                                                  
						let aDataDelete = aDataTierTable.results.splice(arrIndex[k], 1),                                                                                                                                                                                         
							aDataDelTemp = oModelTempDel.getData();                                                                                                                                                                                                                 
						if (aDataDelete[0].editFlag !== sCreate) {                                                                                                                                                                                                               
							delete aDataDelete[0].editFlag;                                                                                                                                                                                                                         
							if (Object.keys(aDataDelTemp).length === 0 && aDataDelTemp.constructor === Object) {                                                                                                                                                                    
								aDataDelTemp = aDataDelete;                                                                                                                                                                                                                            
							} else {                                                                                                                                                                                                                                                
								aDataDelTemp.push(aDataDelete[0]);                                                                                                                                                                                                                     
							}                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
						}                                                                                                                                                                                                                                                        
						//setting data to be deleted on temporary model                                                                                                                                                                                                          
						oModelTempDel.setData(aDataDelTemp);                                                                                                                                                                                                                     
						//setting spliced data on orignal model visible on screen                                                                                                                                                                                                
						oModel.setData(aDataTierTable);                                                                                                                                                                                                                          
						oModel.refresh();                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			//setting final data on delete model from temp model to delete values from DB.                                                                                                                                                                              
			let aDataDelFinal = oModelDelete.getData();                                                                                                                                                                                                                 
			if (Object.keys(aDataDelFinal).length === 0 && aDataDelFinal.constructor === Object) {                                                                                                                                                                      
				aDataDelFinal = oModelTempDel.getData();                                                                                                                                                                                                                   
			} else {                                                                                                                                                                                                                                                    
				for (var i = 0; i < oModelTempDel.getData().length; i++) {                                                                                                                                                                                                 
					aDataDelFinal.push(oModelTempDel.getData()[i]);                                                                                                                                                                                                           
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			oModelDelete.setData(aDataDelFinal);                                                                                                                                                                                                                        
			oModel.refresh();                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	--------------- Press event for Close Button - In Add tier Fragment -------------------                                                                                                                                                                   
		onPressCloseDialog: function () {                                                                                                                                                                                                                            
			this._oTierCreateFragment.close();                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	--------------- Press event for EDIT Toggle Button -------------------                                                                                                                                                                                    
		onPressEditToggleBtn: function (oEvent) {                                                                                                                                                                                                                    
			let oView = this.getView();                                                                                                                                                                                                                                 
			oView.getModel("editTierModel").setProperty("/edit", true);                                                                                                                                                                                                 
			this._clearMessagesPopover();                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	--------------- Press event for SAVE Button - Add Tier Fragment -------------------                                                                                                                                                                       
		onPressSaveBtnAddTier: function () {                                                                                                                                                                                                                         
			let oTierAmntVal = oSapUiCore.byId("tierCreate--IdTierAmnt"),                                                                                                                                                                                               
				iTierAmntVal = oTierAmntVal.getValue(),                                                                                                                                                                                                                    
				oTaxRateVal = oSapUiCore.byId("tierCreate--IdTaxRate"),                                                                                                                                                                                                    
				iTaxRateVal = oTaxRateVal.getValue();                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
			if (!iTierAmntVal) { // If Tier Amount is '0'. Throw error.                                                                                                                                                                                                 
				oTierAmntVal.setValueState("Error");                                                                                                                                                                                                                       
			} else if (!iTaxRateVal) { // If Tax Rate is '0'. Throw error.                                                                                                                                                                                              
				oTaxRateVal.setValueState("Error");                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			if (oTierAmntVal.getValueState() === "Error" || oTaxRateVal.getValueState() === "Error") {                                                                                                                                                                  
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			// All fields look good. Execute further.                                                                                                                                                                                                                   
			let oView = this.getView(),                                                                                                                                                                                                                                 
				oTiersTableModel = oView.byId("idTiersTable").getModel("tiersTableModel"),                                                                                                                                                                                 
				//get the values to be saved/updated in the batch                                                                                                                                                                                                          
				sTierVal = oSapUiCore.byId("tierCreate--IdTier").getText(),                                                                                                                                                                                                
				iFiscalYrVal = oView.byId("idFilterFiscalYear").getValue(),                                                                                                                                                                                                
				sCountryVal = oView.byId("idFilterCountryCode").getSelectedItem().getBindingContext().getObject().Country,                                                                                                                                                 
				sCurrencyVal = oView.byId("idFilterCountryCode").getSelectedItem().getBindingContext().getObject().Currency,                                                                                                                                               
				sIntentionVal = oView.byId("idIntentionComboBox").getSelectedKey(),                                                                                                                                                                                        
				aDataTiersTable = oTiersTableModel.getData(),                                                                                                                                                                                                              
				iSeqNoVal = this._getMaxTier(aDataTiersTable),                                                                                                                                                                                                             
				aDataDeleteModel = oView.getModel("deleteModel").getData(),                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
				oTierObject = {                                                                                                                                                                                                                                            
					"CountryKey": sCountryVal,                                                                                                                                                                                                                                
					"FiscalYear": iFiscalYrVal,                                                                                                                                                                                                                               
					"Sequence": iSeqNoVal,                                                                                                                                                                                                                                    
					"Tier": sTierVal,                                                                                                                                                                                                                                         
					"TierAmount": iTierAmntVal,                                                                                                                                                                                                                               
					"TaxRate": iTaxRateVal,                                                                                                                                                                                                                                   
					"editFlag": sCreate,                                                                                                                                                                                                                                      
					"LocalCurrency": sCurrencyVal,                                                                                                                                                                                                                            
					"Intention": sIntentionVal                                                                                                                                                                                                                                
				};                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			//check if values already present in delete array, update their flag as supdate rather than create                                                                                                                                                          
			for (var i = 0; i < aDataDeleteModel.length; i++) {                                                                                                                                                                                                         
				if (aDataDeleteModel[i].CountryKey === oTierObject.CountryKey && aDataDeleteModel[i].FiscalYear === oTierObject.FiscalYear &&                                                                                                                              
					aDataDeleteModel[i].Intention === oTierObject.Intention && parseInt(aDataDeleteModel[i].Sequence, [10]) === parseInt(oTierObject.Sequence, [                                                                                                              
						10                                                                                                                                                                                                                                                       
					]) && parseFloat(aDataDeleteModel[i].TierAmount)                                                                                                                                                                                                          
					.toFixed(2) === parseFloat(oTierObject.TierAmount).toFixed(2) ||                                                                                                                                                                                          
					parseFloat(aDataDeleteModel[i].TaxRate).toFixed(2) === parseFloat(oTierObject.TaxRate).toFixed(2)) {                                                                                                                                                      
					aDataDeleteModel.splice(i, 1);                                                                                                                                                                                                                            
					oTierObject.editFlag = sOriginal;                                                                                                                                                                                                                         
				} else if (aDataDeleteModel[i].CountryKey === oTierObject.CountryKey && aDataDeleteModel[i].FiscalYear === oTierObject.FiscalYear &&                                                                                                                       
					aDataDeleteModel[i].Intention === oTierObject.Intention && parseInt(aDataDeleteModel[i].Sequence, [10]) === parseInt(oTierObject.Sequence, [                                                                                                              
						10                                                                                                                                                                                                                                                       
					])) {                                                                                                                                                                                                                                                     
					aDataDeleteModel.splice(i, 1);                                                                                                                                                                                                                            
					oTierObject.editFlag = sUpdate;                                                                                                                                                                                                                           
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			aDataTiersTable.results.push(oTierObject);                                                                                                                                                                                                                  
			oTiersTableModel.setData(aDataTiersTable);                                                                                                                                                                                                                  
			oTiersTableModel.refresh();                                                                                                                                                                                                                                 
			this._oTierCreateFragment.close();                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	--------------- Press event for 'GO' Button -------------------                                                                                                                                                                                           
		onSearchButtonPressed: function () {                                                                                                                                                                                                                         
			this._fetchTiersData();                                                                                                                                                                                                                                     
			//this.getView().byId("idOverflowToolbar").setVisible(true);                                                                                                                                                                                                
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	--------------- Change event for TaxRate field -------------------                                                                                                                                                                                        
		onChangeTierTaxRate: function (oEvent) {                                                                                                                                                                                                                     
			this._setUpdatedEntries(oEvent, "TaxRate");                                                                                                                                                                                                                 
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	--------------- Change event for TierAmount field -------------------                                                                                                                                                                                     
		onChangeTierAmount: function (oEvent) {                                                                                                                                                                                                                      
			this._setUpdatedEntries(oEvent, "TierAmount");                                                                                                                                                                                                              
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	--------------- Press event for SAVE Button (	BATCH	)-------------------                                                                                                                                                                                  
		onPressSaveTier: function () {                                                                                                                                                                                                                               
			if (!this.bAllEntriesValidated) {                                                                                                                                                                                                                           
				MessageBox.error(this.getI18nText("errorMsgInvalidTableData"));                                                                                                                                                                                            
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			// Variable Declaration                                                                                                                                                                                                                                     
			let oComp = this.getOwnerComponent(),                                                                                                                                                                                                                       
				oServiceCallModel = oComp.getModel(),                                                                                                                                                                                                                      
				that = this,                                                                                                                                                                                                                                               
				aModelData = this.getView().byId("idTiersTable").getModel("tiersTableModel").getData().results,                                                                                                                                                            
				aOriginalData = jQuery.extend(true, [], this._getOriginalTiersData().getData()); //	this.getView().byId("idMessagePopoverBtn").setVisible(true);                                                                                                           
                                                                                                                                                                                                                                                               
			this._clearMessagesPopover();                                                                                                                                                                                                                               
			// Delete '__metadata' & restrict 'TierAmount' to 2 decimal points.                                                                                                                                                                                         
			aOriginalData.map(item => {                                                                                                                                                                                                                                 
				item.TierAmount = parseFloat(item.TierAmount, [10]).toFixed(2);                                                                                                                                                                                            
				delete item.__metadata;                                                                                                                                                                                                                                    
				delete item.editFlag;                                                                                                                                                                                                                                      
				delete item.Tier;                                                                                                                                                                                                                                          
				item.TaxRate = parseFloat(item.TaxRate).toFixed(2);                                                                                                                                                                                                        
				return item;                                                                                                                                                                                                                                               
			});                                                                                                                                                                                                                                                         
			aModelData.map(item => {                                                                                                                                                                                                                                    
				item.TierAmount = parseFloat(item.TierAmount, [10]).toFixed(2);                                                                                                                                                                                            
				delete item.__metadata;                                                                                                                                                                                                                                    
				delete item.editFlag;                                                                                                                                                                                                                                      
				delete item.Tier;                                                                                                                                                                                                                                          
				item.TaxRate = parseFloat(item.TaxRate).toFixed(2);                                                                                                                                                                                                        
				return item;                                                                                                                                                                                                                                               
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			// --------------> Configuring Batch settings <--------------                                                                                                                                                                                               
			oServiceCallModel.setUseBatch(true);                                                                                                                                                                                                                        
			oServiceCallModel.setChangeGroups({                                                                                                                                                                                                                         
				"/SAV_MANAGE_TIER_SRV": {                                                                                                                                                                                                                                  
					groupId: "groupIdSaveTier",                                                                                                                                                                                                                               
					changeSetId: "ID",                                                                                                                                                                                                                                        
					single: false                                                                                                                                                                                                                                             
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			oServiceCallModel.setDeferredGroups(oServiceCallModel.getDeferredGroups().concat(["groupIdSaveTier"]));                                                                                                                                                     
                                                                                                                                                                                                                                                               
			// -----------------------------------------------------------TEST CODE-------------------------------------------------&nbsp;                                                                                                                              
			// for (var count = 0; count < aModelData.length; count++) {                                                                                                                                                                                                
			// 	if (aModelData[count].editFlag === sCreate) {                                                                                                                                                                                                           
			// 		delete aModelData[count].editFlag;                                                                                                                                                                                                                     
			// 		oServiceCallModel.create("/xEY1xSAV_C_TIERS", aModelData[count], {                                                                                                                                                                                     
			// 			groupId: "groupIdSaveTier"                                                                                                                                                                                                                            
			// 		});                                                                                                                                                                                                                                                    
			// 	} else if (aModelData[count].editFlag === sUpdate) {                                                                                                                                                                                                    
			// 		delete aModelData[count].editFlag;                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
			// 		oServiceCallModel.update("/xEY1xSAV_C_TIERS(CountryKey='" + aModelData[count].CountryKey + "',FiscalYear='" + aModelData[count].FiscalYear +                                                                                                           
			// 			"',Sequence='" + aModelData[count].Sequence + "')",                                                                                                                                                                                                   
			// 			aModelData[count], {                                                                                                                                                                                                                                  
			// 				groupId: "groupIdSaveTier",                                                                                                                                                                                                                          
			// 			});                                                                                                                                                                                                                                                   
			// 	}                                                                                                                                                                                                                                                       
			// }                                                                                                                                                                                                                                                        
			// let adataDelete = this.getOwnerComponent().getModel("deleteModel").getData();                                                                                                                                                                            
			// for (var i = 0; i < adataDelete.length; i++) {                                                                                                                                                                                                           
			// 	let sDeleteServiceURL = "/xEY1xSAV_C_TIERS(CountryKey='" + adataDelete[i].CountryKey + "',FiscalYear='" + adataDelete[i].FiscalYear +                                                                                                                   
			// 		"',Sequence='" + adataDelete[i].Sequence + "')"                                                                                                                                                                                                        
			// 	oServiceCallModel.remove(sDeleteServiceURL, {                                                                                                                                                                                                           
			// 		groupId: "groupIdSaveTier"                                                                                                                                                                                                                             
			// 	});                                                                                                                                                                                                                                                     
			// }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			// --------------> Generate Change Sets ----- Code STARTS  <--------------                                                                                                                                                                                  
			if (aModelData.length > aOriginalData.length) {                                                                                                                                                                                                             
				// -----------------CREATE or EDIT or BOTH-----------------                                                                                                                                                                                                
				// ---------------WAY 1-------------------                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
				// Search in Table, where entries dont match. EDIT                                                                                                                                                                                                         
				let aEditedEntries = aModelData.filter(item =>                                                                                                                                                                                                             
					aOriginalData.filter(elm => parseInt(elm.Sequence, [10]) === parseInt(item.Sequence, [10]) && elm.CountryKey === item.CountryKey &&                                                                                                                       
						elm.FiscalYear === item.FiscalYear && elm.Intention === item.Intention && (elm.TaxRate !== item.TaxRate || elm.TierAmount !==                                                                                                                            
							item.TierAmount)).length > 0);                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				// EDIT Batch (If editing is done)                                                                                                                                                                                                                         
				if (aEditedEntries.length > 0) {                                                                                                                                                                                                                           
					for (var i = 0; i < aEditedEntries.length; i++) {                                                                                                                                                                                                         
						let sEditServiceURL = "/xEY1xSAV_C_TIERS(CountryKey='" + aEditedEntries[i].CountryKey + "',FiscalYear='" + aEditedEntries[i].FiscalYear +                                                                                                                
							"',Intention='" + aEditedEntries[i].Intention + "',Sequence='" + aEditedEntries[i].Sequence + "')";                                                                                                                                                     
						oServiceCallModel.update(sEditServiceURL,                                                                                                                                                                                                                
							aEditedEntries[i], {                                                                                                                                                                                                                                    
								groupId: "groupIdSaveTier"                                                                                                                                                                                                                             
							}                                                                                                                                                                                                                                                       
						);                                                                                                                                                                                                                                                       
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				let aCreatedEntries = aModelData.filter(item => aOriginalData.filter(elm => elm.CountryKey === item.CountryKey && elm.FiscalYear ===                                                                                                                       
						item.FiscalYear && elm.Intention === item.Intention && parseInt(elm.Sequence, [10]) === parseInt(item.Sequence, [10])).length ===                                                                                                                        
					0);                                                                                                                                                                                                                                                       
				// aModelData.filter(item => !aOriginalData.map(elm => elm.Sequence).includes(item.Sequence));                                                                                                                                                             
				// CREATE Batch                                                                                                                                                                                                                                            
				if (aCreatedEntries.length > 0) {                                                                                                                                                                                                                          
					for (var iEntry = 0; iEntry < aCreatedEntries.length; iEntry++) {                                                                                                                                                                                         
						oServiceCallModel.create("/xEY1xSAV_C_TIERS", aCreatedEntries[iEntry], {                                                                                                                                                                                 
							groupId: "groupIdSaveTier"                                                                                                                                                                                                                              
						});                                                                                                                                                                                                                                                      
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				// ---------------Simpler Version-------------------                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
				// Match Keys of Table Data (more entries) with Original Data (less entries).                                                                                                                                                                              
				// for (var i = 0; i < aModelData.length; i++) {                                                                                                                                                                                                           
				// 	for (var j = 0; j < aOriginalData.length; j++) {                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
				// 		// If KEYS match but data does not.                                                                                                                                                                                                                   
				// 		if (aModelData[i].CountryKey === aOriginalData[j].CountryKey && aModelData[i].FiscalYear === aOriginalData[j].FiscalYear &&                                                                                                                           
				// 			aModelData[i].Sequence === aOriginalData[j].Sequence && (aModelData[i].TierAmount !== aOriginalData[j].TierAmount ||                                                                                                                                 
				// 				aModelData[i].TaxRate !== aOriginalData[j].TaxRate)) {                                                                                                                                                                                              
				// 			// Service call                                                                                                                                                                                                                                      
				// 			oServiceCallModel.update("/xEY1xSAV_C_TIERS(CountryKey='GB',FiscalYear='" + aModelData[i].FiscalYear + "',Sequence='" +                                                                                                                              
				// 				aModelData[i].Sequence + "')",                                                                                                                                                                                                                      
				// 				aModelData[i], {                                                                                                                                                                                                                                    
				// 					groupId: "groupIdSaveTier"                                                                                                                                                                                                                         
				// 				}                                                                                                                                                                                                                                                   
				// 			);                                                                                                                                                                                                                                                   
				// 		}                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
				// 		if (!(aModelData[i].CountryKey === aOriginalData[j].CountryKey && aModelData[i].FiscalYear === aOriginalData[j].FiscalYear &&                                                                                                                         
				// 				aModelData[i].Sequence === aOriginalData[j].Sequence)) {                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
				// 			// IF KEYS of table entry don't match in original data - It's created new - Trigger Create                                                                                                                                                           
				// 			oServiceCallModel.create("/xEY1xSAV_C_TIERS", aModelData[i], {                                                                                                                                                                                       
				// 				groupId: "groupIdSaveTier"                                                                                                                                                                                                                          
				// 			});                                                                                                                                                                                                                                                  
				// 		}                                                                                                                                                                                                                                                     
				// 	}                                                                                                                                                                                                                                                      
				// }                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			} else if (aModelData.length === aOriginalData.length) { // ---------------------EDIT-------------------------                                                                                                                                              
				// let aEditArray = []; // Not used - just for verification purpose&nbsp;                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
				// If any entry does not matches original data (means its updated), GENERATE edit Batch                                                                                                                                                                    
				for (var i = 0; i < aModelData.length; i++) {                                                                                                                                                                                                              
					for (var j = 0; j < aOriginalData.length; j++) {                                                                                                                                                                                                          
						if (aModelData[i].CountryKey === aOriginalData[j].CountryKey && aModelData[i].FiscalYear === aOriginalData[j].FiscalYear &&                                                                                                                              
							aModelData[i].Intention === aOriginalData[j].Intention &&                                                                                                                                                                                               
							parseInt(aModelData[i].Sequence, [10]) === parseInt(aOriginalData[j].Sequence, [10]) && (aModelData[i].TierAmount !==                                                                                                                                   
								aOriginalData[j].TierAmount ||                                                                                                                                                                                                                         
								aModelData[i].TaxRate !== aOriginalData[j].TaxRate)) {                                                                                                                                                                                                 
							// aEditArray.push(aModelData[i]); // Not used - just for verification purpose&nbsp;                                                                                                                                                                    
                                                                                                                                                                                                                                                               
							// Service call                                                                                                                                                                                                                                         
							oServiceCallModel.update("/xEY1xSAV_C_TIERS(CountryKey='" + aModelData[i].CountryKey + "',FiscalYear='" + aModelData[i].FiscalYear +                                                                                                                    
								"',Intention='" + aModelData[i].Intention + "',Sequence='" + aModelData[i].Sequence + "')",                                                                                                                                                            
								aModelData[i], {                                                                                                                                                                                                                                       
									groupId: "groupIdSaveTier"                                                                                                                                                                                                                            
								}                                                                                                                                                                                                                                                      
							);                                                                                                                                                                                                                                                      
						}                                                                                                                                                                                                                                                        
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				// let aTestVerifyArray = aEditArray; // Not used - just for verification purpose&nbsp;                                                                                                                                                                    
                                                                                                                                                                                                                                                               
			} else if (aModelData.length < aOriginalData.length) {                                                                                                                                                                                                      
				// ---------------------------DELETE or EDIT or BOTH                                                                                                                                                                                                       
				//************* Filter on Array - 'aModelData'(Table Data) & Original Data                                                                                                                                                                                 
				//************* Comparison is done using Stringified JSON - Make sure to have same sequencing                                                                                                                                                              
                                                                                                                                                                                                                                                               
				// ---------------------- Way 1	-----------------------------------                                                                                                                                                                                        
				// Search in original array (original data is Big) - Gives all modified entries                                                                                                                                                                            
				let aEditedEntries = aModelData.filter(item =>                                                                                                                                                                                                             
					aOriginalData.filter(elm => parseInt(elm.Sequence, [10]) === parseInt(item.Sequence, [10]) && elm.CountryKey === item.CountryKey &&                                                                                                                       
						elm.FiscalYear === item.FiscalYear && elm.Intention === item.Intention && (elm.TaxRate !== item.TaxRate || elm.TierAmount !==                                                                                                                            
							item.TierAmount)).length > 0);                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				// Batch for EDIT - If entries available                                                                                                                                                                                                                   
				if (aEditedEntries.length > 0) {                                                                                                                                                                                                                           
					for (var i = 0; i < aEditedEntries.length; i++) {                                                                                                                                                                                                         
						let sEditServiceURL = "/xEY1xSAV_C_TIERS(CountryKey='" + aEditedEntries[i].CountryKey + "',FiscalYear='" + aEditedEntries[i].FiscalYear +                                                                                                                
							"',Intention='" + aEditedEntries[i].Intention +                                                                                                                                                                                                         
							"',Sequence='" + aEditedEntries[i].Sequence + "')";                                                                                                                                                                                                     
						oServiceCallModel.update(sEditServiceURL,                                                                                                                                                                                                                
							aEditedEntries[i], {                                                                                                                                                                                                                                    
								groupId: "groupIdSaveTier"                                                                                                                                                                                                                             
							}                                                                                                                                                                                                                                                       
						);                                                                                                                                                                                                                                                       
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				let aDeletedEntries = aOriginalData.filter(item =>                                                                                                                                                                                                         
					aModelData.filter(elm => parseInt(elm.Sequence, [10]) === parseInt(item.Sequence, [10]) && elm.CountryKey === item.CountryKey &&                                                                                                                          
						elm.FiscalYear === item.FiscalYear && elm.Intention === item.Intention).length === 0);                                                                                                                                                                   
				// aOriginalData.filter(item => !aModelData.map(elm => elm.Sequence).includes(item.Sequence));                                                                                                                                                             
				// Batch for DELETE                                                                                                                                                                                                                                        
				if (aDeletedEntries.length > 0) {                                                                                                                                                                                                                          
					for (var i = 0; i < aDeletedEntries.length; i++) {                                                                                                                                                                                                        
						let sDeleteServiceURL = "/xEY1xSAV_C_TIERS(CountryKey='" + aDeletedEntries[i].CountryKey + "',FiscalYear='" + aDeletedEntries[i]                                                                                                                         
							.FiscalYear + "',Intention='" + aDeletedEntries[i].Intention +                                                                                                                                                                                          
							"',Sequence='" + aDeletedEntries[i].Sequence + "')";                                                                                                                                                                                                    
						oServiceCallModel.remove(sDeleteServiceURL, {                                                                                                                                                                                                            
							groupId: "groupIdSaveTier"                                                                                                                                                                                                                              
						});                                                                                                                                                                                                                                                      
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				// ---------------------- Simpler Implementation	-----------------------------------                                                                                                                                                                       
				// Match Keys of Table Data (more entries) with Original Data (less entries).                                                                                                                                                                              
				// for (var i = 0; i < aOriginalData.length; i++) {                                                                                                                                                                                                        
				// 	for (var j = 0; j < aModelData.length; j++) {                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				// 		// If KEYS match but data does not.                                                                                                                                                                                                                   
				// 		if (aOriginalData[i].CountryKey === aModelData[j].CountryKey && aOriginalData[i].FiscalYear === aModelData[j].FiscalYear &&                                                                                                                           
				// 			aOriginalData[i].Sequence === aModelData[j].Sequence && (aOriginalData[i].TierAmount !== aModelData[j].TierAmount ||                                                                                                                                 
				// 				aOriginalData[i].TaxRate !== aModelData[j].TaxRate)) {                                                                                                                                                                                              
				// 			// Service call - EDIT                                                                                                                                                                                                                               
				// 			oServiceCallModel.update("/xEY1xSAV_C_TIERS(CountryKey='GB',FiscalYear='" + aModelData[i].FiscalYear + "',Sequence='" +                                                                                                                              
				// 				aModelData[i].Sequence + "')",                                                                                                                                                                                                                      
				// 				aModelData[i], {                                                                                                                                                                                                                                    
				// 					groupId: "groupIdSaveTier"                                                                                                                                                                                                                         
				// 				}                                                                                                                                                                                                                                                   
				// 			);                                                                                                                                                                                                                                                   
				// 		}                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
				// 		if (!(aOriginalData[i].CountryKey === aModelData[j].CountryKey && aOriginalData[i].FiscalYear === aModelData[j].FiscalYear &&                                                                                                                         
				// 				aOriginalData[i].Sequence === aModelData[j].Sequence)) {                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
				// 			let sDeleteServiceURL = "/xEY1xSAV_C_TIERS(CountryKey='" + aOriginalData[i].CountryKey + "',FiscalYear='" + aOriginalData[i]                                                                                                                         
				// 				.FiscalYear +                                                                                                                                                                                                                                       
				// 				"',Sequence='" + aOriginalData[i].Sequence + "')";                                                                                                                                                                                                  
				// 			oServiceCallModel.remove(sDeleteServiceURL, {                                                                                                                                                                                                        
				// 				groupId: "groupIdSaveTier"                                                                                                                                                                                                                          
				// 			});                                                                                                                                                                                                                                                  
				// 		}                                                                                                                                                                                                                                                     
				// 	}                                                                                                                                                                                                                                                      
				// }                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			} else {                                                                                                                                                                                                                                                    
				let oView = this.getView();                                                                                                                                                                                                                                
				oView.getModel("deleteModel").setData([]);                                                                                                                                                                                                                 
				oView.getModel("editTierModel").setProperty("/edit", false);                                                                                                                                                                                               
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			// --------------> Generate Change Sets ----- Code ENDS  <--------------                                                                                                                                                                                    
			// ------------------------------------------------------------------------------------------------                                                                                                                                                         
                                                                                                                                                                                                                                                               
			//	---------	SUBMIT CHANGES	---------------------                                                                                                                                                                                                           
			oServiceCallModel.submitChanges({                                                                                                                                                                                                                           
				groupId: "groupIdSaveTier",                                                                                                                                                                                                                                
				success: function (oData, response) {                                                                                                                                                                                                                      
					////////////////////////message popover handle//////////////////////////////////                                                                                                                                                                          
                                                                                                                                                                                                                                                               
					// let oMsgModel = that.getView().getModel("message");                                                                                                                                                                                                    
					// oMsgModel.setData(oSapUiCore.getMessageManager().getMessageModel().getData());                                                                                                                                                                         
					// oMsgModel.refresh();                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
					//that.getView().byId("idMessagePopoverBtn").firePress();                                                                                                                                                                                                 
					//	that.getView().byId("idMessagePopoverBtn").onAfterRendering = function () {                                                                                                                                                                            
					///		sap.ui.getCore().byId("idMessagePopoverBtn").firePress();                                                                                                                                                                                            
					// your stuff                                                                                                                                                                                                                                             
					//	};                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
					// that.oIntervalCall = window.setInterval(function (e) {                                                                                                                                                                                                 
					// 	that.oMessagePopover.openBy(that.getView().byId("idMessagePopoverBtn"));                                                                                                                                                                              
					// 	window.clearInterval(that.oIntervalCall);                                                                                                                                                                                                             
					// }.bind(this), 100);                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
					////////////////////////message popover handle//////////////////////////////////                                                                                                                                                                          
                                                                                                                                                                                                                                                               
					let oChangeResponses;                                                                                                                                                                                                                                     
					// If no service call is sent.                                                                                                                                                                                                                            
					if (!oData.__batchResponses) {                                                                                                                                                                                                                            
						that._setScreenToDisplayMode();                                                                                                                                                                                                                          
						return;                                                                                                                                                                                                                                                  
					}                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
					// If No response is received.                                                                                                                                                                                                                            
					oChangeResponses = oData.__batchResponses[0].__changeResponses;                                                                                                                                                                                           
					if (!oChangeResponses || oChangeResponses.length <= 0) {                                                                                                                                                                                                  
						that._setScreenToDisplayMode();                                                                                                                                                                                                                          
						return;                                                                                                                                                                                                                                                  
					}                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
					let oOverAllResponse = JSON.parse(oChangeResponses.find(item => item.headers["sap-message"]).headers["sap-message"]);                                                                                                                                     
					// let oChangeRespData = oChangeResponses[0].data;                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
					//	If header response is available & is success                                                                                                                                                                                                           
					if (oOverAllResponse && oOverAllResponse.severity.toUpperCase() === "SUCCESS") {                                                                                                                                                                          
						// MessageToast.show(oOverAllResponse.message);                                                                                                                                                                                                          
						MessageToast.show(that.getI18nText("genericMsgBatchSuccess"));                                                                                                                                                                                           
						that._setScreenToDisplayMode();                                                                                                                                                                                                                          
					} else if (oOverAllResponse && oOverAllResponse.message) { // If header response is available but other than success.                                                                                                                                     
						// MessageBox.error(oOverAllResponse.message);                                                                                                                                                                                                           
						MessageToast.show(that.getI18nText("genericMsgBatchError"));                                                                                                                                                                                             
					}                                                                                                                                                                                                                                                         
					// If No response - default framework error to occur                                                                                                                                                                                                      
				},                                                                                                                                                                                                                                                         
				error: function (oError) {                                                                                                                                                                                                                                 
					that._setScreenToDisplayMode();                                                                                                                                                                                                                           
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	--------------- Press event for Cancel Button -------------------                                                                                                                                                                                         
		onPressCancelTier: function () {                                                                                                                                                                                                                             
			let oView = this.getView(),                                                                                                                                                                                                                                 
				oTable = oView.byId("idTiersTable");                                                                                                                                                                                                                       
			oView.getModel("deleteModel").setData([]);                                                                                                                                                                                                                  
			oView.getModel("editTierModel").setProperty("/edit", false);                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			// oTable.getModel("tiersTableModel").setData({});                                                                                                                                                                                                          
			oTable.getModel("tiersTableModel").setData({                                                                                                                                                                                                                
				results: jQuery.extend(true, [], this._getOriginalTiersData().getData())                                                                                                                                                                                   
			});                                                                                                                                                                                                                                                         
			oTable.removeSelections();                                                                                                                                                                                                                                  
			this._closeMessagePopovers();                                                                                                                                                                                                                               
			this._clearMessagesPopover();                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	--------------- Press event for Message Popover Button -------------------                                                                                                                                                                                
		onPressHandleMessagePopover: function (oEvent) {                                                                                                                                                                                                             
			// open popover                                                                                                                                                                                                                                             
			// this.oMessagePopover.toggle(oEvent.getSource());                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onChangeTierAmountFragment: function (oEvent) {                                                                                                                                                                                                              
			this._setUpdatedFragmentAmount(oEvent, "TierAmount");                                                                                                                                                                                                       
			//	this._validateInvalidEntry(oEvent);                                                                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onChangeTaxRateFragment: function (oEvent) {                                                                                                                                                                                                                 
			this._setUpdatedFragmentAmount(oEvent, "TaxRate");                                                                                                                                                                                                          
			//	this._validateInvalidEntry(oEvent, "TaxRate");                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onChangeIntention: function () {                                                                                                                                                                                                                             
			let oSmartFilterBar = this.getView().byId("idSmartFilterBar"),                                                                                                                                                                                              
				bValid = oSmartFilterBar.validateMandatoryFields();                                                                                                                                                                                                        
			if (bValid) {                                                                                                                                                                                                                                               
				let oSelectedItem = this.getView().byId("idIntentionComboBox").getSelectedItem(),                                                                                                                                                                          
					oSelectedData = oSelectedItem.getBindingContext("intentionVHModel").getObject();                                                                                                                                                                          
				this._manageIntentionStatus(oSelectedData);                                                                                                                                                                                                                
				oSmartFilterBar.fireSearch();                                                                                                                                                                                                                              
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//triggered on press of roll over button&nbsp;                                                                                                                                                                                                               
		onPressRollOver: function (oEvent) {                                                                                                                                                                                                                         
			let oView = this.getView(),                                                                                                                                                                                                                                 
				sIntention = oView.byId("idIntentionComboBox").getSelectedKey(),                                                                                                                                                                                           
				aIntentionVal = oView.getModel("intentionVHModel").getData().results,                                                                                                                                                                                      
				iIndexInt = aIntentionVal.findIndex(item => item.Intent === sIntention),                                                                                                                                                                                   
				//get all the intention values except the one selected by the user                                                                                                                                                                                         
				aRollIntentions = aIntentionVal.slice(iIndexInt + 1),                                                                                                                                                                                                      
				oServiceCallModel = this.getOwnerComponent().getModel(),                                                                                                                                                                                                   
				iFiscalYrVal = oView.byId("idFilterFiscalYear").getValue(),                                                                                                                                                                                                
				sCountryVal = oView.byId("idFilterCountryCode").getSelectedItem().getBindingContext().getObject().Country,                                                                                                                                                 
				that = this,                                                                                                                                                                                                                                               
				aDelTiers = [],                                                                                                                                                                                                                                            
				oPromise,                                                                                                                                                                                                                                                  
				oMandFilters = new Filter({                                                                                                                                                                                                                                
					filters: [new Filter("CountryKey", FilterOperator.EQ, sCountryVal),                                                                                                                                                                                       
						new Filter("FiscalYear", FilterOperator.EQ, iFiscalYrVal)                                                                                                                                                                                                
					],                                                                                                                                                                                                                                                        
					and: true                                                                                                                                                                                                                                                 
				});                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			//creation of change group for roll back functionality                                                                                                                                                                                                      
			oServiceCallModel.setUseBatch(true);                                                                                                                                                                                                                        
			oServiceCallModel.setChangeGroups({                                                                                                                                                                                                                         
				"/SAV_MANAGE_TIER_SRV": {                                                                                                                                                                                                                                  
					groupId: "groupIdRollOver",                                                                                                                                                                                                                               
					changeSetId: "ID",                                                                                                                                                                                                                                        
					single: false                                                                                                                                                                                                                                             
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			oServiceCallModel.setDeferredGroups(oServiceCallModel.getDeferredGroups().concat(["groupIdRollOver"]));                                                                                                                                                     
                                                                                                                                                                                                                                                               
			if (aRollIntentions.length > 0) {                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
				//read call in order to get data for all the intentions                                                                                                                                                                                                    
				oServiceCallModel.read("/xEY1xSAV_C_TIERS", {                                                                                                                                                                                                              
					filters: [oMandFilters],                                                                                                                                                                                                                                  
					sorters: [                                                                                                                                                                                                                                                
						new sap.ui.model.Sorter("Sequence")                                                                                                                                                                                                                      
					],                                                                                                                                                                                                                                                        
					method: "GET",                                                                                                                                                                                                                                            
					success: function (oData) {                                                                                                                                                                                                                               
						// form an array of tiers for intentions which need to be rolled over&nbsp;                                                                                                                                                                              
						aRollIntentions.map(y => {                                                                                                                                                                                                                               
							oData.results.map(x => {                                                                                                                                                                                                                                
								if (x.Intention === y.Intent) {                                                                                                                                                                                                                        
									aDelTiers.push(x);                                                                                                                                                                                                                                    
								}                                                                                                                                                                                                                                                      
							});                                                                                                                                                                                                                                                     
						});                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
						if (aDelTiers.length > 0) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
							/*Delete batch call for  tiers to be deleted                                                                                                                                                                                                            
							once promise is resolved create call to be executed.*/                                                                                                                                                                                                  
							oPromise = that._serviceCallDeleteTiers(aDelTiers, aRollIntentions);                                                                                                                                                                                    
							oPromise.then(function (dSuccess) {                                                                                                                                                                                                                     
									//success function for promise                                                                                                                                                                                                                        
									that._sServiceCreateTiers(aRollIntentions);                                                                                                                                                                                                           
								},                                                                                                                                                                                                                                                     
								function (dError) {                                                                                                                                                                                                                                    
									//error function for promise                                                                                                                                                                                                                          
									MessageBox.error(that.getI18nText("genericMsgBatchRollOverError"));                                                                                                                                                                                   
								});                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
						} else {                                                                                                                                                                                                                                                 
							//in case intentions to be rolled over do not have any tiers , then directly create tiers for them.                                                                                                                                                     
							that._sServiceCreateTiers(aRollIntentions);                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
						}                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
					},                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
					error: function (oError) {                                                                                                                                                                                                                                
						MessageBox.error(that.getI18nText("TierGetServiceCallError"));                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			} else {                                                                                                                                                                                                                                                    
				MessageBox.error(that.getI18nText("errorMsgInvalidIntention"));                                                                                                                                                                                            
			}                                                                                                                                                                                                                                                           
		}                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            