sap.ui.define([                                                                                                                                                                                                                                                
	"./BaseController",                                                                                                                                                                                                                                           
	"sap/m/Dialog",                                                                                                                                                                                                                                               
	"sap/ui/model/json/JSONModel",                                                                                                                                                                                                                                
	"sap/ui/core/library",                                                                                                                                                                                                                                        
	"sap/m/MessagePopover",                                                                                                                                                                                                                                       
	"sap/m/MessageItem",                                                                                                                                                                                                                                          
	"sap/m/MessageToast",                                                                                                                                                                                                                                         
	"sap/m/MessageBox",                                                                                                                                                                                                                                           
	"sap/ui/model/Filter",                                                                                                                                                                                                                                        
	"sap/ui/model/FilterOperator",                                                                                                                                                                                                                                
	"sap/ui/core/routing/History",                                                                                                                                                                                                                                
	"sap/ui/generic/app/navigation/service/NavigationHandler"                                                                                                                                                                                                     
], function (BaseController, Dialog, JSONModel, coreLibrary, MessagePopover, MessageItem, MessageToast, MessageBox, Filter,                                                                                                                                    
	FilterOperator, History, NavigationHandler) {                                                                                                                                                                                                                 
	"use strict";                                                                                                                                                                                                                                                 
	let oSapUiCore = sap.ui.getCore();                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
	return BaseController.extend("ey.sap.fin.cs.intentionmanagement.controller.intention", {                                                                                                                                                                      
		onInit: function () {                                                                                                                                                                                                                                        
			let oView = this.getView();                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
			//initialize router                                                                                                                                                                                                                                         
			this.oRouter = this.getOwnerComponent().getRouter();                                                                                                                                                                                                        
			this.oRouter.getRoute("Targetintention").attachMatched(this._onRouteMatched, this);                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			// Type - Boolean --> Flag to check if SAVE is allowed.                                                                                                                                                                                                     
			this.bAllEntriesValidated = true;                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			// Type - Boolean --> Flag to check if SAVE is allowed for period.                                                                                                                                                                                          
			this.bPerValidate = true;                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
			//Row Model for add/edit dialog/fragment                                                                                                                                                                                                                    
			let oRowModel = new JSONModel();                                                                                                                                                                                                                            
			this.setModel(oRowModel, "oRowModel");                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
			//Period Row Model for edit dialog/fragment                                                                                                                                                                                                                 
			let oPerRowModel = new JSONModel();                                                                                                                                                                                                                         
			this.setModel(oPerRowModel, "oPerRowModel");                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			//drop down model for intention values while editing/creating                                                                                                                                                                                               
			let oEditIntntModel = new JSONModel();                                                                                                                                                                                                                      
			this.setModel(oEditIntntModel, "oModelEditItentn");                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			this.oMP = null;                                                                                                                                                                                                                                            
			this.oDataMonitorData = [];                                                                                                                                                                                                                                 
			this.oJSONDMData = [];                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
			oView.byId("idIntentionsTable").setSticky(["ColumnHeaders", "HeaderToolbar"])                                                                                                                                                                               
			oView.byId("idPeriodTable").setSticky(["ColumnHeaders", "HeaderToolbar"])                                                                                                                                                                                   
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* internal methods  -PRIVATE                                  */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		_onRouteMatched: function (oEvent) {                                                                                                                                                                                                                         
			this._getAuthData();                                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
		//	-------------------	Set Intentions Original Data	----------------------                                                                                                                                                                                   
		_setOriginalIntentionData: function (oData) {                                                                                                                                                                                                                
			let aDeepCopy = jQuery.extend(true, [], oData.results);                                                                                                                                                                                                     
			aDeepCopy.map(item => delete item.__metadata);                                                                                                                                                                                                              
			this.getView().setModel(new JSONModel(aDeepCopy), "modelOriginalIntentionData");                                                                                                                                                                            
		},                                                                                                                                                                                                                                                           
		//	-------------------	Get Intentions Original Data	----------------------                                                                                                                                                                                   
		_getOriginalIntentionData: function () {                                                                                                                                                                                                                     
			return this.getView().getModel("modelOriginalIntentionData");                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		_getAuthData: function () {                                                                                                                                                                                                                                  
			let that = this,                                                                                                                                                                                                                                            
				oServiceCallModel = this.getOwnerComponent().getModel();                                                                                                                                                                                                   
			this.getBusyDialog().open();                                                                                                                                                                                                                                
			oServiceCallModel.read("/AUTHSet", {                                                                                                                                                                                                                        
				method: "GET",                                                                                                                                                                                                                                             
				success: function (oData) {                                                                                                                                                                                                                                
					that.getBusyDialog().close();                                                                                                                                                                                                                             
					that.getView().setModel(new JSONModel(oData.results[0]), "authModel");                                                                                                                                                                                    
					console.log(oData);                                                                                                                                                                                                                                       
				},                                                                                                                                                                                                                                                         
				error: function (oError) {                                                                                                                                                                                                                                 
					that.getBusyDialog().close();                                                                                                                                                                                                                             
					MessageBox.error(that.getI18nText("errorFetchingAuthData"));                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_fetchIntentionsData: function () {                                                                                                                                                                                                                          
			//Fetch table data&nbsp;                                                                                                                                                                                                                                    
			let oView = this.getView(),                                                                                                                                                                                                                                 
				oServiceCallModel = this.getOwnerComponent().getModel(),                                                                                                                                                                                                   
				oIntentionsTable = oView.byId("idIntentionsTable"),                                                                                                                                                                                                        
				oAddIntentBtn = oView.byId("idAddIntentBtn"),                                                                                                                                                                                                              
				that = this,                                                                                                                                                                                                                                               
				oYrFilters,                                                                                                                                                                                                                                                
				sConsKey = oView.byId("idConsUnit").getSelectedKey(),                                                                                                                                                                                                      
				aFilterMand = [new Filter("Bunit", FilterOperator.EQ, sConsKey)];                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			if (oView.byId("idSmartFilterBar").getFilters().length > 0) {                                                                                                                                                                                               
				oYrFilters = oView.byId("idSmartFilterBar").getFilters()[0].aFilters;                                                                                                                                                                                      
			} else {                                                                                                                                                                                                                                                    
				oYrFilters = []                                                                                                                                                                                                                                            
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			let oAllFilters = new Filter({                                                                                                                                                                                                                              
				filters: [...aFilterMand, ...oYrFilters],                                                                                                                                                                                                                  
				and: true                                                                                                                                                                                                                                                  
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			this.getBusyDialog().open();                                                                                                                                                                                                                                
			//enable add button on click of go                                                                                                                                                                                                                          
			oAddIntentBtn.setEnabled(true);                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			oServiceCallModel.read("/IntentionsSet", {                                                                                                                                                                                                                  
				filters: [oAllFilters],                                                                                                                                                                                                                                    
				method: "GET",                                                                                                                                                                                                                                             
				success: function (oData) {                                                                                                                                                                                                                                
					that.getBusyDialog().close();                                                                                                                                                                                                                             
					console.log(oData);                                                                                                                                                                                                                                       
					// for (let i = 0; i < oData.results.length; i++) {                                                                                                                                                                                                       
					// 	oData.results[i].edit = false;                                                                                                                                                                                                                        
					// 	oData.results[i].active = false;                                                                                                                                                                                                                      
					// }                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
					oData.results.map(itm => itm.bCreated = false);                                                                                                                                                                                                           
					// let aTaxAudData = oData.results.filter(item => item.SeqnrFlb === "09");                                                                                                                                                                                
					// if (aTaxAudData.length > 0) {                                                                                                                                                                                                                          
					// 	oIntentionsTable.getColumns()[3].setVisible(true);                                                                                                                                                                                                    
					// } else {                                                                                                                                                                                                                                               
					// 	oIntentionsTable.getColumns()[3].setVisible(false);                                                                                                                                                                                                   
					// }                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
					oIntentionsTable.setModel(new JSONModel(oData), "intentionsTableModel");                                                                                                                                                                                  
					that.getView().byId("idPeriodTable").setModel(new JSONModel(oData), "periodTableModel");                                                                                                                                                                  
					oIntentionsTable.getModel("intentionsTableModel").setDefaultBindingMode("TwoWay");                                                                                                                                                                        
					that.getView().byId("idHeadText").setText(that.getResourceBundle().getText("intentionsTableTitle", [oData.results.length]));                                                                                                                              
					// Create Deep Copy for Original Data - Required for Final Save                                                                                                                                                                                           
					that._setOriginalIntentionData(oData);                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
					//that._disableClosedFI(oData.results);                                                                                                                                                                                                                   
				},                                                                                                                                                                                                                                                         
				error: function (oError) {                                                                                                                                                                                                                                 
					that.getBusyDialog().close();                                                                                                                                                                                                                             
					MessageBox.error(that.getI18nText("IntentionGetServiceCallError"));                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		_disableClosedFI: function (aData) {                                                                                                                                                                                                                         
			let oView = this.getView(),                                                                                                                                                                                                                                 
				oIntentionsTable = oView.byId("idIntentionsTable");                                                                                                                                                                                                        
			oIntentionsTable.getItems().forEach(function (r) {                                                                                                                                                                                                          
				let obj = r.getBindingContext("intentionsTableModel").getObject(),                                                                                                                                                                                         
					bFlag = obj.IntnsnActFlg,                                                                                                                                                                                                                                 
					rb = r.$().find('.sapMRb'),                                                                                                                                                                                                                               
					oRb = sap.ui.getCore().byId(rb.attr('id'));                                                                                                                                                                                                               
				if (bFlag) {                                                                                                                                                                                                                                               
					oRb.setEnabled(false);                                                                                                                                                                                                                                    
					oRb.setEditable(false);                                                                                                                                                                                                                                   
				} else {                                                                                                                                                                                                                                                   
					oRb.setEnabled(true);                                                                                                                                                                                                                                     
					oRb.setEditable(true);                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			})                                                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//fetch next intentions value....when a particular intention is edited.                                                                                                                                                                                      
		_fetchIntentionEditCB: function (sYear, sIntent, sPeriodTo) {                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			let oServiceCallModel = this.getModel(),                                                                                                                                                                                                                    
				sServiceURL = "/IntentionValuesSet",                                                                                                                                                                                                                       
				that = this,                                                                                                                                                                                                                                               
				oView = this.getView(),                                                                                                                                                                                                                                    
				oMandFilters = new Filter({                                                                                                                                                                                                                                
					filters: [new Filter("Gjahr", FilterOperator.EQ, sYear),                                                                                                                                                                                                  
						new Filter("Intention", FilterOperator.EQ, sIntent),                                                                                                                                                                                                     
						new Filter("PeriodTo", FilterOperator.EQ, sPeriodTo)                                                                                                                                                                                                     
					],                                                                                                                                                                                                                                                        
					and: true                                                                                                                                                                                                                                                 
				});                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			this.getBusyDialog().open();                                                                                                                                                                                                                                
			oServiceCallModel.read(sServiceURL, {                                                                                                                                                                                                                       
				method: "GET",                                                                                                                                                                                                                                             
				filters: [oMandFilters],                                                                                                                                                                                                                                   
				success: function (oData, oResponse) {                                                                                                                                                                                                                     
					that.getBusyDialog().close();                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
					//dropdown values for the intention which is being edited                                                                                                                                                                                                 
					that.getModel("oModelEditItentn").setData([]);                                                                                                                                                                                                            
					that.getModel("oModelEditItentn").setData(oData.results)                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
				},                                                                                                                                                                                                                                                         
				error: function (oError) {                                                                                                                                                                                                                                 
					that.getBusyDialog().close();                                                                                                                                                                                                                             
					MessageToast.show(that.getI18nText("errorFetchingIntentions"));                                                                                                                                                                                           
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	-------------------	Change screen to Display Mode (Reset Screen)	----------------------                                                                                                                                                                   
		_setScreenToDisplayMode: function () {                                                                                                                                                                                                                       
			let oView = this.getView();                                                                                                                                                                                                                                 
			this._fetchIntentionsData();                                                                                                                                                                                                                                
			oView.byId("idOverflowToolbar").setVisible(false);                                                                                                                                                                                                          
			oView.byId("idAddIntentBtn").setEnabled(true);                                                                                                                                                                                                              
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_getValidDataMsg: function (aValData) {                                                                                                                                                                                                                      
			let msg = "";                                                                                                                                                                                                                                               
			for (let i = 0; i < aValData.length; i++) {                                                                                                                                                                                                                 
				if (aValData[i] < 10) {                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
					if (i === aValData.length - 1) {                                                                                                                                                                                                                          
						msg = msg + " 00" + aValData[i];                                                                                                                                                                                                                         
					} else {                                                                                                                                                                                                                                                  
						msg = msg + " 00" + aValData[i] + ",";                                                                                                                                                                                                                   
					}                                                                                                                                                                                                                                                         
				} else {                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
					if (i === aValData.length - 1) {                                                                                                                                                                                                                          
						msg = msg + " 0" + aValData[i];                                                                                                                                                                                                                          
					} else {                                                                                                                                                                                                                                                  
						msg = msg + " 0" + aValData[i] + ",";                                                                                                                                                                                                                    
					}                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
			return msg;                                                                                                                                                                                                                                                 
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	-------------------	get i18n Texts	----------------------                                                                                                                                                                                                 
		getI18nText: function (sTextKey) {                                                                                                                                                                                                                           
			return this.getResourceBundle().getText(sTextKey);                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
		onConsUnitChange: function () {                                                                                                                                                                                                                              
			let oSmartFilterBar = this.getView().byId("idSmartFilterBar"),                                                                                                                                                                                              
				bValid = oSmartFilterBar.validateMandatoryFields();                                                                                                                                                                                                        
			if (bValid) {                                                                                                                                                                                                                                               
				oSmartFilterBar.fireSearch();                                                                                                                                                                                                                              
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	--------------- Press event for EDIT Toggle Button -------------------                                                                                                                                                                                    
		onPressEditToggleBtn: function (oEvent) {                                                                                                                                                                                                                    
			//open a dialog to edit an intention                                                                                                                                                                                                                        
			let oView = this.getView(),                                                                                                                                                                                                                                 
				that = this;                                                                                                                                                                                                                                               
			if (!this._oEditIntentionFragment) {                                                                                                                                                                                                                        
				this._oEditIntentionFragment = sap.ui.xmlfragment("editIntention",                                                                                                                                                                                         
					"ey.sap.fin.cs.intentionmanagement.fragment.editIntentionPopup", this);                                                                                                                                                                                   
				oView.addDependent(this._oEditIntentionFragment);                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
			this._oEditIntentionFragment.open();                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			if (oEvent.getSource().getTooltip() === "Edit Intention") {                                                                                                                                                                                                 
				oSapUiCore.byId("editIntention--idOkBtn").setText(that.getI18nText("updateIntentBtnText"));                                                                                                                                                                
				oSapUiCore.byId("editIntention--idTitleDialg").setText(that.getI18nText("editIntentionsDialogTitle"));                                                                                                                                                     
			} else {                                                                                                                                                                                                                                                    
				oSapUiCore.byId("editIntention--idOkBtn").setText(that.getI18nText("addIntentBtnText"));                                                                                                                                                                   
				oSapUiCore.byId("editIntention--idTitleDialg").setText(that.getI18nText("addIntentionsDialogTitle"));                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			//make save and cancel btn visible                                                                                                                                                                                                                          
			oView.byId("idOverflowToolbar").setVisible(true);                                                                                                                                                                                                           
			//	sap.ui.getCore().byId("editIntention--idDialog").setModel(oFragModel, "oFragModel");                                                                                                                                                                     
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onPressEditPeriod: function (oEvent) {                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			//open a dialog to edit an intention                                                                                                                                                                                                                        
			let oView = this.getView(),                                                                                                                                                                                                                                 
				that = this;                                                                                                                                                                                                                                               
			if (!this._oEditPeriodFragment) {                                                                                                                                                                                                                           
				this._oEditPeriodFragment = sap.ui.xmlfragment("editIntention",                                                                                                                                                                                            
					"ey.sap.fin.cs.intentionmanagement.fragment.editPeriodPopup", this);                                                                                                                                                                                      
				oView.addDependent(this._oEditPeriodFragment);                                                                                                                                                                                                             
			}                                                                                                                                                                                                                                                           
			this._oEditPeriodFragment.open();                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//on change event on editing an intention                                                                                                                                                                                                                    
		onChangeIntentionEdit: function (oEvent) {                                                                                                                                                                                                                   
			let oPeriodTo = oSapUiCore.byId("editIntention--IdPerTo"),                                                                                                                                                                                                  
				oMsgStrip = oSapUiCore.byId("editIntention--errorMsgStripId");                                                                                                                                                                                             
			oMsgStrip.setVisible(false);                                                                                                                                                                                                                                
			oSapUiCore.byId("editIntention--idDialog").setContentHeight("190px");                                                                                                                                                                                       
			oPeriodTo.setValueState("None");                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
			if (oEvent.getSource().getSelectedItem()) {                                                                                                                                                                                                                 
				oEvent.getSource().setValueState("None");                                                                                                                                                                                                                  
				let oSelectedData = oEvent.getSource().getSelectedItem().getBindingContext("oModelEditItentn").getObject();                                                                                                                                                
				if (oEvent.getSource().getSelectedKey() === "01") {                                                                                                                                                                                                        
					oPeriodTo.setValue("");                                                                                                                                                                                                                                   
					oPeriodTo.setEditable(true);                                                                                                                                                                                                                              
				} else {                                                                                                                                                                                                                                                   
					oPeriodTo.setValue(oSelectedData.PeriodTo);                                                                                                                                                                                                               
					oPeriodTo.setEditable(false);                                                                                                                                                                                                                             
				}                                                                                                                                                                                                                                                          
			} else {                                                                                                                                                                                                                                                    
				oEvent.getSource().setValueState("Error");                                                                                                                                                                                                                 
				oPeriodTo.setValue("");                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
				oPeriodTo.setEditable(false);                                                                                                                                                                                                                              
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		//validation on change of period to when editing an intention                                                                                                                                                                                                
		onChangePeriodTo: function (oEvent) {                                                                                                                                                                                                                        
			let sVal = parseInt(oEvent.getSource().getValue(), [10]),                                                                                                                                                                                                   
				aValData = this.getModel("oRowModel").getData().validate,                                                                                                                                                                                                  
				oMsgStrip = oSapUiCore.byId("editIntention--errorMsgStripId"),                                                                                                                                                                                             
				that = this,                                                                                                                                                                                                                                               
				sMsg = this._getValidDataMsg(aValData);                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
			if (aValData.indexOf(sVal) > -1) {                                                                                                                                                                                                                          
				oMsgStrip.setVisible(false);                                                                                                                                                                                                                               
				oSapUiCore.byId("editIntention--idDialog").setContentHeight("190px");                                                                                                                                                                                      
				oEvent.getSource().setValueState("None");                                                                                                                                                                                                                  
			} else {                                                                                                                                                                                                                                                    
				oMsgStrip.setVisible(true);                                                                                                                                                                                                                                
				oMsgStrip.setText(that.getI18nText("errorMsgPeriodTo") + sMsg);                                                                                                                                                                                            
				oSapUiCore.byId("editIntention--idDialog").setContentHeight("250px");                                                                                                                                                                                      
				oEvent.getSource().setValueState("Error");                                                                                                                                                                                                                 
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//error handling on year change...as year should be unique..while creating a new intentn for a yr                                                                                                                                                            
		onChangeYear: function (oEvent) {                                                                                                                                                                                                                            
			let oView = this.getView(),                                                                                                                                                                                                                                 
				aComparaData = this.getView().byId("idIntentionsTable").getModel("intentionsTableModel").getData().results,                                                                                                                                                
				that = this;                                                                                                                                                                                                                                               
			oView.byId("idOverflowToolbar").setVisible(true);                                                                                                                                                                                                           
			if (!oEvent.getSource().getValue()) {                                                                                                                                                                                                                       
				oEvent.getSource().setValueState("Error");                                                                                                                                                                                                                 
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
			//for loop for validation                                                                                                                                                                                                                                   
			let aDuplicatYr = aComparaData.filter(itm => itm.Gjahr === oEvent.getSource().getValue());                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			if (aDuplicatYr.length > 0) {                                                                                                                                                                                                                               
				oEvent.getSource().setValueState("Error");                                                                                                                                                                                                                 
				oEvent.getSource().setValueStateText(that.getI18nText("errorMsgInvalidYear"));                                                                                                                                                                             
			} else {                                                                                                                                                                                                                                                    
				oEvent.getSource().setValueState("None");                                                                                                                                                                                                                  
				oEvent.getSource().setValueStateText("");                                                                                                                                                                                                                  
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	--------------- Press event for Close Button - In Edit Period Fragment -------------------                                                                                                                                                                
		onPressClosePeriodDialog: function () {                                                                                                                                                                                                                      
			let oView = this.getView();                                                                                                                                                                                                                                 
			this._oEditPeriodFragment.close();                                                                                                                                                                                                                          
			oView.byId("idPeriodTable").removeSelections();                                                                                                                                                                                                             
			oView.byId("idEditPerdBtn").setEnabled(false);                                                                                                                                                                                                              
			this._oEditPeriodFragment.destroy();                                                                                                                                                                                                                        
			this._oEditPeriodFragment = undefined;                                                                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	--------------- Press event for Close Button - In Edit intention Fragment -------------------                                                                                                                                                             
		onPressCloseDialog: function () {                                                                                                                                                                                                                            
			let oView = this.getView();                                                                                                                                                                                                                                 
			this._oEditIntentionFragment.close();                                                                                                                                                                                                                       
			oView.byId("idIntentionsTable").removeSelections();                                                                                                                                                                                                         
			oView.byId("idEditToggleBtn").setEnabled(false);                                                                                                                                                                                                            
			this._oEditIntentionFragment.destroy();                                                                                                                                                                                                                     
			this._oEditIntentionFragment = undefined;                                                                                                                                                                                                                   
			//Call Cancel Button Action Here due to new design                                                                                                                                                                                                          
			this.onPressCancelIntention();                                                                                                                                                                                                                              
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//..........save the edited intention...............                                                                                                                                                                                                         
		onPressSaveBtnIntention: function () {                                                                                                                                                                                                                       
			let oView = this.getView(),                                                                                                                                                                                                                                 
				oModel = oView.byId("idIntentionsTable").getModel("intentionsTableModel"),                                                                                                                                                                                 
				aVHData = oView.getModel("oModelEditItentn").getData(),                                                                                                                                                                                                    
				aValData = this.getModel("oRowModel").getData().validate,                                                                                                                                                                                                  
				oCBIntent = oSapUiCore.byId("editIntention--cbIntenId"),                                                                                                                                                                                                   
				iCBIntentVal = oCBIntent.getSelectedKey(),                                                                                                                                                                                                                 
				oPerTo = oSapUiCore.byId("editIntention--IdPerTo"),                                                                                                                                                                                                        
				iPerToVal = oPerTo.getValue(),                                                                                                                                                                                                                             
				oDPYear = oSapUiCore.byId("editIntention--IdFisYr"),                                                                                                                                                                                                       
				sYear = oDPYear.getValue(),                                                                                                                                                                                                                                
				oMsgStrip = oSapUiCore.byId("editIntention--errorMsgStripId"),                                                                                                                                                                                             
				sMsg = this._getValidDataMsg(aValData),                                                                                                                                                                                                                    
				that = this;                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			if (!sYear) { //if no year is defined                                                                                                                                                                                                                       
				oDPYear.setValueState("Error");                                                                                                                                                                                                                            
			} else if (!iCBIntentVal) { // If no intention is selected                                                                                                                                                                                                  
				oCBIntent.setValueState("Error");                                                                                                                                                                                                                          
			} else if (!iPerToVal) { // If no period is definded for periodic intention                                                                                                                                                                                 
				oPerTo.setValueState("Error");                                                                                                                                                                                                                             
				oMsgStrip.setVisible(true);                                                                                                                                                                                                                                
				oMsgStrip.setText(that.getI18nText("errorMsgPeriodTo") + sMsg);                                                                                                                                                                                            
				oSapUiCore.byId("editIntention--idDialog").setContentHeight("250px");                                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			if (oDPYear.getValueState() === "Error" || oCBIntent.getValueState() === "Error" || oPerTo.getValueState() === "Error") {                                                                                                                                   
				this.bAllEntriesValidated = false;                                                                                                                                                                                                                         
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
			this.bAllEntriesValidated = true;                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			oView.byId("idIntentionsTable").removeSelections();                                                                                                                                                                                                         
			oView.byId("idEditToggleBtn").setEnabled(false);                                                                                                                                                                                                            
			//update corresponding models in case after edit to save the data                                                                                                                                                                                           
			let aData = this.getModel("oRowModel").getData(),                                                                                                                                                                                                           
				iPeriodTo = parseInt(aData.PeriodTo, [10]),                                                                                                                                                                                                                
				aVal = aVHData.filter(item => item.SerialNumber === aData.SeqnrFlb);                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			if (iPeriodTo < 10) {                                                                                                                                                                                                                                       
				iPeriodTo = "00" + iPeriodTo;                                                                                                                                                                                                                              
			} else {                                                                                                                                                                                                                                                    
				iPeriodTo = "0" + iPeriodTo;                                                                                                                                                                                                                               
			}                                                                                                                                                                                                                                                           
			//spath will have value during edit operation&nbsp;                                                                                                                                                                                                         
			if (aData.sPath) {                                                                                                                                                                                                                                          
				oModel.setProperty(aData.sPath + "/SeqnrFlb", aData.SeqnrFlb);                                                                                                                                                                                             
				oModel.setProperty(aData.sPath + "/PeriodTo", iPeriodTo);                                                                                                                                                                                                  
				oModel.setProperty(aData.sPath + "/Intention", aVal[0].Intention);                                                                                                                                                                                         
				oModel.setProperty(aData.sPath + "/Intdesc", aVal[0].Description);                                                                                                                                                                                         
			} else {                                                                                                                                                                                                                                                    
				let aTabData = oModel.getData().results;                                                                                                                                                                                                                   
				aData.PeriodTo = iPeriodTo;                                                                                                                                                                                                                                
				aData.Intention = aVal[0].Intention;                                                                                                                                                                                                                       
				aData.Intdesc = aVal[0].Description;                                                                                                                                                                                                                       
				aTabData.push(aData);                                                                                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			oModel.refresh();                                                                                                                                                                                                                                           
			this._oEditIntentionFragment.close();                                                                                                                                                                                                                       
			this._oEditIntentionFragment.destroy();                                                                                                                                                                                                                     
			this._oEditIntentionFragment = undefined;                                                                                                                                                                                                                   
			//Add Save BE Call Here due to new design                                                                                                                                                                                                                   
			this.onPressSaveIntention();                                                                                                                                                                                                                                
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onPressAddIntetion: function (oEvent) {                                                                                                                                                                                                                      
			/**********************************new logic*************************************************/                                                                                                                                                              
                                                                                                                                                                                                                                                               
			let oCnsdUnit = this.getView().byId("idConsUnit"),                                                                                                                                                                                                          
				oAddObj = {                                                                                                                                                                                                                                                
					"Bunit": oCnsdUnit.getSelectedKey(),                                                                                                                                                                                                                      
					"Gjahr": '',                                                                                                                                                                                                                                              
					"Intention": '',                                                                                                                                                                                                                                          
					"Intdesc": '',                                                                                                                                                                                                                                            
					"CreatedBy": "",                                                                                                                                                                                                                                          
					"CreatedOn": "",                                                                                                                                                                                                                                          
					"ChangedBy": "",                                                                                                                                                                                                                                          
					"ChangedOn": "",                                                                                                                                                                                                                                          
					"PeriodTo": '',                                                                                                                                                                                                                                           
					"IntnsnActFlg": false,                                                                                                                                                                                                                                    
					"IsActive": false,                                                                                                                                                                                                                                        
					"Closebtnact": false,                                                                                                                                                                                                                                     
					"SeqnrFlb": '',                                                                                                                                                                                                                                           
					"editYr": true,                                                                                                                                                                                                                                           
					"editPer": false,                                                                                                                                                                                                                                         
					"sPath": '',                                                                                                                                                                                                                                              
					"bCreated": true                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				},                                                                                                                                                                                                                                                         
				aVal = [],                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
				oCreatIntData = [{                                                                                                                                                                                                                                         
					"SerialNumber": "01",                                                                                                                                                                                                                                     
					"Intention": "PER",                                                                                                                                                                                                                                       
					"Description": "Periodic",                                                                                                                                                                                                                                
					"PeriodTo": "000"                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
				}, {                                                                                                                                                                                                                                                       
					"SerialNumber": "02",                                                                                                                                                                                                                                     
					"Intention": "Q1",                                                                                                                                                                                                                                        
					"Description": "Q1 Close",                                                                                                                                                                                                                                
					"PeriodTo": "003"                                                                                                                                                                                                                                         
				}];                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			//aVal is to validate the period to value...in case of create it can have only 2 values....001 and 002.                                                                                                                                                     
			aVal.push(1);                                                                                                                                                                                                                                               
			aVal.push(2);                                                                                                                                                                                                                                               
			oAddObj.validate = aVal;                                                                                                                                                                                                                                    
			this.getModel("oRowModel").setData(oAddObj);                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			this.getModel("oModelEditItentn").setData([]);                                                                                                                                                                                                              
			this.getModel("oModelEditItentn").setData(oCreatIntData);                                                                                                                                                                                                   
			//open the fragment                                                                                                                                                                                                                                         
			this.onPressEditToggleBtn(oEvent);                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			/********************************************************************************/                                                                                                                                                                          
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//	--------------- Press event for 'GO' Button -------------------                                                                                                                                                                                           
		onSearchButtonPressed: function () {                                                                                                                                                                                                                         
			this._fetchIntentionsData();                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		onItemSelected: function (oEvent) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			let oView = this.getView(),                                                                                                                                                                                                                                 
				that = this,                                                                                                                                                                                                                                               
				oEditIntentBtn = oView.byId("idEditToggleBtn"),                                                                                                                                                                                                            
				sPath = oEvent.getSource().getSelectedItem().getBindingContext("intentionsTableModel").getPath(),                                                                                                                                                          
				aArr = sPath.split("/"),                                                                                                                                                                                                                                   
				index = parseInt(aArr[2], [10]),                                                                                                                                                                                                                           
				currData = oEvent.getSource().getSelectedItem().getBindingContext("intentionsTableModel").getObject(),                                                                                                                                                     
				aEditData, bPerToEdit,                                                                                                                                                                                                                                     
				aPerVal = [],                                                                                                                                                                                                                                              
				oRowData = {};                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			//check the following conditions for selected item....---------------------------------------------------------------------------------------------..                                                                                                       
                                                                                                                                                                                                                                                               
			//if IsActive is true means year is closed ....so on selecting item...warning displayed                                                                                                                                                                     
			if (currData.IsActive) {                                                                                                                                                                                                                                    
				// MessageBox.warning(that.getI18nText("warningIntentionClosed"), {                                                                                                                                                                                        
				// 	actions: [MessageBox.Action.OK],                                                                                                                                                                                                                       
				// 	emphasizedAction: MessageBox.Action.OK,                                                                                                                                                                                                                
				// 	onClose: function (sAction) {                                                                                                                                                                                                                          
				// 		//	if (sAction === MessageBox.Action.OK) {                                                                                                                                                                                                            
				// 		oView.byId("idIntentionsTable").removeSelections();                                                                                                                                                                                                   
				// 		oEditIntentBtn.setEnabled(false);                                                                                                                                                                                                                     
				// 		//	}                                                                                                                                                                                                                                                  
				// 	}                                                                                                                                                                                                                                                      
				// });                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
				oView.byId("idIntentionsTable").removeSelections();                                                                                                                                                                                                        
				oEditIntentBtn.setEnabled(false);                                                                                                                                                                                                                          
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			//FY whose closbtn flag is true can only be closed.                                                                                                                                                                                                         
			if (currData.Closebtnact) {                                                                                                                                                                                                                                 
				oView.byId("idCloseIntentBtn").setVisible(true);                                                                                                                                                                                                           
			} else {                                                                                                                                                                                                                                                    
				oView.byId("idCloseIntentBtn").setVisible(false);                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			//if seq no selected is periodic then only the edit/create dialog willa  allow to edit period to                                                                                                                                                            
			if (currData.SeqnrFlb == "01") {                                                                                                                                                                                                                            
				bPerToEdit = true;                                                                                                                                                                                                                                         
			} else {                                                                                                                                                                                                                                                    
				bPerToEdit = false;                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			//to disable the edit btn for the row which is just created                                                                                                                                                                                                 
			if (currData.bCreated) {                                                                                                                                                                                                                                    
				oEditIntentBtn.setEnabled(false);                                                                                                                                                                                                                          
				return;                                                                                                                                                                                                                                                    
			} else {                                                                                                                                                                                                                                                    
				oEditIntentBtn.setEnabled(true);                                                                                                                                                                                                                           
			}                                                                                                                                                                                                                                                           
			//----------------------------------------------------------------------------------------------------------------------------------------------------                                                                                                      
			//take year and intention from orignal data as user can edit again before saving                                                                                                                                                                            
			//so edit dropdown will get values from backend based on orignal data value but selected value is the one which he selected last&nbsp;                                                                                                                      
			//so serial number is from current data along with the period to value.&nbsp;                                                                                                                                                                               
			let oData = this._getOriginalIntentionData().getData()[index],                                                                                                                                                                                              
				iKey = parseInt(oData.SeqnrFlb, [10]);                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
			oRowData.Gjahr = oData.Gjahr;                                                                                                                                                                                                                               
			oRowData.Intention = oData.Intention;                                                                                                                                                                                                                       
			oRowData.PeriodTo = currData.PeriodTo;                                                                                                                                                                                                                      
			oRowData.SeqnrFlb = currData.SeqnrFlb;                                                                                                                                                                                                                      
			oRowData.editPer = bPerToEdit;                                                                                                                                                                                                                              
			oRowData.sPath = sPath;                                                                                                                                                                                                                                     
			oRowData.editYr = false;                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
			//set the above row data on row model in case of editing a row                                                                                                                                                                                              
			this.getModel("oRowModel").setData(oRowData);                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			//create the validation data based on the intention and period values                                                                                                                                                                                       
			if (oData.SeqnrFlb === "02" || oData.SeqnrFlb === "03" || oData.SeqnrFlb === "04") {                                                                                                                                                                        
				aPerVal.push(parseInt(oData.PeriodTo, [10]) + 1);                                                                                                                                                                                                          
				aPerVal.push(parseInt(oData.PeriodTo, [10]) + 2);                                                                                                                                                                                                          
			} else if (oData.SeqnrFlb === "01") { //when periodic is already selected and edited                                                                                                                                                                        
				if (oData.PeriodTo === "001") {                                                                                                                                                                                                                            
					aPerVal.push(1);                                                                                                                                                                                                                                          
					aPerVal.push(2);                                                                                                                                                                                                                                          
				} else if (oData.PeriodTo === "002") {                                                                                                                                                                                                                     
					aPerVal.push(2);                                                                                                                                                                                                                                          
				} else if (oData.PeriodTo === "004") {                                                                                                                                                                                                                     
					aPerVal.push(4);                                                                                                                                                                                                                                          
					aPerVal.push(5);                                                                                                                                                                                                                                          
				} else if (oData.PeriodTo === "005") {                                                                                                                                                                                                                     
					aPerVal.push(5);                                                                                                                                                                                                                                          
				} else if (oData.PeriodTo === "007") {                                                                                                                                                                                                                     
					aPerVal.push(7);                                                                                                                                                                                                                                          
					aPerVal.push(8);                                                                                                                                                                                                                                          
				} else if (oData.PeriodTo === "008") {                                                                                                                                                                                                                     
					aPerVal.push(8);                                                                                                                                                                                                                                          
				} else if (oData.PeriodTo === "010") {                                                                                                                                                                                                                     
					aPerVal.push(10);                                                                                                                                                                                                                                         
					aPerVal.push(11);                                                                                                                                                                                                                                         
				} else if (oData.PeriodTo === "011") {                                                                                                                                                                                                                     
					aPerVal.push(11);                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			}                                                                                                                                                                                                                                                           
			oRowData.validate = aPerVal;                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			this._fetchIntentionEditCB(oRowData.Gjahr, oRowData.Intention, oRowData.PeriodTo);                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onItemSelectedForPeriod: function (oEvent) {                                                                                                                                                                                                                 
			let oView = this.getView(),                                                                                                                                                                                                                                 
				that = this,                                                                                                                                                                                                                                               
				oEditIntentBtn = oView.byId("idEditPerdBtn"),                                                                                                                                                                                                              
				sPath = oEvent.getSource().getSelectedItem().getBindingContext("periodTableModel").getPath(),                                                                                                                                                              
				aArr = sPath.split("/"),                                                                                                                                                                                                                                   
				index = parseInt(aArr[2], [10]),                                                                                                                                                                                                                           
				currData = oEvent.getSource().getSelectedItem().getBindingContext("periodTableModel").getObject(),                                                                                                                                                         
				aEditData, bPerToEdit,                                                                                                                                                                                                                                     
				aPerVal = [],                                                                                                                                                                                                                                              
				oRowData = {};                                                                                                                                                                                                                                             
			console.log(currData);                                                                                                                                                                                                                                      
			console.log(index);                                                                                                                                                                                                                                         
			oEditIntentBtn.setEnabled(true);                                                                                                                                                                                                                            
			this.getModel("oPerRowModel").setData(currData);                                                                                                                                                                                                            
		},                                                                                                                                                                                                                                                           
		//validation of period to field on intention period mapping                                                                                                                                                                                                  
		onChangeFisclPeriodTo: function () {                                                                                                                                                                                                                         
			this.bPerValidate = true;                                                                                                                                                                                                                                   
			if(this.getModel("oPerRowModel").getData().PeriodTo <= '12'                                                                                                                                                                                                 
			|| this.getModel("oPerRowModel").getData().PeriodTo > '17'&nbsp;                                                                                                                                                                                            
			 )                                                                                                                                                                                                                                                          
			{                                                                                                                                                                                                                                                           
				oSapUiCore.byId("editIntention--IdPerTo").setValueState(sap.ui.core.ValueState.Error);                                                                                                                                                                     
				this.bPerValidate = false;                                                                                                                                                                                                                                 
			}else{                                                                                                                                                                                                                                                      
				oSapUiCore.byId("editIntention--IdPerTo").setValueState(sap.ui.core.ValueState.None);                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onPressSaveBtnPeriod: function () {                                                                                                                                                                                                                          
			//validate whether save service call should be done or not                                                                                                                                                                                                  
			if (!this.bPerValidate) {                                                                                                                                                                                                                                   
				MessageBox.error(this.getI18nText("errorMsgInvalidTableData"));                                                                                                                                                                                            
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			let oData = this.getModel("oPerRowModel").getData(),                                                                                                                                                                                                        
			that = this,                                                                                                                                                                                                                                                
			oServiceCallModel = that.getOwnerComponent().getModel();                                                                                                                                                                                                    
			let sServiceURL = "/IntentionsMappingSet('" + oData.Intention + "')";&nbsp;&nbsp;                                                                                                                                                                           
			this.getBusyDialog().open();                                                                                                                                                                                                                                
			oServiceCallModel.update(sServiceURL,                                                                                                                                                                                                                       
							oData,                                                                                                                                                                                                                                                  
							{ success: function(oResData){                                                                                                                                                                                                                          
								that._oEditPeriodFragment.close();					                                                                                                                                                                                                                
								that.getBusyDialog().close();                                                                                                                                                                                                                          
								let oIntMapData = that.getView().getModel("intentionsMappingModel").getData();                                                                                                                                                                         
								for(let i=0;i<oIntMapData.length;i++){                                                                                                                                                                                                                 
									if(oIntMapData[i].Intention === oData.Intention){                                                                                                                                                                                                     
										oIntMapData[i].PeriodTo = oData.PeriodTo;                                                                                                                                                                                                            
									}                                                                                                                                                                                                                                                     
								}                                                                                                                                                                                                                                                      
								that.getView().getModel("intentionsMappingModel").refresh(true);                                                                                                                                                                                       
								MessageToast.show(that.getI18nText("genericMsgBatchSuccess"));                                                                                                                                                                                         
							},                                                                                                                                                                                                                                                      
							error: function(oResponse){                                                                                                                                                                                                                             
								that._oEditPeriodFragment.close();					                                                                                                                                                                                                                
								that.getBusyDialog().close();                                                                                                                                                                                                                          
								MessageToast.show(that.getI18nText("genericMsgBatchError"));                                                                                                                                                                                           
							}                                                                                                                                                                                                                                                       
						});                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		//on press save all the changes edit and create                                                                                                                                                                                                              
		onPressSaveIntention: function () {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			//validate whether save service call should be done or not                                                                                                                                                                                                  
			if (!this.bAllEntriesValidated) {                                                                                                                                                                                                                           
				MessageBox.error(this.getI18nText("errorMsgInvalidTableData"));                                                                                                                                                                                            
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			//initialize Data Monitor class JSON Data                                                                                                                                                                                                                   
			this.oJSONDMData = [];                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
			// Variable Declaration                                                                                                                                                                                                                                     
			let oComp = this.getOwnerComponent(),                                                                                                                                                                                                                       
				oServiceCallModel = oComp.getModel(),                                                                                                                                                                                                                      
				that = this,                                                                                                                                                                                                                                               
				aModelData = this.getView().byId("idIntentionsTable").getModel("intentionsTableModel").getData().results,                                                                                                                                                  
				aOriginalData = jQuery.extend(true, [], this._getOriginalIntentionData().getData());                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			aOriginalData.map(item => {                                                                                                                                                                                                                                 
				delete item.bCreated;                                                                                                                                                                                                                                      
				return item;                                                                                                                                                                                                                                               
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			aModelData.map(item => {                                                                                                                                                                                                                                    
				delete item.bCreated;                                                                                                                                                                                                                                      
				delete item.editPer;                                                                                                                                                                                                                                       
				delete item.editYr;                                                                                                                                                                                                                                        
				delete item.sPath;                                                                                                                                                                                                                                         
				delete item.validate;                                                                                                                                                                                                                                      
				return item;                                                                                                                                                                                                                                               
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			// --------------> Configuring Batch settings <--------------                                                                                                                                                                                               
			oServiceCallModel.setUseBatch(true);                                                                                                                                                                                                                        
			oServiceCallModel.setChangeGroups({                                                                                                                                                                                                                         
				"/SAV_MANAGE_INTENTIONS_SRV": {                                                                                                                                                                                                                            
					groupId: "groupIdSaveIntention",                                                                                                                                                                                                                          
					changeSetId: "ID",                                                                                                                                                                                                                                        
					single: false                                                                                                                                                                                                                                             
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			oServiceCallModel.setDeferredGroups(oServiceCallModel.getDeferredGroups().concat(["groupIdSaveIntention"]));                                                                                                                                                
                                                                                                                                                                                                                                                               
			// --------------> Generate Change Sets ----- Code STARTS  <--------------                                                                                                                                                                                  
			if (aModelData.length > aOriginalData.length) {                                                                                                                                                                                                             
				// -----------------CREATE or EDIT or BOTH-----------------                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
				// Search in Table, where entries dont match. EDIT                                                                                                                                                                                                         
				let aEditedEntries = aModelData.filter(item =>                                                                                                                                                                                                             
					aOriginalData.filter(elm => parseInt(elm.Gjahr, [10]) === parseInt(item.Gjahr, [10]) && elm.Bunit === item.Bunit && (elm.Intention !==                                                                                                                    
						item.Intention ||                                                                                                                                                                                                                                        
						elm                                                                                                                                                                                                                                                      
						.IntnsnActFlg !== item.IntnsnActFlg || parseInt(elm.PeriodTo, [10]) !== parseInt(item.PeriodTo, [10]) || parseInt(elm.SeqnrFlb, [                                                                                                                        
							10                                                                                                                                                                                                                                                      
						]) !== parseInt(item.SeqnrFlb, [10]))).length > 0);                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
				let aCreatedEntries = aModelData.filter(item => aOriginalData.filter(elm => parseInt(elm.Gjahr, [10]) === parseInt(item.Gjahr, [                                                                                                                           
						10                                                                                                                                                                                                                                                       
					]) && elm.Bunit === item.Bunit)                                                                                                                                                                                                                           
					.length ===                                                                                                                                                                                                                                               
					0);                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
				// EDIT Batch (If editing is done)                                                                                                                                                                                                                         
				if (aEditedEntries.length > 0) {                                                                                                                                                                                                                           
					for (var i = 0; i < aEditedEntries.length; i++) {                                                                                                                                                                                                         
						let sEditServiceURL = "/IntentionsSet(Gjahr='" + aEditedEntries[i].Gjahr + "',Bunit='" + aEditedEntries[i].Bunit + "')";                                                                                                                                 
						delete aEditedEntries[i].ChangedBy;                                                                                                                                                                                                                      
						delete aEditedEntries[i].ChangedOn;                                                                                                                                                                                                                      
						delete aEditedEntries[i].CreatedBy;                                                                                                                                                                                                                      
						delete aEditedEntries[i].CreatedOn;                                                                                                                                                                                                                      
						oServiceCallModel.update(sEditServiceURL,                                                                                                                                                                                                                
							aEditedEntries[i], {                                                                                                                                                                                                                                    
								groupId: "groupIdSaveIntention"                                                                                                                                                                                                                        
							}                                                                                                                                                                                                                                                       
						);                                                                                                                                                                                                                                                       
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				// CREATE Batch                                                                                                                                                                                                                                            
				if (aCreatedEntries.length > 0) {                                                                                                                                                                                                                          
					for (var iEntry = 0; iEntry < aCreatedEntries.length; iEntry++) {                                                                                                                                                                                         
						delete aCreatedEntries[iEntry].ChangedBy;                                                                                                                                                                                                                
						delete aCreatedEntries[iEntry].ChangedOn;                                                                                                                                                                                                                
						delete aCreatedEntries[iEntry].CreatedBy;                                                                                                                                                                                                                
						delete aCreatedEntries[iEntry].CreatedOn;                                                                                                                                                                                                                
						oServiceCallModel.create("/IntentionsSet", aCreatedEntries[iEntry], {                                                                                                                                                                                    
							groupId: "groupIdSaveIntention"                                                                                                                                                                                                                         
						});                                                                                                                                                                                                                                                      
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			} else if (aModelData.length === aOriginalData.length) { // ---------------------EDIT-------------------------                                                                                                                                              
                                                                                                                                                                                                                                                               
				// If any entry does not matches original data (means its updated), GENERATE edit Batch                                                                                                                                                                    
				for (var i = 0; i < aModelData.length; i++) {                                                                                                                                                                                                              
					for (var j = 0; j < aOriginalData.length; j++) {                                                                                                                                                                                                          
						let oCheck = true;                                                                                                                                                                                                                                       
						if (aModelData[i].Gjahr === aOriginalData[j].Gjahr && (aModelData[i].IntnsnActFlg !==                                                                                                                                                                    
								aOriginalData[j].IntnsnActFlg ||                                                                                                                                                                                                                       
								aModelData[i].Intention !== aOriginalData[j].Intention || aModelData[i].PeriodTo !==                                                                                                                                                                   
								aOriginalData[j].PeriodTo || aModelData[i].SeqnrFlb !==                                                                                                                                                                                                
								aOriginalData[j].SeqnrFlb)) {                                                                                                                                                                                                                          
							// aEditArray.push(aModelData[i]); // Not used - just for verification purpose&nbsp;                                                                                                                                                                    
                                                                                                                                                                                                                                                               
							//Push the entries in an json that has to be modified.                                                                                                                                                                                                  
							if (aModelData[i].SeqnrFlb > "05") {                                                                                                                                                                                                                    
								MessageBox.warning(this.getI18nText("messageconfirm"), {                                                                                                                                                                                               
									actions: [MessageBox.Action.OK, MessageBox.Action.CANCEL],                                                                                                                                                                                            
									emphasizedAction: MessageBox.Action.OK,                                                                                                                                                                                                               
									onClose: function (sAction) {                                                                                                                                                                                                                         
										if (sAction === "OK") {                                                                                                                                                                                                                              
											that._callBEService(oServiceCallModel);                                                                                                                                                                                                             
										} else {                                                                                                                                                                                                                                             
											that.onPressCancelIntention();                                                                                                                                                                                                                      
										}                                                                                                                                                                                                                                                    
									}                                                                                                                                                                                                                                                     
								});                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
								this.oJSONDMData.push(aModelData[i]);                                                                                                                                                                                                                  
							}                                                                                                                                                                                                                                                       
							// Service call                                                                                                                                                                                                                                         
							oServiceCallModel.update("/IntentionsSet(Gjahr='" + aModelData[i].Gjahr + "',Bunit='" + aModelData[i].Bunit + "')",                                                                                                                                     
								aModelData[i], {                                                                                                                                                                                                                                       
									groupId: "groupIdSaveIntention"                                                                                                                                                                                                                       
								}                                                                                                                                                                                                                                                      
							);                                                                                                                                                                                                                                                      
						}                                                                                                                                                                                                                                                        
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
			} else {                                                                                                                                                                                                                                                    
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
			if (this.oJSONDMData.length === 0) {                                                                                                                                                                                                                        
				this._callBEService(oServiceCallModel);                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_callBEService: function (oServiceCallModel) {                                                                                                                                                                                                               
			let that = this;                                                                                                                                                                                                                                            
			//Call Data Monitor Service Here                                                                                                                                                                                                                            
			if (this.oJSONDMData.length > 0) {                                                                                                                                                                                                                          
				this.onPressBalTransDM();                                                                                                                                                                                                                                  
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			//submit changes                                                                                                                                                                                                                                            
			oServiceCallModel.submitChanges({                                                                                                                                                                                                                           
				groupId: "groupIdSaveIntention",                                                                                                                                                                                                                           
				success: function (oData, response) {                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
					let oChangeResponses;                                                                                                                                                                                                                                     
					// If no service call is sent.                                                                                                                                                                                                                            
					if (!oData.__batchResponses) {                                                                                                                                                                                                                            
						that._setScreenToDisplayMode();                                                                                                                                                                                                                          
						return;                                                                                                                                                                                                                                                  
					}                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
					// If No response is received.                                                                                                                                                                                                                            
					oChangeResponses = oData.__batchResponses[0].__changeResponses;                                                                                                                                                                                           
					if (!oChangeResponses || oChangeResponses.length <= 0) {                                                                                                                                                                                                  
						that._setScreenToDisplayMode();                                                                                                                                                                                                                          
						return;                                                                                                                                                                                                                                                  
					}                                                                                                                                                                                                                                                         
					that._setScreenToDisplayMode();                                                                                                                                                                                                                           
					let oOverAllResponse = JSON.parse(oChangeResponses.find(item => item.headers["sap-message"]).headers["sap-message"]);                                                                                                                                     
					// let oChangeRespData = oChangeResponses[0].data;                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
					//	If header response is available & is success                                                                                                                                                                                                           
					if (oOverAllResponse && oOverAllResponse.severity.toUpperCase() === "SUCCESS") {                                                                                                                                                                          
						// MessageToast.show(oOverAllResponse.message);                                                                                                                                                                                                          
						MessageToast.show(that.getI18nText("genericMsgBatchSuccess"));                                                                                                                                                                                           
						that._setScreenToDisplayMode();                                                                                                                                                                                                                          
					} else if (oOverAllResponse && oOverAllResponse.message) { // If header response is available but other than success.                                                                                                                                     
						// MessageBox.error(oOverAllResponse.message);                                                                                                                                                                                                           
						MessageToast.show(that.getI18nText("genericMsgBatchError"));                                                                                                                                                                                             
					}                                                                                                                                                                                                                                                         
					//	If No response - default framework error to occur                                                                                                                                                                                                      
				},                                                                                                                                                                                                                                                         
				error: function (oError) {                                                                                                                                                                                                                                 
					that._setScreenToDisplayMode();                                                                                                                                                                                                                           
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//on press cancel all the changes made till now                                                                                                                                                                                                              
		onPressCancelIntention: function (oEvent) {                                                                                                                                                                                                                  
			let oView = this.getView(),                                                                                                                                                                                                                                 
				that = this,                                                                                                                                                                                                                                               
				oTable = oView.byId("idIntentionsTable");                                                                                                                                                                                                                  
			oTable.getModel("intentionsTableModel").setData({                                                                                                                                                                                                           
				results: jQuery.extend(true, [], this._getOriginalIntentionData().getData())                                                                                                                                                                               
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			oView.byId("idIntentionsTable").removeSelections();                                                                                                                                                                                                         
			oView.byId("idOverflowToolbar").setVisible(false);                                                                                                                                                                                                          
			oView.byId("idAddIntentBtn").setEnabled(true);                                                                                                                                                                                                              
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onPressCloseFY: function (oEvent) {                                                                                                                                                                                                                          
			let that = this;                                                                                                                                                                                                                                            
			let oView = this.getView(),                                                                                                                                                                                                                                 
				obj = oView.byId("idIntentionsTable").getSelectedItem().getBindingContext("intentionsTableModel").getObject();                                                                                                                                             
			oView.byId("idOverflowToolbar").setVisible(true);                                                                                                                                                                                                           
			obj.IntnsnActFlg = true;                                                                                                                                                                                                                                    
			//Call Save                                                                                                                                                                                                                                                 
			that.onPressSaveIntention();                                                                                                                                                                                                                                
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onPressBalTransDM: function () {                                                                                                                                                                                                                             
			let that = this,                                                                                                                                                                                                                                            
				oServiceCallModel = this.getOwnerComponent().getModel(),                                                                                                                                                                                                   
				oConsolidationUnit = this.getView().byId("idConsUnit"),                                                                                                                                                                                                    
				oFilter = [],                                                                                                                                                                                                                                              
				sURLParameter = "/LedgerSet",                                                                                                                                                                                                                              
				aFilter = new Filter({                                                                                                                                                                                                                                     
					path: "BUnit",                                                                                                                                                                                                                                            
					operator: FilterOperator.EQ,                                                                                                                                                                                                                              
					value1: oConsolidationUnit.getSelectedItem().getKey()                                                                                                                                                                                                     
				});                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			oFilter.push(aFilter);                                                                                                                                                                                                                                      
			this.getBusyDialog().open();                                                                                                                                                                                                                                
			oServiceCallModel.read(sURLParameter, {                                                                                                                                                                                                                     
				filters: oFilter,                                                                                                                                                                                                                                          
				success: that._onLedgerSetSuccess.bind(this),                                                                                                                                                                                                              
				error: that._onLedgerSetError.bind(this)                                                                                                                                                                                                                   
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_onLedgerSetSuccess: function (oData) {                                                                                                                                                                                                                      
			let oModel = this.getOwnerComponent().getModel(), //"dataMonitor"                                                                                                                                                                                           
				oConsolidationUnit = this.getView().byId("idConsUnit");                                                                                                                                                                                                    
			this.oDataMonitorData = [];                                                                                                                                                                                                                                 
			if (this.oMP) {                                                                                                                                                                                                                                             
				let newJSON = new JSONModel();                                                                                                                                                                                                                             
				newJSON.setData(this.oDataMonitorData);                                                                                                                                                                                                                    
				this.oMP.setModel(newJSON);                                                                                                                                                                                                                                
				this.oMP.getModel().refresh();                                                                                                                                                                                                                             
			}                                                                                                                                                                                                                                                           
			let oFilterData = null;                                                                                                                                                                                                                                     
			let i = 0;                                                                                                                                                                                                                                                  
			for (let jk = 0; jk < this.oJSONDMData.length; jk++) {                                                                                                                                                                                                      
				let oFiscalYear = this.oJSONDMData[jk].Gjahr; //this.byId("idSmartFilterBar").getFilters();                                                                                                                                                                
				let oPeriodTo = this.oJSONDMData[jk].PeriodTo;                                                                                                                                                                                                             
				let sURLParameter = "/BalanceTrasnferDataMonitor";                                                                                                                                                                                                         
				if (oFiscalYear && oFiscalYear.length > 0) {                                                                                                                                                                                                               
					oFilterData = {                                                                                                                                                                                                                                           
						ConsolidationUnit: "'" + oConsolidationUnit.getSelectedItem().getKey() + "'",                                                                                                                                                                            
						FiscalYear: "'" + oFiscalYear + "'",                                                                                                                                                                                                                     
						Ledger: "'" + oData.results[i].RLDNR + "'",                                                                                                                                                                                                              
						PeriodTo: "'" + oPeriodTo + "'",                                                                                                                                                                                                                         
						Intention: "'" + this.oJSONDMData[jk].Intention + "'"                                                                                                                                                                                                    
					};                                                                                                                                                                                                                                                        
				} else {                                                                                                                                                                                                                                                   
					oFilterData = {                                                                                                                                                                                                                                           
						ConsolidationUnit: "'" + oConsolidationUnit.getSelectedItem().getKey() + "'",                                                                                                                                                                            
						FiscalYear: "'" + "'",                                                                                                                                                                                                                                   
						Ledger: "'" + oData.results[i].RLDNR + "'",                                                                                                                                                                                                              
						PeriodTo: "'" + oPeriodTo + "'",                                                                                                                                                                                                                         
						Intention: "'" + this.oJSONDMData[jk].Intention + "'"                                                                                                                                                                                                    
					};                                                                                                                                                                                                                                                        
				}                                                                                                                                                                                                                                                          
				this._callDataMonitorFunctionImportRecursion(this, i, oModel, oFilterData, sURLParameter, oData.results.length, oData.results);                                                                                                                            
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_callDataMonitorFunctionImportRecursion(oThis, i, oModel, oFilterData, sURLParameter, length, oResults) {                                                                                                                                                    
			let that = this;                                                                                                                                                                                                                                            
			if (this.getBusyDialog()) {                                                                                                                                                                                                                                 
				this.getBusyDialog().open();                                                                                                                                                                                                                               
			}                                                                                                                                                                                                                                                           
			oModel.read(sURLParameter, {                                                                                                                                                                                                                                
				method: "GET",                                                                                                                                                                                                                                             
				urlParameters: oFilterData,                                                                                                                                                                                                                                
				success: function (oData) {                                                                                                                                                                                                                                
					i = i + 1;                                                                                                                                                                                                                                                
					if (length > i) {                                                                                                                                                                                                                                         
						for (let mn = 0; mn < oData.results.length; mn++) {                                                                                                                                                                                                      
							that.oDataMonitorData.push(oData.results[mn]);                                                                                                                                                                                                          
						}                                                                                                                                                                                                                                                        
						oFilterData.Ledger = "'" + oResults[i].RLDNR + "'";                                                                                                                                                                                                      
						that._callDataMonitorFunctionImportRecursion(that, i, oModel, oFilterData, sURLParameter, length, oResults);                                                                                                                                             
					} else if (length === i) {                                                                                                                                                                                                                                
						for (let mn = 0; mn < oData.results.length; mn++) {                                                                                                                                                                                                      
							that.oDataMonitorData.push(oData.results[mn]);                                                                                                                                                                                                          
						}                                                                                                                                                                                                                                                        
						that._generateMessagePopover(oThis, that.oDataMonitorData);                                                                                                                                                                                              
						that.getBusyDialog().close();                                                                                                                                                                                                                            
					}                                                                                                                                                                                                                                                         
				},                                                                                                                                                                                                                                                         
				error: function (oResponse) {                                                                                                                                                                                                                              
					that.getBusyDialog().close();                                                                                                                                                                                                                             
					MessageBox.error(that.getI18nText("errorDataMonitor"));                                                                                                                                                                                                   
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			oModel.submitChanges();                                                                                                                                                                                                                                     
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_generateMessagePopover: function (oThis, oData) {                                                                                                                                                                                                           
			let that = oThis;                                                                                                                                                                                                                                           
			this.getView().byId("idOverflowToolbar").setVisible(true);                                                                                                                                                                                                  
			let oMP = new MessagePopover({                                                                                                                                                                                                                              
				activeTitlePress: function (oEvent) {                                                                                                                                                                                                                      
					//do nothing                                                                                                                                                                                                                                              
				},                                                                                                                                                                                                                                                         
				items: {                                                                                                                                                                                                                                                   
					path: "/",                                                                                                                                                                                                                                                
					template: new MessageItem({                                                                                                                                                                                                                               
						title: "{MessageText}",                                                                                                                                                                                                                                  
						subtitle: "",                                                                                                                                                                                                                                            
						activeTitle: false,                                                                                                                                                                                                                                      
						type: {                                                                                                                                                                                                                                                  
							path: "Type",                                                                                                                                                                                                                                           
							formatter: this.formatMessageType                                                                                                                                                                                                                       
						},                                                                                                                                                                                                                                                       
						description: "{MessageText}"                                                                                                                                                                                                                             
					})                                                                                                                                                                                                                                                        
				},                                                                                                                                                                                                                                                         
				groupItems: true                                                                                                                                                                                                                                           
			});                                                                                                                                                                                                                                                         
			this.oMP = oMP;                                                                                                                                                                                                                                             
			let oJSONModel = new JSONModel();                                                                                                                                                                                                                           
			oJSONModel.setData(oData);                                                                                                                                                                                                                                  
			oMP.setModel(oJSONModel);                                                                                                                                                                                                                                   
			this.getView().addDependent(oMP);                                                                                                                                                                                                                           
			this._buttonIconFormatter();                                                                                                                                                                                                                                
			this._buttonTextFormatter();                                                                                                                                                                                                                                
			this.getView().byId("idMessagePopoverBtn").setVisible(true);                                                                                                                                                                                                
			setTimeout(function () {                                                                                                                                                                                                                                    
				oMP.openBy(this.getView().byId("idMessagePopoverBtn"));                                                                                                                                                                                                    
			}.bind(this), 100);                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_buttonIconFormatter: function () {                                                                                                                                                                                                                          
			var sIcon;                                                                                                                                                                                                                                                  
			var aMessages =                                                                                                                                                                                                                                             
				this.oMP.getModel().getData();                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			aMessages.forEach(function (sMessage) {                                                                                                                                                                                                                     
				switch (sMessage.Type) {                                                                                                                                                                                                                                   
				case "E":                                                                                                                                                                                                                                                  
					sIcon = "sap-icon://message-error";                                                                                                                                                                                                                       
					break;                                                                                                                                                                                                                                                    
				case "W":                                                                                                                                                                                                                                                  
					sIcon = sIcon !== "sap-icon://message-error" ? "sap-icon://message-warning" : sIcon;                                                                                                                                                                      
					break;                                                                                                                                                                                                                                                    
				case "S":                                                                                                                                                                                                                                                  
					sIcon = "sap-icon://message-error" && sIcon !== "sap-icon://message-warning" ? "sap-icon://message-success" : sIcon;                                                                                                                                      
					break;                                                                                                                                                                                                                                                    
				default:                                                                                                                                                                                                                                                   
					sIcon = !sIcon ? "sap-icon://message-information" : sIcon;                                                                                                                                                                                                
					break;                                                                                                                                                                                                                                                    
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			this.getView().byId("idMessagePopoverBtn").setIcon(sIcon);                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		formatMessageType: function (oType) {                                                                                                                                                                                                                        
			if (oType === "E") {                                                                                                                                                                                                                                        
				return coreLibrary.MessageType.Error;                                                                                                                                                                                                                      
			} else if (oType === "S") {                                                                                                                                                                                                                                 
				return coreLibrary.MessageType.Success;                                                                                                                                                                                                                    
			} else {                                                                                                                                                                                                                                                    
				return coreLibrary.MessageType.Warning;                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_buttonTypeFormatter: function () {                                                                                                                                                                                                                          
			var sHighestSeverity;                                                                                                                                                                                                                                       
			var aMessages = this.oMP.getModel().getData();                                                                                                                                                                                                              
			aMessages.forEach(function (sMessage) {                                                                                                                                                                                                                     
				switch (sMessage.Type) {                                                                                                                                                                                                                                   
				case "E":                                                                                                                                                                                                                                                  
					sHighestSeverity = "Negative";                                                                                                                                                                                                                            
					break;                                                                                                                                                                                                                                                    
				case "W":                                                                                                                                                                                                                                                  
					sHighestSeverity = sHighestSeverity !== "Negative" ? "Critical" : sHighestSeverity;                                                                                                                                                                       
					break;                                                                                                                                                                                                                                                    
				case "S":                                                                                                                                                                                                                                                  
					sHighestSeverity = sHighestSeverity !== "Negative" && sHighestSeverity !== "Critical" ? "Success" : sHighestSeverity;                                                                                                                                     
					break;                                                                                                                                                                                                                                                    
				default:                                                                                                                                                                                                                                                   
					sHighestSeverity = !sHighestSeverity ? "Neutral" : sHighestSeverity;                                                                                                                                                                                      
					break;                                                                                                                                                                                                                                                    
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			return sHighestSeverity;                                                                                                                                                                                                                                    
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_buttonTextFormatter: function () {                                                                                                                                                                                                                          
			let sHighestSeverityIconType = this._buttonTypeFormatter();                                                                                                                                                                                                 
			let aMessages = this.oMP.getModel().getData();                                                                                                                                                                                                              
			let sHighestSeverityMessageType;                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
			switch (sHighestSeverityIconType) {                                                                                                                                                                                                                         
			case "Negative":                                                                                                                                                                                                                                            
				sHighestSeverityMessageType = "Error";                                                                                                                                                                                                                     
				break;                                                                                                                                                                                                                                                     
			case "Critical":                                                                                                                                                                                                                                            
				sHighestSeverityMessageType = "Warning";                                                                                                                                                                                                                   
				break;                                                                                                                                                                                                                                                     
			case "Success":                                                                                                                                                                                                                                             
				sHighestSeverityMessageType = "Success";                                                                                                                                                                                                                   
				break;                                                                                                                                                                                                                                                     
			default:                                                                                                                                                                                                                                                    
				sHighestSeverityMessageType = !sHighestSeverityMessageType ? "Information" : sHighestSeverityMessageType;                                                                                                                                                  
				break;                                                                                                                                                                                                                                                     
			}                                                                                                                                                                                                                                                           
			this.getView().byId("idMessagePopoverBtn").setText(aMessages.length);                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onhandleMessagePopoverPress: function (oEvent) {                                                                                                                                                                                                             
			this.oMP.toggle(oEvent.getSource());                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_onLedgerSetError: function (oResponse) {                                                                                                                                                                                                                    
			this.getBusyDialog().close();                                                                                                                                                                                                                               
			MessageBox.error(this.getI18nText("errorLedgerSet"));                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onCloseToolbarPress: function (oEvent) {                                                                                                                                                                                                                     
			this.getView().byId("idOverflowToolbar").setVisible(false);                                                                                                                                                                                                 
			//this.getView().byId("iddynamicPage").setFooter(false);                                                                                                                                                                                                    
		},                                                                                                                                                                                                                                                           
		                                                                                                                                                                                                                                                             
		onItemSelectedForIntention: function (oEvent) {                                                                                                                                                                                                              
			let oView = this.getView(),                                                                                                                                                                                                                                 
				that = this,                                                                                                                                                                                                                                               
				oEditIntentBtn = oView.byId("idEditPerdBtn"),                                                                                                                                                                                                              
				sPath = oEvent.getSource().getSelectedItem().getBindingContext("intentionsMappingModel").getPath(),                                                                                                                                                        
				aArr = sPath.split("/"),                                                                                                                                                                                                                                   
				index = parseInt(aArr[1], [10]),                                                                                                                                                                                                                           
				currData = oEvent.getSource().getSelectedItem().getBindingContext("intentionsMappingModel").getObject(),                                                                                                                                                   
				aEditData, bPerToEdit,                                                                                                                                                                                                                                     
				aPerVal = [],                                                                                                                                                                                                                                              
				oRowData = {};                                                                                                                                                                                                                                             
			console.log(currData);                                                                                                                                                                                                                                      
			console.log(index);                                                                                                                                                                                                                                         
			oEditIntentBtn.setEnabled(true);                                                                                                                                                                                                                            
			this.getModel("oPerRowModel").setData(currData);                                                                                                                                                                                                            
		},                                                                                                                                                                                                                                                           
		                                                                                                                                                                                                                                                             
		onCloseFooterPress: function(oEvent){                                                                                                                                                                                                                        
		 this.getView().byId('idOverflowToolbar').setVisible(false);	                                                                                                                                                                                                
		},                                                                                                                                                                                                                                                           
		                                                                                                                                                                                                                                                             
		_formatIntentionStatusText: function(oIntention){                                                                                                                                                                                                            
		 if(oIntention === true){                                                                                                                                                                                                                                    
		 	return "Closed";                                                                                                                                                                                                                                           
		 }else if(oIntention === false){                                                                                                                                                                                                                             
		 	return "Open";                                                                                                                                                                                                                                             
		 }	                                                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
		handleMessagePopoverPress: function(oEvent){                                                                                                                                                                                                                 
			this.oMP.toggle(oEvent.getSource());                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
		                                                                                                                                                                                                                                                             
		onNavigateObjectPage: function(oEvent){                                                                                                                                                                                                                      
			let aSections = oEvent.getSource().getSections(),                                                                                                                                                                                                           
			oServiceCallModel = this.getOwnerComponent().getModel(),                                                                                                                                                                                                    
			that = this;                                                                                                                                                                                                                                                
			for(let i=0;i<aSections.length;i++){                                                                                                                                                                                                                        
				if(oEvent.getSource().sDirectSectionId === aSections[i].getId()){                                                                                                                                                                                          
					if(i > 0){                                                                                                                                                                                                                                                
						//Here we need to write the logic to fetch correct data                                                                                                                                                                                                  
						that.getBusyDialog().open();                                                                                                                                                                                                                             
						oServiceCallModel.read("/IntentionsMappingSet", {                                                                                                                                                                                                        
							method: "GET",                                                                                                                                                                                                                                          
							success: function (oData) {                                                                                                                                                                                                                             
								that.getBusyDialog().close();                                                                                                                                                                                                                          
								that.getView().setModel(new JSONModel(oData.results), "intentionsMappingModel");                                                                                                                                                                       
							},                                                                                                                                                                                                                                                      
							error: function (oError) {                                                                                                                                                                                                                              
								that.getBusyDialog().close();                                                                                                                                                                                                                          
								MessageBox.error(that.getI18nText("errorFetchingIntentionsMapping"));                                                                                                                                                                                  
			                                                                                                                                                                                                                                                            
							}                                                                                                                                                                                                                                                       
						});                                                                                                                                                                                                                                                      
						break;                                                                                                                                                                                                                                                   
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
		}                                                                                                                                                                                                                                                            
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            