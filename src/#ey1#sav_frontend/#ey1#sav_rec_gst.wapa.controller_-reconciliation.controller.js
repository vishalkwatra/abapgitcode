sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/m/MessagePopover","sap/m/MessageItem","sap/ui/core/message/Message","sap/ui/core/library","sap/ui/core/Core","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sa+
p/m/MessageToast","sap/m/MessageBox","sap/ui/core/ListItem","sap/ui/comp/navpopover/NavigationPopoverHandler","sap/ui/model/BindingMode","sap/viz/ui5/data/FlattenedDataset","sap/viz/ui5/format/ChartFormatter","sap/viz/ui5/api/env/Format"],function(e,t,n,+
o,i,a,r,s,l,d,g,c,u,p,h,f,m,C){"use strict";let y=false;let I=sap.ui.getCore();return e.extend("ey.sap.fin.cs.recgaapstattax.controller.Worklist",{formatter:s,onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("Reco+
nciliation").attachMatched(this._onRouteMatched,this);this.g2seditable=false;this._fetchGlobalParameters();this._fetchAdjustmentReasons();let e=new t({});this.getOwnerComponent().setModel(e,"postPTAEntriesConfigModel")},onAfterRendering:function(){let e=+
sap.ushell.services.AppConfiguration,t=this.getI18nText("textMenuItemCTAForPnL"),n=this;if(!this._oAppSettingDialogCTA){this._oAppSettingDialogCTA=sap.ui.xmlfragment("ey.sap.fin.cs.recgaapstattax.fragment.AppSettingCTA",this);this.getView().addDependent(+
this._oAppSettingDialogCTA)}let o=new sap.m.Button({text:t,press:function(e){if(!n._oAppSettingDialogCTA){n._oAppSettingDialogCTA=sap.ui.xmlfragment("ey.sap.fin.cs.recgaapstattax.fragment.AppSettingCTA",n);n.getView().addDependent(n._oAppSettingDialogCTA+
)}n._oAppSettingDialogCTA.open()}});e.addApplicationSettingsButtons([o])},onBeforeRebindTable:function(e){let t=this.getView(),n=t.getModel("viewConfigDataModel").getData();if(!n.globalParameters||!n.globalParameters.ConsolidationChartofAccounts||!n.glob+
alParameters.ConsolidationGroup){c.error(this.getI18nText("errorMaintainGlobalParameter"));return}let o=t.byId("idConsUnit"),i=o.getSelectedKey(),a=t.byId("idCurrency"),r=a.getSelectedKey(),s=t.byId("idFiscalYearFilter"),g=s.getDateValue().getFullYear(),+
u=t.byId("idPeriodFromInput"),p=t.byId("idPeriodToInput"),h=parseInt(u.getValue(),[10]),f=parseInt(p.getValue(),[10]),m=this._oAppSettingDialogCTA.getContent().find(e=>e.getId()==="idAppSettingsCTAIsCTAIncludedCheckBox"),C=m.getSelected()?"X":"";if(t.byI+
d("idIntentionComboBox").getEnabled()===false){c.error(this.getI18nText("IntentionNotYetOpen")+g);this.oGlobalSmartTable.setTableBindingPath("");return}let y=t.byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel"),I=y.getObj+
ect(),b=parseInt(I.CurrOpenPeriod,[10]);if(I.status===this.getI18nText("YetToOpen")){this.getBusyDialog().close();c.error(I.IntentDescription+" "+this.getI18nText("ThisIntentionNotYetOpen")+I.Gjahr);this.oGlobalSmartTable.setTableBindingPath("");return}i+
f(f>b){this.getBusyDialog().close();c.error(this.getModel("i18n").getResourceBundle().getText("errorPeriodnotopen",[f,b]));this.oGlobalSmartTable.setTableBindingPath("");return}let T=parseInt(I.TaxIntention,[10]),S=T>12?T:"",P,D,A;P=new l({filters:[new l+
("ConsolidationUnit",d.EQ,i),new l("ChartOfAccounts",d.EQ,"CANA"),new l("ConsolidationChartofAccounts",d.EQ,n.globalParameters.ConsolidationChartofAccounts),new l("MainCurrency",d.EQ,r)],and:true});A=P;if(e.getParameter("bindingParams").filters.length>0)+
{D=new l({filters:e.getParameter("bindingParams").filters});A=new l({filters:[P,D],and:true})}h=h?h<0?0:h>12?12:h:1;f=f?f<0?0:f>12?12:f:12;let M="/xEY1xSAV_C_Reconciliation(p_ryear='"+g+"',p_fromyb='"+h+"',p_toyb='"+f+"',p_switch='"+C+"',p_taxintention='+
"+S+"')/Results";this.oGlobalSmartTable.setTableBindingPath(M);let w=e.getParameter("bindingParams");w.filters=[A];let x=this.getOwnerComponent().getModel("postPTAEntriesConfigModel");x.getData().sServicePath=M;x.getData().oMainServiceFilters=A;x.setData+
(x.getData())},_onRouteMatched:function(){this.getBusyDialog().close();this.oGlobalSmartTable=this.getView().byId("idgaaptostat");this.oGlobalPostPTAEntriesConfigModel=this.getOwnerComponent().getModel("postPTAEntriesConfigModel");if(this.oGlobalPostPTAE+
ntriesConfigModel.getProperty("/DocumentNumber")){this.oGlobalPostPTAEntriesConfigModel.setProperty("/DocumentNumber",null);this.oGlobalSmartTable.rebindTable()}},_fetchGlobalParameters:function(){var e=this;var n=this.getOwnerComponent().getModel();let +
o=new t;this.setModel(o,"viewConfigDataModel");n.callFunction("/GlobalParameter",{method:"GET",success:function(t){e.getView().getModel("viewConfigDataModel").setData({globalParameters:t});let n=e.getView().byId("idsmartFilterBar");if(!n.getCurrentVarian+
tId()){e._setFilterBarParameters(t)}},error:function(t){c.error(e.getI18nText("errorReadingGlobalParameters"))}})},_setFilterBarParameters:function(e){let t=this.getView(),n=t.byId("idCurrency");if(e.ConsolidationUnit){t.byId("idConsUnit").setSelectedKey+
(e.ConsolidationUnit);n.setVisible(true);this._fetchCurrencyData(true)}if(e.FiscalYear){let n=new Date("06/06/".concat(e.FiscalYear.toString()));t.byId("idFiscalYearFilter").setDateValue(n)}if(e.Intention){t.byId("idIntentionComboBox").setSelectedKey(e.I+
ntention)}var o=[e.ConsolidationUnit,e.FiscalYear];this._fetchIntentionStatus(o);if(e.PeriodFrom){t.byId("idPeriodFromInput").setValue(s.convertStringToInt(e.PeriodFrom))}if(e.PeriodTo){t.byId("idPeriodToInput").setValue(s.convertStringToInt(e.PeriodTo))+
}if(e.LocalCurrencyType&&e.LocalCurrency){n.setSelectedKey(e.LocalCurrency)}else{n.setSelectedKey(e.GroupCurrency)}},_fetchAdjustmentReasons:function(){let e=this.getOwnerComponent().getModel();let t="/xEY1xSAV_C_Recon_Adj_Reason";let n=this;e.read(t,{me+
thod:"GET",success:function(e,t){var o=n.getModel("viewConfigDataModel");o.getData().adjustmentReason=e.results;o.refresh()},error:function(e){if(parseInt(e.statusCode,[10])!==404){g.show(n.getI18nText("reconServiceCallError"))}}})},_fetchCnsldVersion:fu+
nction(){let e=this.getModel(),n=this.getModel("viewConfigDataModel").getData(),o=n.globalParameters.ConsolidationGroup,i="/xEY1xSAV_C_Get_Version(p_congr='"+o+"')/Set",a=this,r=new t;sap.ui.getCore().setModel(r,"viewCnlVersionModel");e.read(i,{method:"G+
ET",sorters:[new sap.ui.model.Sorter("FiscalYear")],success:function(e,t){sap.ui.getCore().getModel("viewCnlVersionModel").setData({ConsolidationVersion:e})},error:function(e){if(parseInt(e.statusCode,[10])!==404){g.show(a.getI18nText("GetConsolidationVe+
rsionServiceCallError"))}}})},_createJournalEntriesFilterData:function(e){let t=e.getSource().getBindingContext();if(!t.getProperty("GLAccount")){return}let n=this.getModel("viewConfigDataModel").getData(),o=this.getView().byId("idFiscalYearFilter"),i=o.+
getDateValue().getFullYear(),a=parseInt(this.getView().byId("idPeriodFromInput").getValue(),[10]),r=parseInt(this.getView().byId("idPeriodToInput").getValue(),[10]),l=this.getView().byId("idConsUnit"),d=this.getView().byId("idCurrency"),g=this.getView().+
byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel").getObject(),c=s.convertStringToInt(g.PeriodTo)===0?"":s.convertStringToInt(g.TaxIntention),u=e.getSource().getCustomData(),p="",h=[],f="",m=n.globalParameters.Consolidati+
onGroup;for(let e of u){let t=e.getValue();let o=e.getKey();if(o==="mappedLedger"&&t==="GAAPLedger"){p=n.reconData.gaap;continue}else if(o==="mappedLedger"&&t==="GAAPToSTATLedger"){p=n.reconData.g2s;continue}else if(o==="mappedLedger"&&t==="STATLedger"){+
p=n.reconData.stat;continue}else if(o==="mappedLedger"&&t==="STATToTAXLedger"){p=n.reconData.s2t;f=t;continue}else if(o==="mappedLedger"&&t==="TAXLedger"){p=n.reconData.tax;continue}else if(o==="mappedAdjReason"&&(t==="P&L"||t==="EQ"||t==="OP&L"||t==="OP+
ERMANENT"||t==="OEQ"||t==="PERMANENT")){for(let e=0;e<n.adjustmentReason.length;e++){if(n.adjustmentReason[e].AdjustmentReason===t){h.push(n.adjustmentReason[e].TransType)}}continue}}let C=t.getProperty("GLAccount").padStart(10,"0");let y=e.getSource().g+
etBindingInfo("text").parts,I=y[y.map(e=>e.path.indexOf("MainCurrency")!==0).indexOf(true)].path;let b=this.serviceDataProperty.property;b=b[b.map(e=>e.name).indexOf(I)];let T=b.extensions;T=T[T.map(e=>e.name).indexOf("label")];return{ConsolidationChartO+
fAccounts:n.globalParameters.ConsolidationChartofAccounts,FiscalYear:i,PeriodFrom:a||"1",PeriodTo:r||"12",ConsolidatioUnit:l.getSelectedKey(),ConsolidationLedger:p,Value:t.getProperty(I),Currency:t.getProperty("MainCurrency"),GLAccount:C,GLAccountDesc:t.+
getProperty("GLAccountMdmText"),ConsolidationVersion:"",SelectedIntention:c,ConsolidationGroup:"",PeriodMode:"PER",RefConsolidationDocumentType:"W",selectedCurrency:d.getSelectedKey(),SectionName:T.value,FinancialTransactionType:h,NavLedger:f,Congr:m}},_+
createPTAEntriesFilterData:function(e){let t=e.getSource().getBindingContext(),n=this.getView().byId("idFiscalYearFilter"),o=n.getDateValue().getFullYear(),i=parseInt(this.getView().byId("idPeriodFromInput").getValue(),[10]),a=parseInt(this.getView().byI+
d("idPeriodToInput").getValue(),[10]),r=this.getView().byId("idConsUnit"),s=t.getProperty("GLAccount"),l=parseInt(this.getView().byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel").getObject().TaxIntention,[10]),d=l>12?l:"+
";let g=e.getSource().getBindingInfo("text").parts,c=g[g.map(e=>e.path.indexOf("MainCurrency")!==0).indexOf(true)].path;let u=this.serviceDataProperty.property;u=u[u.map(e=>e.name).indexOf(c)];let p=u.extensions;p=p[p.map(e=>e.name).indexOf("label")];ret+
urn{FiscalYear:o,PeriodFrom:i,PeriodTo:a,ConsolidationUnit:r.getSelectedKey(),Value:t.getProperty(c),Currency:t.getProperty("MainCurrency"),GLAccount:s,GLAccountDesc:t.getProperty("GLAccountMdmText"),SectionName:p.value,SelectedIntention:d}},_fetchCurren+
cyData:function(e){var n=this.getView(),o=n.byId("idConsUnit").getSelectedKey(),i=new l("ConsolidationUnit",d.EQ,o),a=this.getModel(),r=this,s=n.byId("idCurrType"),g=n.byId("idCurrency");s.setVisible(true);g.setBusy(true);a.read("/xEY1xSAV_C_CurrLocalGro+
upVH",{method:"GET",filters:[i],success:function(n,o){g.setBusy(false);r.setModel(new t(n),"currLocalGroupVHModel");if(!e&&n.results.length>0){g.setSelectedKey(n.results[0].Currency)}},error:function(e){g.setBusy(false);c.error(r.getI18nText("errorIntent+
ionServiceCall"))}})},fetchReconLedgerData:function(e){let t=this.getModel();let n=t.createKey("/xEY1xSAV_C_Recon_Ledger",{bunit:this.byId("idConsUnit").getSelectedKey()});let o=this;this.getBusyDialog().open();t.read(n,{method:"GET",success:function(e,t+
){o.getBusyDialog().close();var n=o.getModel("viewConfigDataModel");n.getData().reconData=e;n.refresh();o._fetchCnsldVersion()},error:function(e){o.getBusyDialog().close();if(parseInt(e.statusCode,[10])!==404){g.show(o.getI18nText("reconServiceCallError"+
))}}})},_fetchIntentionStatus:function(e){let n=this.getModel();let o=e[0],i=e[1],a="/xEY1xSAV_C_IntentionsStatus(p_bunit='"+o+"')/Set",r=new l("Gjahr",d.EQ,i),s=this,g=s.getView(),u=g.byId("idIntentionComboBox");this.getBusyDialog().open();n.read(a,{met+
hod:"GET",sorters:[new sap.ui.model.Sorter("SerialNumber")],filters:[r],success:function(e,n){s.getBusyDialog().close();if(e.results.length===0){u.setSelectedKey("");u.setEnabled(false);c.error(s.getI18nText("IntentionNotYetOpen")+i);s._disableButton(fal+
se);return}u.setEnabled(true);let o=s.getView().getModel("viewConfigDataModel").getData().globalParameters;u.setSelectedKey(o.Intention);let a=new t(e);s.getView().setModel(a,"intentionVHModel");s._managePeriodFieldsEditability(false)},error:function(e){+
s.getBusyDialog().close();c.error(s.getI18nText("errorFetchingIntentionStatus"))}})},_managePeriodFieldsEditability:function(e){let t=this.getView(),n=t.byId("idIntentionComboBox");if(!e){n.setSelectedKey(n.getSelectedKey())}let o=n.getSelectedItem(),i=o+
.getBindingContext("intentionVHModel").getObject();let a=t.byId("idPeriodToInput"),r=s.convertStringToInt(i.TaxIntention);if(r!==s.convertStringToInt(0)){this._manageIntentionStatus(i);a.setEditable(false);a.setValue(s.convertStringToInt(i.PeriodTo))}els+
e{a.setEditable(true);a.setValue(s.convertStringToInt(i.CurrOpenPeriod));let e=parseInt(a.getValue(),[10]);this._managePerodicIntentionStatus(e)}},_manageIntentionStatus:function(e){let t=this;if(e.status==="Closed"){this._disableButton(false);return}els+
e if(e.status===this.getI18nText("YetToOpen")){t.getBusyDialog().close();c.error(e.IntentDescription+" "+t.getI18nText("ThisIntentionNotYetOpen")+e.Gjahr);this._disableButton(false);return}else if(e.status==="Open"){this._disableButton(true)}},_managePer+
odicIntentionStatus:function(e){let t=this.getView().byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel").getObject(),n=parseInt(t.CurrOpenPeriod,[10]);if(t.status==="Closed"){this._disableButton(false);return}if(e===n){thi+
s._disableButton(true)}else if(e<n){this._disableButton(false);return}else if(e>n){this.getBusyDialog().close();c.error(this.getModel("i18n").getResourceBundle().getText("errorPeriodnotopen",[e,n]));this._disableButton(false);return}else{this._disableBut+
ton(false);return}},_disableButton:function(e){this.byId("idDataMonitor").setEnabled(e);this.byId("idNavToPostGLEntriesLC").setEnabled(e);this.byId("idPostPTAEntriesBtn").setEnabled(e)},getI18nText:function(e){return this.getResourceBundle().getText(e)},+
onBeforeVariantSaveFilterBar:function(e){let t=this.getView();let n=t.byId("idsmartFilterBar");let o=t.byId("idConsUnit");let i=t.byId("idFiscalYearFilter");let a=t.byId("idIntentionComboBox");let r=t.byId("idCurrency");let s=t.byId("idPeriodToInput");n.+
setFilterData({_CUSTOM:{ConsolidationUnit:o.getSelectedKey(),FiscalYear:i.getValue(),Intention:a.getSelectedKey(),Currency:r.getSelectedKey(),PeriodTo:s.getValue(),VariantID:n.getCurrentVariantId()}})},onAfterVariantLoadFilterBar:function(e){var t=this.g+
etView();var n=t.byId("idsmartFilterBar");var o=t.byId("idConsUnit");var i=t.byId("idFiscalYearFilter");let a=t.byId("idIntentionComboBox");var r=t.byId("idCurrency");let l=this.getView().byId("idPeriodToInput");var d=n.getFilterData()["_CUSTOM"];o.setSe+
lectedKey(d.ConsolidationUnit);i.setValue(d.FiscalYear);a.setSelectedKey(d.Intention);r.setSelectedKey(d.Currency);l.setValue(s.convertStringToInt(d.PeriodTo));if(d.ConsolidationUnit){this.fetchReconLedgerData()}if(d.Currency){r.setVisible(true);this._fe+
tchCurrencyData(true)}var g=[o,i];this._fetchIntentionStatus(g)},onSearchButtonPressed:function(e){this.getView().byId("idFStxt").setVisible(true);let t=this.getModel().getServiceMetadata().dataServices.schema[0].entityType;this.serviceDataProperty=t.fin+
d(e=>e.name==="xEY1xSAV_C_ReconciliationResult");this.fetchReconLedgerData(e)},onShareInJamPress:function(){var e=this.getModel("worklistView"),t=I.createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:location.hr+
ef,share:e.getProperty("/shareOnJamTitle")}}});t.open()},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh()}else{var t=[];var n=e.getParameter("query");if(n&&n.length>0){t=[new l("GLAccount",d.Contains,n)]}this._applySearch(+
t)}},onLCDataReceived:function(e){this.getBusyDialog().open();this.oGlobalSmartTable.getTable().setVisibleRowCount(10);let t=this.getView(),n=t.byId("idFStxt"),o=t.byId("idFSItem");this.oGlobalSmartTable.getCustomToolbar().getContent()[8].attachPress(thi+
s._onSetPress,this);if(o.getGrouped()){n.setVisible(true)}else{n.setVisible(false)}var i=window.setInterval(function(){this.onAdjustLCCol();window.clearInterval(i)}.bind(this),1e3)},_onSetPress:function(){this.getView().byId("idFStxt").setVisible(true)},+
onAdjustLCCol:function(){let e=this.oGlobalSmartTable;var t=e.getTable();var n=t.getColumns();for(var o=n.length-1;o>=0;o--){t.autoResizeColumn(o)}t.setFixedColumnCount(4);this.getBusyDialog().close()},onChangeDatePickerFilter:function(e){let t=e.getSour+
ce(),n=this.getModel("viewConfigDataModel").getData(),o=n.globalParameters.ConsolidationUnit;if(e.getParameter("valid")){t.setValueState("None");let e=t.getDateValue().getFullYear(),n=[o,e];this._fetchIntentionStatus(n)}else{t.setValueState("Error")}},on+
ConsUnitChange:function(e){this._fetchCurrencyData(false)},onChangeIntentionComboBox:function(e){let t=this.getView(),n=t.byId("idIntentionComboBox"),o=n.getSelectedItem();if(!o){n.setSelectedItem("");return}this._managePeriodFieldsEditability(true)},onC+
urrTypeChange:function(){},onLiveChangePeriodTo:function(){let e=this.getView().byId("idPeriodToInput");let t=parseInt(this.getView().byId("idPeriodFromInput").getValue(),[10]);let n=parseInt(e.getValue(),[10]);e.setValueState("None");if(n<t){e.setValueS+
tate("Error");e.setValueStateText(this.getI18nText("periodToLessThanPeriodFromErrorMsg"));return}else if(n>12){e.setValueState("Error");e.setValueStateText(this.getI18nText("periodToGreaterThanLastPeriod"));return}else{this._managePerodicIntentionStatus(+
n)}},onPressGLAccountNavigation:function(e){this.performCrossAppNavigation("AccountingDocument","postGLDocument",true)},_generateMessagePopover:function(){let e=this;this.oMP=new n({activeTitlePress:function(t){let n=t.getParameters().item.getProperty("t+
itle");let o=t.getSource().getModel().getData().results;for(let t=0;t<o.length;t++){if(n===o[t].MessageText){let n=o[t].LogNumber;n=e._removeChar(n,"-");n=n.trim();n=n.toUpperCase();let i=sap.ushell.Container.getService("CrossApplicationNavigation");i.is+
IntentSupported(["ConsolidationLog-log"]).done(function(e){}).fail(function(){new sap.m.MessageToast("Provide corresponding intent to navigate")});let a=i&&i.hrefForExternal({target:{semanticObject:"ConsolidationLog",action:"log"}})||"";let r=a+"&/LogHea+
derSet/"+n;let s=window.location.href.split("#")[0]+r;sap.m.URLHelper.redirect(s,true)}}},items:{path:"/results",template:new o({title:"{MessageText}",subtitle:"",activeTitle:{parts:[{path:"URL"}],formatter:this._isActive},type:{path:"Type",formatter:thi+
s.formatMessageType},description:"{MessageText}"})},groupItems:true});this.getView().addDependent(this.oMP);this.getView().byId("idMessagePopoverBtn").setVisible(true);this._buttonTextFormatter();this._buttonIconFormatter();setTimeout(function(){this.oMP+
.openBy(this.getView().byId("idMessagePopoverBtn"))}.bind(this),100)},onCloseToolbarPress:function(e){this.getView().byId("idReconAppFooterOverflowToolbar").setVisible(false)},_buttonTypeFormatter:function(){var e;var t=this._oDataMonitor.getContent()[0]+
.getModel().getData().results;t.forEach(function(t){switch(t.Type){case"E":e="Negative";break;case"W":e=e!=="Negative"?"Critical":e;break;case"S":e=e!=="Negative"&&e!=="Critical"?"Success":e;break;default:e=!e?"Neutral":e;break}});return e},_buttonTextFo+
rmatter:function(){let e=this._buttonTypeFormatter();let t=this._oDataMonitor.getContent()[0].getModel().getData().results;let n;switch(e){case"Negative":n="Error";break;case"Critical":n="Warning";break;case"Success":n="Success";break;default:n=!n?"Infor+
mation":n;break}this.getView().byId("idMessagePopoverBtn").setText(t.length)},_buttonIconFormatter:function(){var e;var t=this._oDataMonitor.getContent()[0].getModel().getData().results;t.forEach(function(t){switch(t.Type){case"E":e="sap-icon://message-e+
rror";break;case"W":e=e!=="sap-icon://message-error"?"sap-icon://message-warning":e;break;case"S":e="sap-icon://message-error"&&e!=="sap-icon://message-warning"?"sap-icon://message-success":e;break;default:e=!e?"sap-icon://message-information":e;break}})+
;this.getView().byId("idMessagePopoverBtn").setIcon(e)},_isActive:function(e){if(e===""){return false}else{return true}},formatMessageType:function(e){if(e==="E"){return a.MessageType.Error}else if(e==="S"){return a.MessageType.Success}else{return a.Mess+
ageType.Warning}},onhandleMessagePopoverPress:function(e){this.oMP.toggle(e.getSource())},onDataMonitorPress:function(e){let n=this,o=this.getOwnerComponent().getModel(),i=this.getView().byId("idConsUnit"),a=[],r="/LedgerSet",s=new l({path:"BUnit",operat+
or:d.EQ,value1:i.getSelectedItem().getKey()});if(this.oMP){let e=new t;let n=[];e.setData(n);this.oMP.setModel(e);this.getView().byId("idMessagePopoverBtn").setVisible(false)}this.getView().byId("idReconAppFooterOverflowToolbar").setVisible(true);this.ge+
tBusyDialog().open();a.push(s);o.read(r,{filters:a,success:n._onLedgerSetSuccess.bind(this),error:n._onLedgerSetError.bind(this)})},_onLedgerSetSuccess:function(e){let t=this.getOwnerComponent().getModel(),n=this.getView().byId("idConsUnit"),o=this.getVi+
ew().byId("idFiscalYearFilter"),i=this.getView().byId("idCurrency"),a=this.getModel("currLocalGroupVHModel"),r="/DataMonitorParameters";if(!this._oDataMonitor){this._oDataMonitor=sap.ui.xmlfragment("ey.sap.fin.cs.recgaapstattax.fragment.DataMonitorLog",t+
his);this.getView().addDependent(this._oDataMonitor)}let s=this._oDataMonitor.getContent()[0];if(s.getModel().getData()){let e=null;s.getModel().setData(e)}let l=0;let d={Action:"'"+1015+"'",ConsolidationUnit:"'"+n.getSelectedItem().getKey()+"'",FiscalYe+
ar:"'"+o.getDateValue().getFullYear()+"'",Ledger:"'"+e.results[l].RLDNR+"'",GroupCurrency:"'"+a.getData().results[1].Currency+"'",LocalCurrency:"'"+i.getSelectedItem().getKey()+"'",PeriodFrom:"'"+this.getView().byId("idPeriodFromInput").getValue()+"'",Pe+
riodTo:"'"+this.getView().byId("idPeriodToInput").getValue()+"'"};this._callDataMonitorFunctionImportRecursion(t,r,l,d.Action,d.ConsolidationUnit,d.FiscalYear,e.results,d.GroupCurrency,d.LocalCurrency,d.PeriodFrom,d.PeriodTo,e.results.length)},_callDataM+
onitorFunctionImportRecursion:function(e,t,n,o,i,a,r,s,l,d,g,c){let u={Action:o,ConsolidationUnit:i,FiscalYear:a,Ledger:"'"+r[n].RLDNR+"'",GroupCurrency:s,LocalCurrency:l,PeriodFrom:d,PeriodTo:g};this._callDataMonitorFunctionImport(this,t,e,u,n,o,i,a,r,s+
,l,d,g,c)},_callDataMonitorFunctionImport:function(e,n,o,i,a,r,s,l,d,g,u,p,h,f){o.read(n,{method:"GET",urlParameters:i,success:function(i){let c=e._oDataMonitor.getContent()[0];let m=c.getModel().getData();c.setBusy(true);let C=new t;if(!m){m=i}else{for(+
let e=0;e<i.results.length;e++){m.results.push(i.results[e])}}C.setData(m);c.setModel(C);a=a+1;if(a<f){e._callDataMonitorFunctionImportRecursion(o,n,a,r,s,l,d,g,u,p,h,f)}else{c.setBusy(false);e.getBusyDialog().close();e._generateMessagePopover();if(e._oD+
ataMonitor){let t=e._oDataMonitor.getContent()[0];if(t.getModel().getData()){e.oMP.setModel(t.getModel())}}}},error:function(t){e.getBusyDialog().close();c.error(e.getI18nText("errorDataMonitor"))}});o.submitChanges()},_onLedgerSetError:function(e){this.+
getBusyDialog().close();c.error(this.getI18nText("errorLedgerSet"))},onPressOkBtnDataMonitor:function(e){this.getBusyDialog().close();this._oDataMonitor.close()},onDataMonitorListItemPress:function(e){let t=this._oDataMonitor.getContent()[0].getModel().g+
etData().results,n=e.getSource().getText(),o;for(let e=0;e<t.length;e++){if(t[e].MessageText===n){o=t[e].LogNumber}}o=this._removeChar(o,"-");o=o.trim();o=o.toUpperCase();var i=sap.ushell.Container.getService("CrossApplicationNavigation");i.isIntentSuppo+
rted(["ConsolidationLog-log"]).done(function(e){}).fail(function(){new sap.m.MessageToast("Provide corresponding intent to navigate")});var a=i&&i.hrefForExternal({target:{semanticObject:"ConsolidationLog",action:"log"}})||"";var r=a+"&/LogHeaderSet/"+o;+
var s=window.location.href.split("#")[0]+r;sap.m.URLHelper.redirect(s,true)},_removeChar:function(e,t){let n,o=0,i=e.length;let a=e.split("");for(let e=n=0;e<i;e++){if(a[e]!==t)a[n++]=a[e];else o++}while(o>0){a[n++]=" ";o--}return a.join("")},onPressJour+
nalEntriesDetail:function(e){var n=this._createJournalEntriesFilterData(e);if(!n){return}var o=new t(n);this.getOwnerComponent().setModel(o,"JournalEntryData");this.oRouter.navTo("JournalEntries")},onPressPTAEntriesDetail:function(e){var n=this._createPT+
AEntriesFilterData(e);if(n.GLAccount===this.getI18nText("BalanceCheckSumLabel")){return}var o=new t(n);this.getOwnerComponent().setModel(o,"PTAEntryConfigData");this.oRouter.navTo("PTAEntries")},onPressPostPTAEntriesBtn:function(e){let t=this.oGlobalSmar+
tTable.getTable(),n=t.getBinding(),o=t.getSelectedIndices(),i=[];if(!o.length>0){c.error(this.getI18nText("errorNoGlAccountSelected"));return}if(y){let e=n.getLength()-1;for(let t=0;t<e;t++){let e=n.getContextByIndex(t).getObject();i.push(e.GLAccount)}}e+
lse{for(let e of o){let t=n.getContextByIndex(e).getObject();i.push(t.GLAccount)}}this.validatePAndLAccounts(i)},validatePAndLAccounts:function(e){let n=this.getModel(),o=this,i="P&L",a=[],r,s=this.getOwnerComponent().getModel("postPTAEntriesConfigModel"+
),u=s.getData(),p=this.getView().byId("idConsUnit"),h=this.getView().byId("idFiscalYearFilter"),f=parseInt(this.getView().byId("idPeriodToInput").getValue(),[10]),m=this.getView().byId("idIntentionComboBox").getSelectedItem().getBindingContext("intention+
VHModel").getObject(),C=this.getView().byId("idCurrency"),y=this.getView().getModel("viewConfigDataModel").getData(),I=this.getModel("currLocalGroupVHModel"),b=this.oGlobalSmartTable.getTableBindingPath()+"/$count",T="/PostingDate",S=new t;sap.ui.getCore+
().setModel(S,"viewPostingDataModel");n.callFunction(T,{method:"GET",urlParameters:{ConsolidationUnit:p.getSelectedItem().getKey(),FiscalYear:h.getDateValue().getFullYear(),Poper:f},success:function(e){sap.ui.getCore().getModel("viewPostingDataModel").se+
tData({PostingDate:e})},error:function(e){if(parseInt(e.statusCode,[10])!==404){g.show(o.getI18nText("GetPostingDateServiceCallError"))}}});for(let t of e){a.push(new l("GLAccount",d.EQ,t))}r=new l({filters:[new l({filters:a}),new l("BsEqPl",d.EQ,i),u.oM+
ainServiceFilters],and:true});this.getBusyDialog().open();n.read(b,{method:"GET",filters:[r],success:function(t){o.getBusyDialog().close();if(parseInt(t,[10])>0&&parseInt(t,[10])===e.length){u.postPTAEntriesList=e;u.ConsolidationUnit=p.getSelectedItem().+
getKey();u.FiscalYear=h.getDateValue().getFullYear();u.CurrencyType=C.getSelectedItem().getAdditionalText();u.globalParameterData=y;u.currLocalGroupVHData=I.getData();if(m.TaxIntention<=105&&m.TaxIntention>=101){u.TaxIntention=m.TaxIntention;u.TaxIntenti+
onDesc=m.IntentDescription}else{u.TaxIntention=""}u.postingDate=sap.ui.getCore().getModel("viewPostingDataModel").getData().PostingDate;s.setData(u);o.getBusyDialog().open();o.oRouter.navTo("PostPTAEntries")}else{c.error(o.getI18nText("errorSelectOnlyPnL+
Accounts"))}},error:function(e){o.getBusyDialog().close();c.error(o.getI18nText("errorValidatingPnLAccount"))}})},onPressRowSelectionChangeAnalyticalTable:function(e){y=false;if(e.getParameters().selectAll){y=e.getParameters().selectAll;return}},onPressO+
kBtnAppSettingsCTA:function(e){let t=this.getView().byId("idsmartFilterBar").validateMandatoryFields();if(t){this.oGlobalSmartTable.rebindTable()}this._oAppSettingDialogCTA.close()},onPressReconciliationAnalyticsBtn:function(e){let t=this.getView(),n=t.g+
etModel("viewConfigDataModel").getData(),o=t.byId("idConsUnit").getSelectedKey(),i=t.byId("idFiscalYearFilter").getDateValue().getFullYear(),a=parseInt(i,[10])-1,r=parseInt(t.byId("idPeriodFromInput").getValue(),[10]),s=parseInt(t.byId("idPeriodToInput")+
.getValue(),[10]),g=t.byId("idCurrency").getSelectedKey(),c=this._oAppSettingDialogCTA.getContent().find(e=>e.getId()==="idAppSettingsCTAIsCTAIncludedCheckBox"),u=c.getSelected()?"X":"",p=t.byId("idIntentionComboBox").getSelectedItem().getBindingContext(+
"intentionVHModel"),h=parseInt(p.getObject().TaxIntention,[10]),f=h>12?h:"",m=new l({filters:[new l("ConsolidationUnit",d.EQ,o),new l("ChartOfAccounts",d.EQ,"CANA"),new l("ConsolidationChartofAccounts",d.EQ,n.globalParameters.ConsolidationChartofAccounts+
),new l("MainCurrency",d.EQ,g)],and:true});let C=this.getView().byId("idgaaptostat").getTable().getBinding(),y=[];if(C.getSelectedContexts()&&C.getSelectedContexts().length>0){let e=C.getSelectedContexts(),t;for(t=0;t<e.length;t++){y.push(new l("GLAccoun+
t",d.EQ,e[t].getObject().GLAccount))}m=new l({filters:[m,new l({filters:y})],and:true})}let I=this,b="/xEY1xSAV_C_Reconciliation(p_ryear='"+i+"',p_fromyb='"+r+"',p_toyb='"+s+"',p_switch='"+u+"',p_taxintention='"+f+"')/Results",T="/xEY1xSAV_C_Reconciliati+
on(p_ryear='"+a+"',p_fromyb='"+r+"',p_toyb='"+s+"',p_switch='"+u+"',p_taxintention='"+f+"')/Results",S=this.fetchAnalyticsReconData(b,m),P=this.fetchAnalyticsReconData(T,m);this.getBusyDialog().open();Promise.all([S,P]).then(e=>{I.getBusyDialog().close()+
;I.initializeAnalytics(e)})},fetchAnalyticsReconData:function(e,t){let n=this.getOwnerComponent().getModel(),o=new Promise(function(o,i){n.read(e,{method:"GET",filters:[t],sorters:[new sap.ui.model.Sorter("GLAccount")],success:function(e,t){o(e)},error:f+
unction(e){i(e)}})});return o},initializeAnalytics:function(e){if(!this._oAnalyticsDialog){this._oAnalyticsDialog=sap.ui.xmlfragment("ey.sap.fin.cs.recgaapstattax.fragment.ReconAnalytics",this);this.getView().addDependent(this._oAnalyticsDialog)}this._oA+
nalyticsDialog.open();this._oAnalyticsDialog.setModel(new t({results:[{propertyName:"GaapOpeningBalance",text:"GAAP OB"},{propertyName:"GaapYearBalance",text:"GAAP Mvmnt"},{propertyName:"GaapClosingBalance",text:"GAAP CB"},{propertyName:"GaapToStatPL",te+
xt:"G2S P&L"},{propertyName:"GaapToStatPmnt",text:"G2S PERM"},{propertyName:"GaapToStatEQ",text:"G2S EQ"},{propertyName:"StatOpeningBalance",text:"STAT OB"},{propertyName:"StatYearBalance",text:"STAT Mvmnt"},{propertyName:"StatClosingBalance",text:"STAT +
CB"}]}),"modelMeasureList");I.byId("idMeasuresList").setSelectedKey("GaapOpeningBalance");this.addFeedsToChart();C.numericFormatter(m.getInstance());let n=m.DefaultPattern,o=I.byId("idVizFrame"),i=[],a,r=I.byId("idPopOver"),s=sap.ui.getVersionInfo().libr+
aries||[],l=s.some(function(e){return e.name.indexOf("sap.suite.ui.commons")>-1});e.map(e=>e.results.map(e=>i.push(e)));a=new t({results:i});o.setVizProperties({plotArea:{dataLabel:{formatString:n.SHORTFLOAT_MFD2,visible:true}},valueAxis:{label:{formatSt+
ring:n.SHORTFLOAT},title:{visible:false}},categoryAxis:{title:{visible:false}},title:{visible:false,text:"OB GAAP to STAT to TAX"}});o.setModel(a,"chartModelAnalytics");r.connect(o.getVizUid());r.setFormatString(n.STANDARDFLOAT);if(l){jQuery.sap.require(+
"sap/suite/ui/commons/ChartContainer");let e=I.byId("idVizFrame"),t=new sap.suite.ui.commons.ChartContainerContent({icon:"sap-icon://vertical-bar-chart",title:"OB GAAP to STAT to TAX",content:[e]}),n=new sap.suite.ui.commons.ChartContainer({content:[t]})+
;n.setShowFullScreen(true);n.setAutoAdjustHeight(true);I.byId("chartFixFlex").setFlexContent(n)}},handleMeasureListChange:function(e){this.addFeedsToChart()},addFeedsToChart:function(){let e=I.byId("idVizFrame");e.removeAllFeeds(true);e.destroyFeeds();e.+
addFeed(new sap.viz.ui5.controls.common.feeds.FeedItem({type:"Dimension",uid:"categoryAxis",values:["ddGLAccount"]}));e.addFeed(new sap.viz.ui5.controls.common.feeds.FeedItem({type:"Dimension",uid:"categoryAxis",values:["ddFiscalYear"]}));e.addFeed(new s+
ap.viz.ui5.controls.common.feeds.FeedItem({type:"Measure",uid:"valueAxis",values:[I.byId("idMeasuresList").getSelectedItem().getText()]}))},onPressOkBtnReconAnalytics:function(e){this._oAnalyticsDialog.close()},onPressReconciliationSmartChartBtn:function+
(){this.getView().byId("idSmartChartRecon").rebindChart()}})});                                                                                                                                                                                                