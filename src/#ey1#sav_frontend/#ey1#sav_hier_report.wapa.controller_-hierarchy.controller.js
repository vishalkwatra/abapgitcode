sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/ListItem","sap/ui/generic/app/navigation/service/NavigationHandl+
er"],function(t,e,a,n,r,o,i,l,s){"use strict";let T=[];return t.extend("ey.sap.fin.cs.hierarchyReport.controller.hierarchy",{formatter:a,onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("Routehierarchy").attachMat+
ched(this._onRouteMatched,this);let t=new e;this.setModel(t,"viewConfigDataModel");let a=[{name:this.getI18nText("FSItemText"),key:"CS15"},{name:this.getI18nText("GLAccVHText"),key:"0109"}];var n=new e;this.setModel(n,"HierDatModel");var r=new e;this.set+
Model(r,"HierDatModelGL");let o=new e(a);this.setModel(o,"hierVHModel");let i={cols:[{label:this.getI18nText("labelHierId"),template:"HierarchyId",width:"6%",resizable:"false"},{label:this.getI18nText("labelHierIdDes"),template:"HierarchyText",width:"13%+
",resizable:"false"}]},l=new e(i);this.setModel(l,"VHColumnModel");this._fetchGlobalParameters();this._fetchAdjustmentReasons();this.getView().byId("idHierType").setSelectedKey("CS15");this._fetchValueHelpHierarchyTxt(this.getView().byId("idHierType").ge+
tSelectedKey())},onAfterRendering:function(){let t=sap.ushell.services.AppConfiguration,e=this.getI18nText("textMenuItemCTAForPnL"),a=this;if(!this._oAppSettingDialogCTA){this._oAppSettingDialogCTA=sap.ui.xmlfragment("ey.sap.fin.cs.hierarchyReport.fragme+
nt.AppSettingCTA",this);this.getView().addDependent(this._oAppSettingDialogCTA)}let n=new sap.m.Button({text:e,press:function(t){if(!a._oAppSettingDialogCTA){a._oAppSettingDialogCTA=sap.ui.xmlfragment("ey.sap.fin.cs.recgaapstattax.fragment.AppSettingCTA"+
,a);a.getView().addDependent(a._oAppSettingDialogCTA)}a._oAppSettingDialogCTA.open()}});t.addApplicationSettingsButtons([n])},_onRouteMatched:function(){this.getBusyDialog().close()},_fetchValueHelpHierarchyTxt:function(t){let a=this.getOwnerComponent().+
getModel("oManageHierModel"),o=this,l=new n({filters:[new n("HierarchyCategory",r.EQ,t),new n("VersionStatus",r.EQ,"A")],and:true}),s=l;a.read("/HierarchyVersionSet",{method:"GET",filters:[s],success:function(t){let a=new e(t.results);o.setModel(a,"hiera+
rCatModel")},error:function(t){i.error(o.getI18nText("errorFetchingHierCatTxtData"))}})},_fetchAdjustmentReasons:function(){let t=this.getOwnerComponent().getModel();let e="/xEY1xSAV_C_Recon_Adj_Reason";let a=this;t.read(e,{method:"GET",success:function(+
t,e){var n=a.getModel("viewConfigDataModel");n.getData().adjustmentReason=t.results;n.refresh()},error:function(t){if(parseInt(t.statusCode,[10])!==404){o.show(a.getI18nText("adjustmentReasonsServiceCallError"))}}})},_filterVHTable:function(t){let e=this+
;this._oHierIdVHDialog.getTableAsync().then(function(a){if(t.aFilters.length===0){a.getBinding("rows").filter(t);a.getModel().refresh(true)}else{a.getBinding("rows").filter(t)}e._oHierIdVHDialog.update()})},_fetchReconData:function(){let t=this.getOwnerC+
omponent().getModel(),a=this,o=this.getView(),l=o.getModel("viewConfigDataModel").getData();if(!l.globalParameters||!l.globalParameters.ConsolidationChartofAccounts||!l.globalParameters.ConsolidationGroup){i.error(this.getI18nText("errorMaintainGlobalPar+
ameter"));return}let s=o.byId("idConsUnit"),T=s.getSelectedKey(),c=o.byId("idCurrency"),S=c.getSelectedKey(),d=o.byId("idFiscalYearFilter"),p=d.getDateValue().getFullYear(),g=o.byId("idPeriodFromInput"),h=o.byId("idPeriodToInput"),u=parseInt(g.getValue()+
,[10]),C=parseInt(h.getValue(),[10]),x=this._oAppSettingDialogCTA.getContent().find(t=>t.getId()==="idAppSettingsCTAIsCTAIncludedCheckBox"),P=x.getSelected()?"X":"",G=o.byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel"),f+
=parseInt(G.getObject().TaxIntention,[10]),A=G.getObject().TaxIntention,B=f>100?f:"",I,y,O;I=new n({filters:[new n("ConsolidationUnit",r.EQ,T),new n("ConsolidationChartofAccounts",r.EQ,l.globalParameters.ConsolidationChartofAccounts),new n("MainCurrency"+
,r.EQ,S)],and:true});O=I;u=u?u<0?0:u>12?12:u:1;C=C?C<0?0:C>12?12:C:12;let m="/xEY1xSAV_C_Reconciliation(p_ryear='"+p+"',p_fromyb='"+u+"',p_toyb='"+C+"',p_switch='"+P+"',p_taxintention='"+B+"',p_intention='"+A+"')/Results";t.read(m,{filters:[O],method:"GE+
T",success:function(t){let n=new e(t.results);a.setModel(n,"oReconModel")},error:function(t){i.error(a.getI18nText("errorFetchingRecon"))}})},_fetchTreeData:function(){let t=this.getOwnerComponent().getModel("oManageHierModel"),e=this,a=this.getView(),o=+
a.byId("idHierCatTextInpt").getSelectedKey(),l=a.byId("idHierType").getSelectedKey(),s=new n({filters:[new n("HierarchyCategory",r.EQ,l),new n("HierarchyId",r.EQ,o)],and:true});t.read("/HierarchyVersionSet",{filters:[s],method:"GET",success:function(t){e+
._fetchInitialHierarchy(t.results[0].VersionId)},error:function(t){i.error(e.getI18nText("errorFetchingHierData"))}})},_fetchInitialHierarchy:function(t){let e=this.getOwnerComponent().getModel("oManageHierModel"),a=new n("NodeLevel",r.LE,1),o=this.getVi+
ew().byId("idHierType").getSelectedKey(),l=this;e.read("/HierarchyVersionSet('"+t+"')/Nodes",{filters:[a],method:"GET",success:async function(a){for(let n=0;n<a.results.length;n++){a.results[n].Covered="";a.results[n].GaapOpeningBalance=0;a.results[n].Ga+
apYearBalance=0;a.results[n].GaapCTA=0;a.results[n].GaapClosingBalance=0;a.results[n].GaapToStatPL=0;a.results[n].GaapToStatPmnt=0;a.results[n].GaapToStatEQ=0;a.results[n].GaapToStatOtherPL=0;a.results[n].GaapToStatOtherPmnt=0;a.results[n].GaapToStatOthe+
rEQ=0;a.results[n].G2SCTA=0;a.results[n].StatOpeningBalance=0;a.results[n].StatPYA=0;a.results[n].StatYearBalance=0;a.results[n].StatCTA=0;a.results[n].StatClosingBalance=0;a.results[n].StatToTaxPL=0;a.results[n].StatToTaxPmnt=0;a.results[n].StatToTaxEQ=+
0;a.results[n].StatToTaxOtherPL=0;a.results[n].StatToTaxOtherPmnt=0;a.results[n].StatToTaxOtherEQ=0;a.results[n].S2TCTA=0;a.results[n].TaxOpeningBalance=0;a.results[n].TaxPYA=0;a.results[n].TaxYearBalance=0;a.results[n].TaxCTA=0;a.results[n].TaxClosingBa+
lance=0;a.results[n].TaxPTA=0;a.results[n].MainCurrency="";T.push(a.results[n]);if(a.results[n].NodeParentId){await l.__recCallHierarchy(a.results[n].NodeId,e,l,t)}}if(o==="CS15"){l._calculateAmountFSItem(T)}else{l._calculateAmountGLAcc(T)}l.getView().by+
Id("idTreeHierFSItem").setBusy(false);l.getView().byId("idTreeHierGLAcc").setBusy(false)},error:function(t){i.error(l.getI18nText("errorFetchingHierData"))}})},__recCallHierarchy:function(t,e,a,o){return new Promise(function(l,s){let c=new n("NodeParentI+
d",r.EQ,t),S=a,d=o;e.read("/HierarchyVersionSet('"+d+"')/Nodes",{filters:[c],method:"GET",success:async function(t){t.results.sort(function(t,e){var a=t.DrillState.toUpperCase();var n=e.DrillState.toUpperCase();return a<n?-1:a>n?1:0});if(t.results.length+
===0){l(t)}for(let a=0;a<t.results.length;a++){t.results[a].Covered="";t.results[a].GaapOpeningBalance=0;t.results[a].GaapYearBalance=0;t.results[a].GaapCTA=0;t.results[a].GaapClosingBalance=0;t.results[a].GaapToStatPL=0;t.results[a].GaapToStatPmnt=0;t.r+
esults[a].GaapToStatEQ=0;t.results[a].GaapToStatOtherPL=0;t.results[a].GaapToStatOtherPmnt=0;t.results[a].GaapToStatOtherEQ=0;t.results[a].G2SCTA=0;t.results[a].StatOpeningBalance=0;t.results[a].StatPYA=0;t.results[a].StatYearBalance=0;t.results[a].StatC+
TA=0;t.results[a].StatClosingBalance=0;t.results[a].StatToTaxPL=0;t.results[a].StatToTaxPmnt=0;t.results[a].StatToTaxEQ=0;t.results[a].StatToTaxOtherPL=0;t.results[a].StatToTaxOtherPmnt=0;t.results[a].StatToTaxOtherEQ=0;t.results[a].S2TCTA=0;t.results[a]+
.TaxOpeningBalance=0;t.results[a].TaxPYA=0;t.results[a].TaxYearBalance=0;t.results[a].TaxCTA=0;t.results[a].TaxClosingBalance=0;t.results[a].TaxPTA=0;t.results[a].MainCurrency="";T.push(t.results[a]);if(t.results[a].DrillState!=="leaf"){await S.__recCall+
Hierarchy(t.results[a].NodeId,e,S,d);if(t.results.length===a+1){l(t)}}else{l(t)}}},error:function(t){i.error(S.getI18nText("errorFetchingHierData"));s(t)}})})},_calculateAmountFSItem:function(t){let e=this,a=this.getView().byId("idTreeHierFSItem"),n=t.fi+
lter(t=>t.NodeEntity==="FINCS_FSITEM"),r=this.getView().getModel("oReconModel").getData();if(n.length===0){for(var o=0;o<t.length;o++){t[o].Covered="X"}i.warning(e.getI18nText("warningFetchingFSItem"))}for(let t=0;t<n.length;t++){for(let e=0;e<r.length;e+
++){if(n[t].NodeLowValue===r[e].FinancialStatementItem){n[t].GaapOpeningBalance=n[t].GaapOpeningBalance+parseFloat(r[e].GaapOpeningBalance,[10]);n[t].GaapYearBalance=n[t].GaapYearBalance+parseFloat(r[e].GaapYearBalance,[10]);n[t].GaapCTA=n[t].GaapClosing+
Balance+parseFloat(r[e].GaapCTA,[10]);n[t].GaapClosingBalance=n[t].GaapClosingBalance+parseFloat(r[e].GaapClosingBalance,[10]);n[t].GaapToStatPL=n[t].GaapToStatPL+parseFloat(r[e].GaapToStatPL,[10]);n[t].GaapToStatPmnt=n[t].GaapToStatPmnt+parseFloat(r[e].+
GaapToStatPmnt,[10]);n[t].GaapToStatEQ=n[t].GaapToStatEQ+parseFloat(r[e].GaapToStatEQ,[10]);n[t].GaapToStatOtherPL=n[t].GaapToStatOtherPL+parseFloat(r[e].GaapToStatOtherPL,[10]);n[t].GaapToStatOtherPmnt=n[t].GaapToStatOtherPmnt+parseFloat(r[e].GaapToStat+
OtherPmnt,[10]);n[t].GaapToStatOtherEQ=n[t].GaapToStatOtherEQ+parseFloat(r[e].GaapToStatOtherEQ,[10]);n[t].G2SCTA=n[t].G2SCTA+parseFloat(r[e].G2SCTA,[10]);n[t].StatOpeningBalance=n[t].StatOpeningBalance+parseFloat(r[e].StatOpeningBalance,[10]);n[t].StatP+
YA=n[t].StatPYA+parseFloat(r[e].StatPYA,[10]);n[t].StatYearBalance=n[t].StatYearBalance+parseFloat(r[e].StatYearBalance,[10]);n[t].StatCTA=n[t].StatCTA+parseFloat(r[e].StatCTA,[10]);n[t].StatClosingBalance=n[t].StatClosingBalance+parseFloat(r[e].StatClos+
ingBalance,[10]);n[t].StatToTaxPL=n[t].StatToTaxPL+parseFloat(r[e].StatToTaxPL,[10]);n[t].StatToTaxPmnt=n[t].StatToTaxPmnt+parseFloat(r[e].StatToTaxPmnt,[10]);n[t].StatToTaxEQ=n[t].StatToTaxEQ+parseFloat(r[e].StatToTaxEQ,[10]);n[t].StatToTaxOtherPL=n[t].+
StatToTaxOtherPL+parseFloat(r[e].StatToTaxOtherPL,[10]);n[t].StatToTaxOtherPmnt=n[t].StatToTaxOtherPmnt+parseFloat(r[e].StatToTaxOtherPmnt,[10]);n[t].StatToTaxOtherEQ=n[t].StatToTaxOtherEQ+parseFloat(r[e].StatToTaxOtherEQ,[10]);n[t].S2TCTA=n[t].S2TCTA+pa+
rseFloat(r[e].S2TCTA,[10]);n[t].TaxOpeningBalance=n[t].TaxOpeningBalance+parseFloat(r[e].TaxOpeningBalance,[10]);n[t].TaxPYA=n[t].TaxPYA+parseFloat(r[e].TaxPYA,[10]);n[t].TaxYearBalance=n[t].TaxYearBalance+parseFloat(r[e].TaxYearBalance,[10]);n[t].TaxCTA+
=n[t].TaxCTA+parseFloat(r[e].TaxCTA,[10]);n[t].TaxClosingBalance=n[t].TaxClosingBalance+parseFloat(r[e].TaxClosingBalance,[10]);n[t].TaxPTA=n[t].TaxPTA+parseFloat(r[e].TaxPTA,[10]);n[t].MainCurrency=r[e].MainCurrency}}}for(let e=0;e<n.length;e++){for(let+
 a=0;a<t.length;a++){if(n[e].NodeParentId===t[a].NodeId){n[e].Covered="X";t[a].GaapOpeningBalance=n[e].GaapOpeningBalance+t[a].GaapOpeningBalance;t[a].GaapYearBalance=n[e].GaapYearBalance+t[a].GaapYearBalance;t[a].GaapCTA=n[e].GaapCTA+t[a].GaapCTA;t[a].G+
aapClosingBalance=n[e].GaapClosingBalance+t[a].GaapClosingBalance;t[a].GaapToStatPL=n[e].GaapToStatPL+t[a].GaapToStatPL;t[a].GaapToStatPmnt=n[e].GaapToStatPmnt+t[a].GaapToStatPmnt;t[a].GaapToStatEQ=n[e].GaapToStatEQ+t[a].GaapToStatEQ;t[a].GaapToStatOther+
PL=n[e].GaapToStatOtherPL+t[a].GaapToStatOtherPL;t[a].GaapToStatOtherPmnt=n[e].GaapToStatOtherPmnt+t[a].GaapToStatOtherPmnt;t[a].GaapToStatOtherEQ=n[e].GaapToStatOtherEQ+t[a].GaapToStatOtherEQ;t[a].G2SCTA=n[e].G2SCTA+t[a].G2SCTA;t[a].StatOpeningBalance=n+
[e].StatOpeningBalance+t[a].StatOpeningBalance;t[a].StatPYA=n[e].StatPYA+t[a].StatPYA;t[a].StatYearBalance=n[e].StatYearBalance+t[a].StatYearBalance;t[a].StatCTA=n[e].StatCTA+t[a].StatCTA;t[a].StatClosingBalance=n[e].StatClosingBalance+t[a].StatClosingBa+
lance;t[a].StatToTaxPL=n[e].StatToTaxPL+t[a].StatToTaxPL;t[a].StatToTaxPmnt=n[e].StatToTaxPmnt+t[a].StatToTaxPmnt;t[a].StatToTaxEQ=n[e].StatToTaxEQ+t[a].StatToTaxEQ;t[a].StatToTaxOtherPL=n[e].StatToTaxOtherPL+t[a].StatToTaxOtherPL;t[a].StatToTaxOtherPmnt+
=n[e].StatToTaxOtherPmnt+t[a].StatToTaxOtherPmnt;t[a].StatToTaxOtherEQ=n[e].StatToTaxOtherEQ+t[a].StatToTaxOtherEQ;t[a].S2TCTA=n[e].S2TCTA+t[a].S2TCTA;t[a].TaxOpeningBalance=n[e].TaxOpeningBalance+t[a].TaxOpeningBalance;t[a].TaxPYA=n[e].TaxPYA+t[a].TaxPY+
A;t[a].TaxYearBalance=n[e].TaxYearBalance+t[a].TaxYearBalance;t[a].TaxCTA=n[e].TaxCTA+t[a].TaxCTA;t[a].TaxClosingBalance=n[e].TaxClosingBalance+t[a].TaxClosingBalance;t[a].TaxPTA=n[e].TaxPTA+t[a].TaxPTA;t[a].MainCurrency=n[e].MainCurrency;let r=t.filter(+
e=>e.NodeParentId===t[a].NodeId&&e.NodeEntity!=="FINCS_FSITEM");if(r.length===0){t[a].Covered="X"}}if(t[a].Covered===""&&t[a].NodeEntity!=="FINCS_FSITEM"){let e=t.filter(e=>e.NodeParentId===t[a].NodeId);if(e.length===0){t[a].Covered="X"}}}}var l=[];var s+
=[];l=t.filter(t=>t.Covered==="X"&&t.NodeEntity!=="FINCS_FSITEM");s=t.filter(t=>t.Covered===""&&t.NodeEntity!=="FINCS_FSITEM");while(s.length>0){for(let t=0;t<l.length;t++){for(let e=0;e<s.length;e++){if(s[e].NodeId===l[t].NodeParentId){let a=s[e];if(s.f+
ilter(t=>t.NodeParentId===a.NodeId).length===0){a.GaapOpeningBalance=a.GaapOpeningBalance+l[t].GaapOpeningBalance;a.GaapYearBalance=a.GaapYearBalance+l[t].GaapYearBalance;a.GaapCTA=a.GaapCTA+l[t].GaapCTA;a.GaapClosingBalance=a.GaapClosingBalance+l[t].Gaa+
pClosingBalance;a.GaapToStatPL=a.GaapToStatPL+l[t].GaapToStatPL;a.GaapToStatPmnt=a.GaapToStatPmnt+l[t].GaapToStatPmnt;a.GaapToStatEQ=a.GaapToStatEQ+l[t].GaapToStatEQ;a.GaapToStatOtherPL=a.GaapToStatOtherPL+l[t].GaapToStatOtherPL;a.GaapToStatOtherPmnt=a.G+
aapToStatOtherPmnt+l[t].GaapToStatOtherPmnt;a.GaapToStatOtherEQ=a.GaapToStatOtherEQ+l[t].GaapToStatOtherEQ;a.G2SCTA=l[t].G2SCTA+a.G2SCTA;a.StatOpeningBalance=l[t].StatOpeningBalance+a.StatOpeningBalance;a.StatPYA=l[t].StatPYA+a.StatPYA;a.StatYearBalance=+
l[t].StatYearBalance+a.StatYearBalance;a.StatCTA=l[t].StatCTA+a.StatCTA;a.StatClosingBalance=l[t].StatClosingBalance+a.StatClosingBalance;a.StatToTaxPL=l[t].StatToTaxPL+a.StatToTaxPL;a.StatToTaxPmnt=l[t].StatToTaxPmnt+a.StatToTaxPmnt;a.StatToTaxEQ=l[t].S+
tatToTaxEQ+a.StatToTaxEQ;a.StatToTaxOtherPL=l[t].StatToTaxOtherPL+a.StatToTaxOtherPL;a.StatToTaxOtherPmnt=l[t].StatToTaxOtherPmnt+a.StatToTaxOtherPmnt;a.StatToTaxOtherEQ=l[t].StatToTaxOtherEQ+a.StatToTaxOtherEQ;a.S2TCTA=l[t].S2TCTA+a.S2TCTA;a.TaxOpeningB+
alance=l[t].TaxOpeningBalance+a.TaxOpeningBalance;a.TaxPYA=l[t].TaxPYA+a.TaxPYA;a.TaxYearBalance=l[t].TaxYearBalance+a.TaxYearBalance;a.TaxCTA=l[t].TaxCTA+a.TaxCTA;a.TaxClosingBalance=l[t].TaxClosingBalance+a.TaxClosingBalance;a.TaxPTA=l[t].TaxPTA+a.TaxP+
TA;a.Covered="X";a.MainCurrency=l[t].MainCurrency}}}}s=t.filter(t=>t.Covered===""&&t.NodeEntity!=="FINCS_FSITEM");l=t.filter(t=>t.Covered==="X"&&t.NodeEntity!=="FINCS_FSITEM")}for(var o=0;o<t.length;o++){t[o].childs=[]}let T=this._buildTree(t);var c={chi+
lds:T};this.getView().getModel("HierDatModel").setData([]);this.getView().getModel("HierDatModel").setData(c);this.getBusyDialog().open();var S=window.setInterval(function(){this.onAdjustTableCol(a);window.clearInterval(S)}.bind(this),1e3)},_calculateAmo+
untGLAcc:function(t){let e=this,a=this.getView().byId("idTreeHierGLAcc"),n=t.filter(t=>t.NodeEntity==="GLACCOUNT"),r=this.getView().getModel("oReconModel").getData();if(n.length===0){for(var o=0;o<t.length;o++){t[o].Covered="X"}i.warning(e.getI18nText("w+
arningFetchingGLAcc"))}for(let t=0;t<n.length;t++){for(let e=0;e<r.length;e++){if(n[t].NodeLowValue===r[e].GLAccount){n[t].GaapOpeningBalance=n[t].GaapOpeningBalance+parseFloat(r[e].GaapOpeningBalance,[10]);n[t].GaapYearBalance=n[t].GaapYearBalance+parse+
Float(r[e].GaapYearBalance,[10]);n[t].GaapCTA=n[t].GaapClosingBalance+parseFloat(r[e].GaapCTA,[10]);n[t].GaapClosingBalance=n[t].GaapClosingBalance+parseFloat(r[e].GaapClosingBalance,[10]);n[t].GaapToStatPL=n[t].GaapToStatPL+parseFloat(r[e].GaapToStatPL,+
[10]);n[t].GaapToStatPmnt=n[t].GaapToStatPmnt+parseFloat(r[e].GaapToStatPmnt,[10]);n[t].GaapToStatEQ=n[t].GaapToStatEQ+parseFloat(r[e].GaapToStatEQ,[10]);n[t].GaapToStatOtherPL=n[t].GaapToStatOtherPL+parseFloat(r[e].GaapToStatOtherPL,[10]);n[t].GaapToSta+
tOtherPmnt=n[t].GaapToStatOtherPmnt+parseFloat(r[e].GaapToStatOtherPmnt,[10]);n[t].GaapToStatOtherEQ=n[t].GaapToStatOtherEQ+parseFloat(r[e].GaapToStatOtherEQ,[10]);n[t].G2SCTA=n[t].G2SCTA+parseFloat(r[e].G2SCTA,[10]);n[t].StatOpeningBalance=n[t].StatOpen+
ingBalance+parseFloat(r[e].StatOpeningBalance,[10]);n[t].StatPYA=n[t].StatPYA+parseFloat(r[e].StatPYA,[10]);n[t].StatYearBalance=n[t].StatYearBalance+parseFloat(r[e].StatYearBalance,[10]);n[t].StatCTA=n[t].StatCTA+parseFloat(r[e].StatCTA,[10]);n[t].StatC+
losingBalance=n[t].StatClosingBalance+parseFloat(r[e].StatClosingBalance,[10]);n[t].StatToTaxPL=n[t].StatToTaxPL+parseFloat(r[e].StatToTaxPL,[10]);n[t].StatToTaxPmnt=n[t].StatToTaxPmnt+parseFloat(r[e].StatToTaxPmnt,[10]);n[t].StatToTaxEQ=n[t].StatToTaxEQ+
+parseFloat(r[e].StatToTaxEQ,[10]);n[t].StatToTaxOtherPL=n[t].StatToTaxOtherPL+parseFloat(r[e].StatToTaxOtherPL,[10]);n[t].StatToTaxOtherPmnt=n[t].StatToTaxOtherPmnt+parseFloat(r[e].StatToTaxOtherPmnt,[10]);n[t].StatToTaxOtherEQ=n[t].StatToTaxOtherEQ+par+
seFloat(r[e].StatToTaxOtherEQ,[10]);n[t].S2TCTA=n[t].S2TCTA+parseFloat(r[e].S2TCTA,[10]);n[t].TaxOpeningBalance=n[t].TaxOpeningBalance+parseFloat(r[e].TaxOpeningBalance,[10]);n[t].TaxPYA=n[t].TaxPYA+parseFloat(r[e].TaxPYA,[10]);n[t].TaxYearBalance=n[t].T+
axYearBalance+parseFloat(r[e].TaxYearBalance,[10]);n[t].TaxCTA=n[t].TaxCTA+parseFloat(r[e].TaxCTA,[10]);n[t].TaxClosingBalance=n[t].TaxClosingBalance+parseFloat(r[e].TaxClosingBalance,[10]);n[t].TaxPTA=n[t].TaxPTA+parseFloat(r[e].TaxPTA,[10]);n[t].MainCu+
rrency=r[e].MainCurrency}}}for(let e=0;e<n.length;e++){for(let a=0;a<t.length;a++){if(n[e].NodeParentId===t[a].NodeId){n[e].Covered="X";t[a].GaapOpeningBalance=n[e].GaapOpeningBalance+t[a].GaapOpeningBalance;t[a].GaapYearBalance=n[e].GaapYearBalance+t[a]+
.GaapYearBalance;t[a].GaapCTA=n[e].GaapCTA+t[a].GaapCTA;t[a].GaapClosingBalance=n[e].GaapClosingBalance+t[a].GaapClosingBalance;t[a].GaapToStatPL=n[e].GaapToStatPL+t[a].GaapToStatPL;t[a].GaapToStatPmnt=n[e].GaapToStatPmnt+t[a].GaapToStatPmnt;t[a].GaapToS+
tatEQ=n[e].GaapToStatEQ+t[a].GaapToStatEQ;t[a].GaapToStatOtherPL=n[e].GaapToStatOtherPL+t[a].GaapToStatOtherPL;t[a].GaapToStatOtherPmnt=n[e].GaapToStatOtherPmnt+t[a].GaapToStatOtherPmnt;t[a].GaapToStatOtherEQ=n[e].GaapToStatOtherEQ+t[a].GaapToStatOtherEQ+
;t[a].G2SCTA=n[e].G2SCTA+t[a].G2SCTA;t[a].StatOpeningBalance=n[e].StatOpeningBalance+t[a].StatOpeningBalance;t[a].StatPYA=n[e].StatPYA+t[a].StatPYA;t[a].StatYearBalance=n[e].StatYearBalance+t[a].StatYearBalance;t[a].StatCTA=n[e].StatCTA+t[a].StatCTA;t[a]+
.StatClosingBalance=n[e].StatClosingBalance+t[a].StatClosingBalance;t[a].StatToTaxPL=n[e].StatToTaxPL+t[a].StatToTaxPL;t[a].StatToTaxPmnt=n[e].StatToTaxPmnt+t[a].StatToTaxPmnt;t[a].StatToTaxEQ=n[e].StatToTaxEQ+t[a].StatToTaxEQ;t[a].StatToTaxOtherPL=n[e].+
StatToTaxOtherPL+t[a].StatToTaxOtherPL;t[a].StatToTaxOtherPmnt=n[e].StatToTaxOtherPmnt+t[a].StatToTaxOtherPmnt;t[a].StatToTaxOtherEQ=n[e].StatToTaxOtherEQ+t[a].StatToTaxOtherEQ;t[a].S2TCTA=n[e].S2TCTA+t[a].S2TCTA;t[a].TaxOpeningBalance=n[e].TaxOpeningBal+
ance+t[a].TaxOpeningBalance;t[a].TaxPYA=n[e].TaxPYA+t[a].TaxPYA;t[a].TaxYearBalance=n[e].TaxYearBalance+t[a].TaxYearBalance;t[a].TaxCTA=n[e].TaxCTA+t[a].TaxCTA;t[a].TaxClosingBalance=n[e].TaxClosingBalance+t[a].TaxClosingBalance;t[a].TaxPTA=n[e].TaxPTA+t+
[a].TaxPTA;t[a].MainCurrency=n[e].MainCurrency;let r=t.filter(e=>e.NodeParentId===t[a].NodeId&&e.NodeEntity!=="GLACCOUNT");if(r.length===0){t[a].Covered="X"}}if(t[a].Covered===""&&t[a].NodeEntity!=="GLACCOUNT"){let e=t.filter(e=>e.NodeParentId===t[a].Nod+
eId);if(e.length===0){t[a].Covered="X"}}}}var l=[];var s=[];l=t.filter(t=>t.Covered==="X"&&t.NodeEntity!=="GLACCOUNT");s=t.filter(t=>t.Covered===""&&t.NodeEntity!=="GLACCOUNT");while(s.length>0){for(let t=0;t<l.length;t++){for(let e=0;e<s.length;e++){if(+
s[e].NodeId===l[t].NodeParentId){let a=s[e];if(s.filter(t=>t.NodeParentId===a.NodeId).length===0){a.GaapOpeningBalance=a.GaapOpeningBalance+l[t].GaapOpeningBalance;a.GaapYearBalance=a.GaapYearBalance+l[t].GaapYearBalance;a.GaapCTA=a.GaapCTA+l[t].GaapCTA;+
a.GaapClosingBalance=a.GaapClosingBalance+l[t].GaapClosingBalance;a.GaapToStatPL=a.GaapToStatPL+l[t].GaapToStatPL;a.GaapToStatPmnt=a.GaapToStatPmnt+l[t].GaapToStatPmnt;a.GaapToStatEQ=a.GaapToStatEQ+l[t].GaapToStatEQ;a.GaapToStatOtherPL=a.GaapToStatOtherP+
L+l[t].GaapToStatOtherPL;a.GaapToStatOtherPmnt=a.GaapToStatOtherPmnt+l[t].GaapToStatOtherPmnt;a.GaapToStatOtherEQ=a.GaapToStatOtherEQ+l[t].GaapToStatOtherEQ;a.G2SCTA=l[t].G2SCTA+a.G2SCTA;a.StatOpeningBalance=l[t].StatOpeningBalance+a.StatOpeningBalance;a+
.StatPYA=l[t].StatPYA+a.StatPYA;a.StatYearBalance=l[t].StatYearBalance+a.StatYearBalance;a.StatCTA=l[t].StatCTA+a.StatCTA;a.StatClosingBalance=l[t].StatClosingBalance+a.StatClosingBalance;a.StatToTaxPL=l[t].StatToTaxPL+a.StatToTaxPL;a.StatToTaxPmnt=l[t].+
StatToTaxPmnt+a.StatToTaxPmnt;a.StatToTaxEQ=l[t].StatToTaxEQ+a.StatToTaxEQ;a.StatToTaxOtherPL=l[t].StatToTaxOtherPL+a.StatToTaxOtherPL;a.StatToTaxOtherPmnt=l[t].StatToTaxOtherPmnt+a.StatToTaxOtherPmnt;a.StatToTaxOtherEQ=l[t].StatToTaxOtherEQ+a.StatToTaxO+
therEQ;a.S2TCTA=l[t].S2TCTA+a.S2TCTA;a.TaxOpeningBalance=l[t].TaxOpeningBalance+a.TaxOpeningBalance;a.TaxPYA=l[t].TaxPYA+a.TaxPYA;a.TaxYearBalance=l[t].TaxYearBalance+a.TaxYearBalance;a.TaxCTA=l[t].TaxCTA+a.TaxCTA;a.TaxClosingBalance=l[t].TaxClosingBalan+
ce+a.TaxClosingBalance;a.TaxPTA=l[t].TaxPTA+a.TaxPTA;a.Covered="X";a.MainCurrency=l[t].MainCurrency}}}}s=t.filter(t=>t.Covered===""&&t.NodeEntity!=="GLACCOUNT");l=t.filter(t=>t.Covered==="X"&&t.NodeEntity!=="GLACCOUNT")}for(var o=0;o<t.length;o++){t[o].c+
hilds=[]}let T=this._buildTree(t);var c={childs:T};this.getView().getModel("HierDatModelGL").setData([]);this.getView().getModel("HierDatModelGL").setData(c);this.getBusyDialog().open();var S=window.setInterval(function(){this.onAdjustTableCol(a);window.+
clearInterval(S)}.bind(this),1e3)},_buildTree:function(t,e){if(e){for(var a=0;a<t.length;a++){if(String(t[a].NodeId)===String(e.NodeParentId)){t[a].childs.push(e);break}else this._buildTree(t[a].childs,e)}}else{var n=0;while(n<t.length)if(t[n].NodeParent+
Id)this._buildTree(t,t.splice(n,1)[0]);else n++}return t},_fetchGlobalParameters:function(){var t=this;var e={Default:true};var a=this.getOwnerComponent().getModel();a.callFunction("/GlobalParameter",{method:"GET",urlParameters:e,success:function(e){t.ge+
tView().getModel("viewConfigDataModel").setData({globalParameters:e});let a=t.getView().byId("idsmartFilterBar");if(!a.getCurrentVariantId()){t._setFilterBarParameters(e)}},error:function(e){i.error(t.getI18nText("errorReadingGlobalParameters"))}})},_set+
FilterBarParameters:function(t){let e=this.getView(),n=e.byId("idCurrency");if(t.LocalCurrencyType&&t.LocalCurrency){n.setSelectedKey(t.LocalCurrency)}else{n.setSelectedKey(t.GroupCurrency)}if(t.ConsolidationUnit){e.byId("idConsUnit").setSelectedKey(t.Co+
nsolidationUnit);n.setVisible(true);this._fetchCurrencyData(true);this.fetchReconLedgerData()}if(t.FiscalYear){let a=new Date("06/06/".concat(t.FiscalYear.toString()));e.byId("idFiscalYearFilter").setDateValue(a)}if(t.Intention){e.byId("idIntentionComboB+
ox").setSelectedKey(t.Intention)}var r=[t.ConsolidationUnit,t.FiscalYear];this._fetchIntentionStatus(r);if(t.PeriodFrom){e.byId("idPeriodFromInput").setValue(a.convertStringToInt(t.PeriodFrom))}if(t.PeriodTo){e.byId("idPeriodToInput").setValue(a.convertS+
tringToInt(t.PeriodTo))}},getI18nText:function(t){return this.getResourceBundle().getText(t)},_fetchCurrencyData:function(t){var a=this.getView(),i=a.byId("idConsUnit").getSelectedKey(),l=new n("ConsolidationUnit",r.EQ,i),s=this.getModel(),T=this,c=a.byI+
d("idCurrType"),S=a.byId("idCurrency");c.setVisible(true);S.setBusy(true);s.read("/xEY1xSAV_C_CurrLocalGroupVH",{method:"GET",filters:[l],success:function(a,n){S.setBusy(false);T.setModel(new e(a),"currLocalGroupVHModel");if(!t&&a.results.length>0){S.set+
SelectedKey(a.results[0].Currency)}},error:function(t){S.setBusy(false);o.show(T.getI18nText("errorFetchingCurrency"))}})},_fetchIntentionStatus:function(t){let a=this.getModel();let o=t[0],l=t[1],s="/xEY1xSAV_C_IntentionsStatus(p_bunit='"+o+"')/Set",T=n+
ew n("Gjahr",r.EQ,l),c=this,S=c.getView(),d=S.byId("idIntentionComboBox");this.getBusyDialog().open();a.read(s,{method:"GET",sorters:[new sap.ui.model.Sorter("SerialNumber")],filters:[T],success:function(t,a){c.getBusyDialog().close();if(t.results.length+
===0){d.setSelectedKey("");d.setEnabled(false);i.error(c.getI18nText("IntentionNotYetOpen")+l);return}d.setEnabled(true);let n=c.getView().getModel("viewConfigDataModel").getData().globalParameters;d.setSelectedKey(n.Intention);d.setSelectedKey("");for(l+
et e=0;e<t.results.length;e++){if(t.results[e].isSelected==="X"){d.setSelectedKey(t.results[e].Intention)}}if(d.getSelectedKey()===""){for(let e=0;e<t.results.length;e++){if(t.results[e].status==="Open"){d.setSelectedKey(t.results[e].Intention)}}}let r=n+
ew e(t);c.getView().setModel(r,"intentionVHModel");c._managePeriodFieldsEditability(false)},error:function(t){c.getBusyDialog().close();i.error(c.getI18nText("errorFetchingIntentionStatus"))}})},_managePeriodFieldsEditability:function(t){let e=this.getVi+
ew(),n=e.byId("idIntentionComboBox");if(!t){n.setSelectedKey(n.getSelectedKey())}let r=n.getSelectedItem(),o=r.getBindingContext("intentionVHModel").getObject(),i=e.byId("idPeriodToInput"),l=a.convertStringToInt(o.TaxIntention);if(l!==a.convertStringToIn+
t(0)){i.setEditable(false);i.setValue(a.convertStringToInt(o.PeriodTo))}else{i.setEditable(true)}},fetchReconLedgerData:function(){let t=this.getModel();let e=t.createKey("/xEY1xSAV_C_Recon_Ledger",{bunit:this.byId("idConsUnit").getSelectedKey()});let a=+
this;t.read(e,{method:"GET",success:function(t,e){var n=a.getModel("viewConfigDataModel");n.getData().reconData=t;n.refresh()},error:function(t){if(parseInt(t.statusCode,[10])!==404){o.show(a.getI18nText("reconServiceCallError"))}}})},onSearchButtonPress+
ed:function(t){let e=this.getView();T=[];if(e.byId("idHierCatTextInpt").getSelectedKey()){if(e.byId("idHierType").getSelectedKey()==="CS15"){e.byId("idTreeHierFSItem").setBusy(true)}else{e.byId("idTreeHierGLAcc").setBusy(true)}this._fetchReconData();this+
._fetchTreeData()}else{e.byId("idHierCatTextInpt").setValueState("Error")}},onChangeHierId:function(t){let e=t.getSource().getSelectedKey(),a=this.getView().getModel("hierarCatModel").getData(),n=a.some(t=>t.HierarchyId===e),r=this.getView().byId("idsmar+
tFilterBar");if(n){t.getSource().setValueState("None");r.fireSearch()}else{t.getSource().setValueState("Error")}},onBeforeVariantSaveFilterBar:function(t){let e=this.getView(),a=e.byId("idsmartFilterBar"),n=e.byId("idConsUnit"),r=e.byId("idFiscalYearFilt+
er"),o=e.byId("idIntentionComboBox"),i=e.byId("idCurrency"),l=e.byId("idPeriodToInput");a.setFilterData({_CUSTOM:{ConsolidationUnit:n.getSelectedKey(),FiscalYear:r.getValue(),Intention:o.getSelectedKey(),CurrType:i.getSelectedKey(),PeriodTo:l.getValue(),+
VariantID:a.getCurrentVariantId()}})},onAfterVariantLoadFilterBar:function(t){var e=this.getView();var n=e.byId("idsmartFilterBar");var r=e.byId("idConsUnit");var o=e.byId("idFiscalYearFilter");let i=e.byId("idIntentionComboBox");var l=e.byId("idCurrency+
");let s=this.getView().byId("idPeriodToInput");var T=n.getFilterData()["_CUSTOM"];r.setSelectedKey(T.ConsolidationUnit);o.setValue(T.FiscalYear);i.setSelectedKey(T.Intention);l.setSelectedKey(T.CurrType);s.setValue(a.convertStringToInt(T.PeriodTo));if(T+
.ConsolidationUnit){this.fetchReconLedgerData()}if(T.CurrType){l.setVisible(true);this._fetchCurrencyData(true)}var c=[r,o];this._fetchIntentionStatus(c)},onChangeDatePickerFilter:function(t){let e=t.getSource(),a=this.getView().byId("idConsUnit").getPro+
perty("selectedKey");if(t.getParameter("valid")){e.setValueState("None");let t=e.getDateValue().getFullYear(),n=[a,t];this._fetchIntentionStatus(n)}else{e.setValueState("Error")}},onConsUnitChange:function(t){this._fetchCurrencyData(false);this.fetchReco+
nLedgerData();let e=this.getView().byId("idConsUnit").getProperty("selectedKey");let a=[e,this.getView().byId("idFiscalYearFilter").getDateValue().getFullYear()];this._fetchIntentionStatus(a)},onChangeIntentionComboBox:function(t){let e=this.getView(),a=+
e.byId("idIntentionComboBox"),n=a.getSelectedItem();if(!n){a.setSelectedItem("");return}this._managePeriodFieldsEditability(true)},onChangeHierTypeCB:function(t){let e=t.getSource().getSelectedKey(),a=this.getView();if(e==="CS15"){a.byId("idTRFMainRepSma+
rtTable").setVisible(true);a.getModel("HierDatModel").setData([]);a.byId("idMainRepSmartTable").setVisible(false)}else{a.byId("idMainRepSmartTable").setVisible(true);a.byId("idTRFMainRepSmartTable").setVisible(false);a.getModel("HierDatModelGL").setData(+
[])}this._fetchValueHelpHierarchyTxt(e)},onLiveChangePeriodTo:function(){let t=this.getView().byId("idPeriodToInput");let e=parseInt(this.getView().byId("idPeriodFromInput").getValue(),[10]);let a=parseInt(t.getValue(),[10]);t.setValueState("None");if(a<+
e){t.setValueState("Error");t.setValueStateText(this.getI18nText("periodToLessThanPeriodFromErrorMsg"));return}else if(a>"012"){t.setValueState("Error");t.setValueStateText(this.getI18nText("periodToGreaterThanLastPeriod"));return}},onPressOkBtnAppSettin+
gsCTA:function(t){let e=this.getView().byId("idsmartFilterBar").validateMandatoryFields();if(e){this._fetchReconData()}this._oAppSettingDialogCTA.close()},onValueHelpRequested:function(t){let e=this.getView(),a=e.getModel("VHColumnModel").getData().cols,+
n=this,r=this.getView().byId("idHierCatTextInpt");if(!this._oHierIdVHDialog){this._oHierIdVHDialog=sap.ui.xmlfragment("ey.sap.fin.cs.hierarchyReport.fragment.hierarchyIdValueHelp",this);this.getView().addDependent(this._oHierIdVHDialog)}this._oHierIdVHDi+
alog.getTableAsync().then(function(t){t.setModel(e.getModel("hierarCatModel"));t.setModel(e.getModel("VHColumnModel"),"columns");t.bindAggregation("rows","/");t.attachRowSelectionChange(function(t){let e=t.getParameters(),a=e.rowContext.getProperty().Hie+
rarchyId;r.setSelectedKey(a);n._oHierIdVHDialog.close()})});this._oHierIdVHDialog.open()},onValueHelpCancelPress:function(){this._oHierIdVHDialog.close()},onValueHelpAfterClose:function(){this._oHierIdVHDialog.destroy();this._oHierIdVHDialog=undefined},o+
nFilterBarSearch:function(t){let e=t.getParameter("selectionSet"),a=e.reduce(function(t,e){if(e.getValue()){t.push(new n({path:e.getName(),operator:r.Contains,value1:e.getValue()}))}return t},[]);this._filterVHTable(new n({filters:a,and:true}))},onUpdate+
Rows:function(t){this.getBusyDialog().open();let e=t.getSource();var a=window.setInterval(function(){this.onAdjustTableCol(e);window.clearInterval(a)}.bind(this),1e3)},onAdjustTableCol:function(t){let e=t.getColumns();for(var a=e.length-1;a>=0;a--){t.aut+
oResizeColumn(a)}t.setFixedColumnCount(1);this.getBusyDialog().close()}})});                                                                                                                                                                                   