sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","../model/formatter","sap/ui/core/routing/History","sap/ui/generic/app/navigation/service/Navigati+
onHandler"],function(e,t,n,i,r,a,s,o,l){"use strict";let d=sap.ui.getCore();const g="Original",u="Create",c="Update";return e.extend("ey.sap.fin.cs.managetiers.controller.Tiers",{formatter:s,onInit:function(){let e=this.getView(),n=new t({edit:false}),i=+
new t,r=new t;let a=e.byId("idTiersTable"),s=new t;a.setModel(s,"tiersTableModel");this.oNavigationHandler=new l(this);e.byId("idHeadText").setText(this.getResourceBundle().getText("tiersTableTitle",[0]));e.setModel(n,"editTierModel");e.setModel(i,"delet+
eModel");e.setModel(r,"message");if(!this.oMessagePopover){this.oMessagePopover=sap.ui.xmlfragment("ey.sap.fin.cs.managetiers.fragment.MessagePopover",this);this.oView.addDependent(this.oMessagePopover)}this.bAllEntriesValidated=true;this.oRouter=this.ge+
tOwnerComponent().getRouter();this.oRouter.getRoute("TargetTiers").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){let t=this,n=this.getView();this._getAuthData();this.getOwnerComponent().getService("ShellUIService").then(function(e+
){e.setBackNavigation(t._onPressShellNavBack.bind(t))});var r=this.oNavigationHandler.parseNavigation();r.done(function(e,i,r){if(r!==sap.ui.generic.app.navigation.service.NavType.initial){if(i.Country&&i.Country[0]&&i.ConsolidationUnit&&i.ConsolidationU+
nit[0]){n.byId("idFilterCountryCode").setSelectedKey(i.ConsolidationUnit)}if(i.FiscalYear&&i.FiscalYear[0]){n.byId("idFilterFiscalYear").setValue(i.FiscalYear)}if(i.Intention&&i.Intention[0]){let e=[i.ConsolidationUnit,i.FiscalYear,i.Country,i.Intention]+
;t._fetchIntentionStatus(e)}else{let e=[i.ConsolidationUnit,i.FiscalYear,i.Country];t._fetchIntentionStatus(e)}}});r.fail(jQuery.proxy(function(e,n,r){i.error(t.getI18nText("navigationError"))},this))},_getAuthData:function(){let e=this,n=this.getOwnerCo+
mponent().getModel();this.getBusyDialog().open();n.read("/AUTHSet",{method:"GET",success:function(n){e.getBusyDialog().close();e.getView().setModel(new t(n.results[0]),"authModel");console.log(n)},error:function(t){e.getBusyDialog().close();i.error(e.get+
I18nText("errorFetchingAuthData"))}})},_fetchIntentionStatus:function(e){let n=this.getModel();let s=e[0],o=e[1],l="/xEY1xSAV_C_IntentionsStatus(p_bunit='"+s+"')/Set",d=new r("Gjahr",a.EQ,o),g=this,u=g.getView(),c=u.byId("idIntentionComboBox"),h=u.byId("+
idTiersTable");this.getBusyDialog().open();n.read(l,{method:"GET",sorters:[new sap.ui.model.Sorter("SerialNumber")],filters:[d],success:function(n,i){g.getBusyDialog().close();n.results.splice(n.results.map(e=>e.Intention).indexOf("PER"),1);let r=new t(n+
);g.getView().setModel(r,"intentionVHModel");if(e[3]){c.setSelectedKey(e[3]);let t=c.getSelectedItem(),n=t.getBindingContext("intentionVHModel").getObject();g._manageIntentionStatus(n);g._fetchTiersData(e[2])}else{c.setSelectedKey("");h.getModel("tiersTa+
bleModel").setData([]);g._disableButton(false)}},error:function(e){g.getBusyDialog().close();i.error(g.getI18nText("errorFetchingIntentions"))}})},_manageIntentionStatus:function(e){if(e.status==="Open"){this._disableButton(true)}else{this._disableButton+
(false)}},_disableButton:function(e){let t=this.getView();t.byId("idEditToggleBtn").setEnabled(e);t.byId("rollOverBtnId").setEnabled(e)},_onPressShellNavBack:function(){let e=false,t=this.getView().byId("idTiersTable").getModel("tiersTableModel");if(t){l+
et r=t.getData().results,a=jQuery.extend(true,[],this._getOriginalTiersData().getData());if(r.length===a.length){for(var n=0;n<r.length;n++){for(var i=0;i<a.length;i++){if(r[n].CountryKey===a[i].CountryKey&&r[n].FiscalYear===a[i].FiscalYear&&r[n].Intenti+
on===a[i].Intention&&parseInt(r[n].Sequence,[10])===parseInt(a[i].Sequence,[10])&&(r[n].TierAmount!==a[i].TierAmount||r[n].TaxRate!==a[i].TaxRate)){e=true}}}}else if(r.length<a.length){e=true}else if(r.length>a.length){e=true}else{e=false}if(e){this._uns+
avedChangesWarning()}else{window.history.go(-1)}}else{window.history.go(-1)}},_unsavedChangesWarning:function(){let e=this.getResourceBundle().getText("btnTextLeavePage");i.warning(this.getResourceBundle().getText("errorMsgLeaveManageTiersScreen"),{actio+
ns:[e,i.Action.CANCEL],emphasizedAction:e,onClose:function(t){if(t===e){window.history.go(-1)}}})},_getMaxTier:function(e){let t=1;if(e.results.length>0){t=Math.max(...e.results.map(e=>parseInt(e.Sequence,[10])))+1}return String(t)},_fetchTiersData:funct+
ion(e){let t=this.getView(),n=this.getOwnerComponent().getModel(),s=t.byId("idTiersTable"),o=t.byId("idFilterFiscalYear").getValue(),l=t.byId("idFilterCountryCode").getSelectedItem()?t.byId("idFilterCountryCode").getSelectedItem().getBindingContext().get+
Object().Country:e,d=t.byId("idIntentionComboBox").getSelectedKey(),u=this,c=new r({filters:[new r("CountryKey",a.EQ,l),new r("FiscalYear",a.EQ,o),new r("Intention",a.EQ,d)],and:true});this.getBusyDialog().open();n.read("/xEY1xSAV_C_TIERS",{filters:[c],s+
orters:[new sap.ui.model.Sorter("Sequence")],method:"GET",success:function(e){u.getBusyDialog().close();e.results.map(e=>{e.editFlag=g});s.getModel("tiersTableModel").setData(e);s.getModel("tiersTableModel").setDefaultBindingMode("TwoWay");u.getView().by+
Id("idHeadText").setText(u.getResourceBundle().getText("tiersTableTitle",[s.getBinding("items").getLength()]));u._setOriginalTiersData(e)},error:function(e){u.getBusyDialog().close();i.error(u.getI18nText("TierGetServiceCallError"))}})},_closeMessagePopo+
vers:function(){if(this.oMessagePopover){this.oMessagePopover.close()}},_setOriginalTiersData:function(e){let n=jQuery.extend(true,[],e.results);n.map(e=>delete e.__metadata);this.getView().setModel(new t(n),"modelOriginalTiersData")},_getOriginalTiersDa+
ta:function(){return this.getView().getModel("modelOriginalTiersData")},_setUpdatedEntries:function(e,t){let n=e.getSource(),i=n.getValue(),r=n.getParent().getBindingContextPath(),a=n.getModel("tiersTableModel"),s=new RegExp(/[^0-9.-]/gi),o=new RegExp(/.+
*\..*\..*/),l,d,g,u=this.getView().byId("idFilterCountryCode").getSelectedItem().getBindingContext().getObject().Currency;if(t==="TierAmount"){g=u}else{g="%"}l=i.toUpperCase().indexOf(g);if(l>=0){let e=i.replace(/\s/g,"");d=e.substr(0,e.length-g.length)}+
else{d=i}if(s.exec(d)!==null){n.setValue("");this._validateInvalidEntry(e,t);return}if(o.exec(d)!==null){n.setValue("");this._validateInvalidEntry(e,t);return}let h=n.getParent().getBindingContext("tiersTableModel").getObject();a.setProperty(r+"/"+t,i.to+
UpperCase());if(h.editFlag===c){a.setProperty(r+"/editFlag",c)}this._validateInvalidEntry(e,t)},_setUpdatedFragmentAmount:function(e,t){let n=e.getSource(),i=n.getValue(),r=new RegExp(/[^0-9.-]/gi),a=new RegExp(/.*\..*\..*/),s,o,l,d,g=this.getView().byId+
("idFilterCountryCode").getSelectedItem().getBindingContext().getObject().Currency;if(t==="TierAmount"){l=g}else{l="%"}s=i.toUpperCase().indexOf(l);if(s>=0){let e=i.replace(/\s/g,"");o=e.substr(0,e.length-l.length)}else{o=i}if(r.exec(o)!==null){n.setValu+
e("");this._validateInvalidEntry(e,t);return}if(a.exec(o)!==null){n.setValue("");this._validateInvalidEntry(e,t);return}if(t==="TaxRate"){d=this.formatter.appendPercentageSign(i)}else{d=this.formatter.formatTierAmountDisplayAndEdit(i,true,l)}n.setValue(d+
);this._validateInvalidEntry(e,t)},_validateInvalidEntry:function(e,t){let n=e.getSource(),i=n.getValue();if(t==="TaxRate"&&(!i||parseFloat(i,[10])<0||parseFloat(i,[10])>100)){n.setValueState("Error");this.bAllEntriesValidated=false;return}n.setValueStat+
e("None");this.bAllEntriesValidated=true;if(!i||parseFloat(i,[10])===0){n.setValueState("Error");this.bAllEntriesValidated=false}},_setScreenToDisplayMode:function(){let e=this.getView();e.getModel("deleteModel").setData([]);e.getModel("editTierModel").s+
etProperty("/edit",false);e.byId("idEditToggleBtn").setVisible(true);e.byId("rollOverBtnId").setEnabled(true);this._fetchTiersData()},_clearMessagesPopover:function(){let e=this.getView().getModel("message");e.setData([]);e.refresh();d.getMessageManager(+
).removeAllMessages()},getI18nText:function(e){return this.getResourceBundle().getText(e)},_serviceCallDeleteTiers:function(e){let t=this.getOwnerComponent().getModel(),i=this;for(var r=0;r<e.length;r++){let n="/xEY1xSAV_C_TIERS(CountryKey='"+e[r].Countr+
yKey+"',FiscalYear='"+e[r].FiscalYear+"',Intention='"+e[r].Intention+"',Sequence='"+e[r].Sequence+"')";t.remove(n,{groupId:"groupIdRollOver"})}return new Promise(function(e,r){t.submitChanges({groupId:"groupIdRollOver",success:function(t,a){let s;if(!t._+
_batchResponses){i._setScreenToDisplayMode();r(t);return}s=t.__batchResponses[0].__changeResponses;if(!s||s.length<=0){i._setScreenToDisplayMode();r(t);return}let o=JSON.parse(s.find(e=>e.headers["sap-message"]).headers["sap-message"]);if(o&&o.severity.t+
oUpperCase()==="SUCCESS"){e(t)}else if(o&&o.message){n.show(i.getI18nText("genericMsgBatchRollOverError"));r(t)}},error:function(e){i._setScreenToDisplayMode();r(oData)}})})},_sServiceCreateTiers:function(e){let t=this.getOwnerComponent().getModel(),i=th+
is.getView().byId("idTiersTable").getModel("tiersTableModel").getData().results,r=this,a=[];if(i.length>0){e.map(e=>{i.map(t=>{t.TierAmount=parseFloat(t.TierAmount,[10]).toFixed(2);delete t.__metadata;delete t.editFlag;delete t.Tier;t.TaxRate=parseFloat(+
t.TaxRate).toFixed(2);var n=Object.assign({},t,{Intention:e.Intention});a.push(n)})});for(var s=0;s<a.length;s++){t.create("/xEY1xSAV_C_TIERS",a[s],{groupId:"groupIdRollOver"})}t.submitChanges({groupId:"groupIdRollOver",success:function(e,t){let i;if(!e.+
__batchResponses){r._setScreenToDisplayMode();return}i=e.__batchResponses[0].__changeResponses;if(!i||i.length<=0){r._setScreenToDisplayMode();return}let a=JSON.parse(i.find(e=>e.headers["sap-message"]).headers["sap-message"]);if(a&&a.severity.toUpperCas+
e()==="SUCCESS"){n.show(r.getI18nText("genericMsgBatchRollOverSuccess"));r._setScreenToDisplayMode()}else if(a&&a.message){n.show(r.getI18nText("genericMsgBatchError"))}},error:function(e){r._setScreenToDisplayMode()}})}else{n.show(r.getI18nText("generic+
MsgBatchRollOverSuccess"))}},onChangeDatePickerFilter:function(e){let t=this.getView(),n=e.getSource(),i=t.byId("idFilterCountryCode").getSelectedKey(),r=t.getModel("authModel").getProperty("/changeAllowed");if(e.getParameter("valid")){n.setValueState("N+
one");let e=n.getDateValue().getFullYear(),a=[i,e];this._fetchIntentionStatus(a);t.getModel("deleteModel").setData([]);t.getModel("editTierModel").setProperty("/edit",false);if(r){t.byId("idEditToggleBtn").setVisible(true)}}else{n.setValueState("Error")}+
},onPressAddNewTier:function(e){let t=this.getView();if(!this._oTierCreateFragment){this._oTierCreateFragment=sap.ui.xmlfragment("tierCreate","ey.sap.fin.cs.managetiers.fragment.TierCreate",this);t.addDependent(this._oTierCreateFragment)}this._oTierCreat+
eFragment.open();let n=t.byId("idTiersTable").getModel("tiersTableModel").getData(),i=this._getMaxTier(n);d.byId("tierCreate--IdTier").setText("Tier "+i);let r=d.byId("tierCreate--IdTierAmnt"),a=d.byId("tierCreate--IdTaxRate");r.setValue("");a.setValue("+
");r.setValueState("None");a.setValueState("None")},onPressDeleteTier:function(){let e=this.getView(),i=e.byId("idTiersTable"),r=i.getSelectedItems();if(!r.length){return}let a=e.getModel("deleteModel"),s=i.getModel("tiersTableModel"),o=[],l=i.getModel("+
tiersTableModel").getData(),d=new t;if(i.getSelectedItems().length===i.getItems().length){let e=[];l.results.map(t=>{if(t.editFlag!==u){e.push(t)}});d.setData([]);d.setData(e);s.setData({results:[]})}else{d.setData({});o=r.map(e=>i.indexOfItem(e));o.sort+
(function(e,t){return t-e});for(var g=0;g<o.length;g++){let e=parseInt(this._getMaxTier(l),[10])-1;if(e>parseInt(l.results[o[g]].Sequence,[10])){n.show(this.getI18nText("deletTierError"));break}else{let e=l.results.splice(o[g],1),t=d.getData();if(e[0].ed+
itFlag!==u){delete e[0].editFlag;if(Object.keys(t).length===0&&t.constructor===Object){t=e}else{t.push(e[0])}}d.setData(t);s.setData(l);s.refresh()}}}let c=a.getData();if(Object.keys(c).length===0&&c.constructor===Object){c=d.getData()}else{for(var h=0;h+
<d.getData().length;h++){c.push(d.getData()[h])}}a.setData(c);s.refresh()},onPressCloseDialog:function(){this._oTierCreateFragment.close()},onPressEditToggleBtn:function(e){let t=this.getView();t.getModel("editTierModel").setProperty("/edit",true);t.byId+
("idEditToggleBtn").setVisible(false);t.byId("rollOverBtnId").setEnabled(false);this._clearMessagesPopover()},onPressSaveBtnAddTier:function(){let e=d.byId("tierCreate--IdTierAmnt"),t=e.getValue(),n=d.byId("tierCreate--IdTaxRate"),i=n.getValue();if(!t){e+
.setValueState("Error")}else if(!i){n.setValueState("Error")}if(e.getValueState()==="Error"||n.getValueState()==="Error"){return}let r=this.getView(),a=r.byId("idTiersTable").getModel("tiersTableModel"),s=d.byId("tierCreate--IdTier").getText(),o=r.byId("+
idFilterFiscalYear").getValue(),l=r.byId("idFilterCountryCode").getSelectedItem().getBindingContext().getObject().Country,h=r.byId("idFilterCountryCode").getSelectedItem().getBindingContext().getObject().Currency,T=r.byId("idIntentionComboBox").getSelect+
edKey(),f=a.getData(),I=this._getMaxTier(f),p=r.getModel("deleteModel").getData(),y={CountryKey:l,FiscalYear:o,Sequence:I,Tier:s,TierAmount:t,TaxRate:i,editFlag:u,LocalCurrency:h,Intention:T};for(var S=0;S<p.length;S++){if(p[S].CountryKey===y.CountryKey&+
&p[S].FiscalYear===y.FiscalYear&&p[S].Intention===y.Intention&&parseInt(p[S].Sequence,[10])===parseInt(y.Sequence,[10])&&parseFloat(p[S].TierAmount).toFixed(2)===parseFloat(y.TierAmount).toFixed(2)||parseFloat(p[S].TaxRate).toFixed(2)===parseFloat(y.TaxR+
ate).toFixed(2)){p.splice(S,1);y.editFlag=g}else if(p[S].CountryKey===y.CountryKey&&p[S].FiscalYear===y.FiscalYear&&p[S].Intention===y.Intention&&parseInt(p[S].Sequence,[10])===parseInt(y.Sequence,[10])){p.splice(S,1);y.editFlag=c}}f.results.push(y);a.se+
tData(f);a.refresh();this._oTierCreateFragment.close()},onSearchButtonPressed:function(){this._fetchTiersData()},onChangeTierTaxRate:function(e){this._setUpdatedEntries(e,"TaxRate")},onChangeTierAmount:function(e){this._setUpdatedEntries(e,"TierAmount")}+
,onPressSaveTier:function(){if(!this.bAllEntriesValidated){i.error(this.getI18nText("errorMsgInvalidTableData"));return}let e=this.getOwnerComponent(),t=e.getModel(),r=this,a=this.getView().byId("idTiersTable").getModel("tiersTableModel").getData().resul+
ts,s=jQuery.extend(true,[],this._getOriginalTiersData().getData());this._clearMessagesPopover();s.map(e=>{e.TierAmount=parseFloat(e.TierAmount,[10]).toFixed(2);delete e.__metadata;delete e.editFlag;delete e.Tier;e.TaxRate=parseFloat(e.TaxRate).toFixed(2)+
;return e});a.map(e=>{e.TierAmount=parseFloat(e.TierAmount,[10]).toFixed(2);delete e.__metadata;delete e.editFlag;delete e.Tier;e.TaxRate=parseFloat(e.TaxRate).toFixed(2);return e});t.setUseBatch(true);t.setChangeGroups({"/SAV_MANAGE_TIER_SRV":{groupId:"+
groupIdSaveTier",changeSetId:"ID",single:false}});t.setDeferredGroups(t.getDeferredGroups().concat(["groupIdSaveTier"]));if(a.length>s.length){let e=a.filter(e=>s.filter(t=>parseInt(t.Sequence,[10])===parseInt(e.Sequence,[10])&&t.CountryKey===e.CountryKe+
y&&t.FiscalYear===e.FiscalYear&&t.Intention===e.Intention&&(t.TaxRate!==e.TaxRate||t.TierAmount!==e.TierAmount)).length>0);if(e.length>0){for(var o=0;o<e.length;o++){let n="/xEY1xSAV_C_TIERS(CountryKey='"+e[o].CountryKey+"',FiscalYear='"+e[o].FiscalYear++
"',Intention='"+e[o].Intention+"',Sequence='"+e[o].Sequence+"')";t.update(n,e[o],{groupId:"groupIdSaveTier"})}}let n=a.filter(e=>s.filter(t=>t.CountryKey===e.CountryKey&&t.FiscalYear===e.FiscalYear&&t.Intention===e.Intention&&parseInt(t.Sequence,[10])===+
parseInt(e.Sequence,[10])).length===0);if(n.length>0){for(var l=0;l<n.length;l++){t.create("/xEY1xSAV_C_TIERS",n[l],{groupId:"groupIdSaveTier"})}}}else if(a.length===s.length){for(var o=0;o<a.length;o++){for(var d=0;d<s.length;d++){if(a[o].CountryKey===s+
[d].CountryKey&&a[o].FiscalYear===s[d].FiscalYear&&a[o].Intention===s[d].Intention&&parseInt(a[o].Sequence,[10])===parseInt(s[d].Sequence,[10])&&(a[o].TierAmount!==s[d].TierAmount||a[o].TaxRate!==s[d].TaxRate)){t.update("/xEY1xSAV_C_TIERS(CountryKey='"+a+
[o].CountryKey+"',FiscalYear='"+a[o].FiscalYear+"',Intention='"+a[o].Intention+"',Sequence='"+a[o].Sequence+"')",a[o],{groupId:"groupIdSaveTier"})}}}}else if(a.length<s.length){let e=a.filter(e=>s.filter(t=>parseInt(t.Sequence,[10])===parseInt(e.Sequence+
,[10])&&t.CountryKey===e.CountryKey&&t.FiscalYear===e.FiscalYear&&t.Intention===e.Intention&&(t.TaxRate!==e.TaxRate||t.TierAmount!==e.TierAmount)).length>0);if(e.length>0){for(var o=0;o<e.length;o++){let n="/xEY1xSAV_C_TIERS(CountryKey='"+e[o].CountryKey+
+"',FiscalYear='"+e[o].FiscalYear+"',Intention='"+e[o].Intention+"',Sequence='"+e[o].Sequence+"')";t.update(n,e[o],{groupId:"groupIdSaveTier"})}}let n=s.filter(e=>a.filter(t=>parseInt(t.Sequence,[10])===parseInt(e.Sequence,[10])&&t.CountryKey===e.Country+
Key&&t.FiscalYear===e.FiscalYear&&t.Intention===e.Intention).length===0);if(n.length>0){for(var o=0;o<n.length;o++){let e="/xEY1xSAV_C_TIERS(CountryKey='"+n[o].CountryKey+"',FiscalYear='"+n[o].FiscalYear+"',Intention='"+n[o].Intention+"',Sequence='"+n[o]+
.Sequence+"')";t.remove(e,{groupId:"groupIdSaveTier"})}}}else{let e=this.getView();e.getModel("deleteModel").setData([]);e.getModel("editTierModel").setProperty("/edit",false);e.byId("idEditToggleBtn").setVisible(true);e.byId("rollOverBtnId").setEnabled(+
true);return}t.submitChanges({groupId:"groupIdSaveTier",success:function(e,t){let i;if(!e.__batchResponses){r._setScreenToDisplayMode();return}i=e.__batchResponses[0].__changeResponses;if(!i||i.length<=0){r._setScreenToDisplayMode();return}let a=JSON.par+
se(i.find(e=>e.headers["sap-message"]).headers["sap-message"]);if(a&&a.severity.toUpperCase()==="SUCCESS"){n.show(r.getI18nText("genericMsgBatchSuccess"));r._setScreenToDisplayMode()}else if(a&&a.message){n.show(r.getI18nText("genericMsgBatchError"))}},e+
rror:function(e){r._setScreenToDisplayMode()}})},onPressCancelTier:function(){let e=this.getView(),t=e.byId("idTiersTable");e.getModel("deleteModel").setData([]);e.getModel("editTierModel").setProperty("/edit",false);e.byId("idEditToggleBtn").setVisible(+
true);e.byId("rollOverBtnId").setEnabled(true);t.getModel("tiersTableModel").setData({results:jQuery.extend(true,[],this._getOriginalTiersData().getData())});t.removeSelections();this._closeMessagePopovers();this._clearMessagesPopover()},onPressHandleMes+
sagePopover:function(e){},onChangeTierAmountFragment:function(e){this._setUpdatedFragmentAmount(e,"TierAmount")},onChangeTaxRateFragment:function(e){this._setUpdatedFragmentAmount(e,"TaxRate")},onChangeIntention:function(){let e=this.getView(),t=e.byId("+
idSmartFilterBar"),n=t.validateMandatoryFields(),i=e.getModel("authModel").getProperty("/changeAllowed");if(n){let n=e.byId("idIntentionComboBox").getSelectedItem(),r=n.getBindingContext("intentionVHModel").getObject();this._manageIntentionStatus(r);e.ge+
tModel("deleteModel").setData([]);e.getModel("editTierModel").setProperty("/edit",false);if(i){e.byId("idEditToggleBtn").setVisible(true)}t.fireSearch()}},onChangeCountry:function(e){let t=this.getView(),n=e.getSource(),i=this.getView().byId("idFilterCou+
ntryCode").getSelectedKey(),r=t.getModel("authModel").getProperty("/changeAllowed"),a=t.byId("idFilterFiscalYear");n.setValueState("None");if(a.getValue()){let e=a.getDateValue().getFullYear(),n=[i,e];t.getModel("deleteModel").setData([]);t.getModel("edi+
tTierModel").setProperty("/edit",false);if(r){t.byId("idEditToggleBtn").setVisible(true)}if(e){this._fetchIntentionStatus(n)}}},onPressRollOver:function(e){let t=this.getView(),n=t.byId("idIntentionComboBox").getSelectedKey(),s=t.getModel("intentionVHMod+
el").getData().results,o=s.findIndex(e=>e.Intention===n),l=s.slice(o+1),d=this.getOwnerComponent().getModel(),g=t.byId("idFilterFiscalYear").getValue(),u=t.byId("idFilterCountryCode").getSelectedItem().getBindingContext().getObject().Country,c=this,h=[],+
T,f=new r({filters:[new r("CountryKey",a.EQ,u),new r("FiscalYear",a.EQ,g)],and:true});d.setUseBatch(true);d.setChangeGroups({"/SAV_MANAGE_TIER_SRV":{groupId:"groupIdRollOver",changeSetId:"ID",single:false}});d.setDeferredGroups(d.getDeferredGroups().conc+
at(["groupIdRollOver"]));if(l.length>0){d.read("/xEY1xSAV_C_TIERS",{filters:[f],sorters:[new sap.ui.model.Sorter("Sequence")],method:"GET",success:function(e){l.map(t=>{e.results.map(e=>{if(e.Intention===t.Intention){h.push(e)}})});if(h.length>0){T=c._se+
rviceCallDeleteTiers(h,l);T.then(function(e){c._sServiceCreateTiers(l)},function(e){i.error(c.getI18nText("genericMsgBatchRollOverError"))})}else{c._sServiceCreateTiers(l)}},error:function(e){i.error(c.getI18nText("TierGetServiceCallError"))}})}else{i.er+
ror(c.getI18nText("errorMsgInvalidIntention"))}}})});                                                                                                                                                                                                          