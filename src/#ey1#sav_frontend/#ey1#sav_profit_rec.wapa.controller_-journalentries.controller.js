sap.ui.define(["./BaseController","sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/m/MessageToast","../model/formatter"],function(e,t,n,o,r,i,a){"use strict";return e.extend("ey.sap.fin.cs.profitrec+
on.controller.JournalEntries",{formatter:a,onInit:function(){this._oSmartTable=this.getView().byId("idJournalEntriesTable");this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("JournalEntries").attachMatched(this._onRouteMatched,this)+
},_onRouteMatched:function(){let e=this.getModel("JournalEntryData"),t=sap.ui.getCore().getModel("viewCnlVersionModel").getData().ConsolidationVersion.results;let n,o=e.getProperty("/ConsolidationLedger"),r=this,i=[];i=t.filter(e=>e.ConsolidationLedger==+
=o[0]);n=[i[0].ConsolidationVersion];r.getOwnerComponent().getModel("JournalEntryData").getData().ConsolidationVersion=n;r.bIsMessageBoxOpen=false;r.bTableRefresh=false;if(e&&e.getData()){r._oSmartTable.rebindTable()}else{let e=r.getRouter();r.getBusyDia+
log().open();e.navTo("profitrecon",{},true)}},onBeforeRebindJournalEntries:function(e){let t=this.getView().getModel("JournalEntryData"),r=e.getParameter("bindingParams").filters;let i=[new n("ConsolidationGroup",o.EQ,t.getProperty("/ConsolidationGroup")+
),new n("ConsolidationLedger",o.EQ,t.getProperty("/ConsolidationLedger")),new n("GLAccount",o.EQ,t.getProperty("/GLAccount")),new n("PeriodMode",o.EQ,t.getProperty("/PeriodMode")),new n("ConsolidationVersion",o.EQ,t.getProperty("/ConsolidationVersion")),+
new n("FiscalPeriod",o.BT,t.getProperty("/PeriodFrom"),t.getProperty("/PeriodTo")),new n("FiscalYear",o.EQ,t.getProperty("/FiscalYear")),new n("RefConsolidationDocumentType",o.EQ,t.getProperty("/RefConsolidationDocumentType")),new n("CompanyCode",o.EQ,t.+
getProperty("/ConsolidatioUnit"))];if(t.getProperty("/SelectedIntention")){i.push(new n("TaxIntention",o.LE,t.getProperty("/SelectedIntention")))}else{i.push(new n("TaxIntention",o.EQ,""))}if(t.getProperty("/MapLedger")==="s2t"){i.push(new n("LedgerGroup+
",o.NE,"G2S"))}if(r.length>0){i=[...i,...r]}let a=new n({filters:i,and:true}),s=a,l=[],u=[];if(t.getProperty("/FinancialTransactionType").length>0){for(var g=0;g<t.getProperty("/FinancialTransactionType").length;g++){l.push(new n("FinancialTransactionTyp+
e",o.EQ,t.getProperty("/FinancialTransactionType")[g]))}u=new n({filters:l});s=new n({filters:[a,u],and:true})}var d=encodeURIComponent("datetime'2018-12-31T00:00:00'");var c="/xEY1xSAV_C_CnsldtnJrnlEntry(P_ConsolidationUnitHierarchy='$',P_ConsolidationP+
rftCtrHier='$',P_ConsolidationSegmentHier='$',P_KeyDate="+d+")/Results";this.getView().byId("idJournalEntriesTable").setTableBindingPath(c);var p=e.getParameter("bindingParams");p.filters=[s]},onPressConsDoc:function(e){let t=this.getModel("JournalEntryD+
ata").getData();var n=e.getSource().getBindingContext().getProperty("RefConsolidationDocumentNumber");var o=e.getSource().getBindingContext().getProperty("CompanyCode");var r=o;while(r.length<4){r="0"+r}var i=t.FiscalYear;var a={AccountingDocument:n,Comp+
anyCode:r,FiscalYear:i};this.performCrossAppNavigation("AccountingDocument","manage",true,a)},onJEntriesDataReceived:function(e){this.getBusyDialog().open();var t=window.setInterval(function(e){this._onAdjustJECol();this._compareSyncedValues(this._findTa+
bleSumRowData(this._findTableSumRow()),this.bTableRefresh);window.clearInterval(t)}.bind(this),1e3)},onPressJEDataSync:function(e){this.bTableRefresh=true;this._oSmartTable.rebindTable()},_onAdjustJECol:function(){var e=this.getView().byId("idJournalEntr+
iesTable").getTable();var t=e.getColumns();for(var n=t.length-1;n>=0;n--){e.autoResizeColumn(n)}this.getBusyDialog().close()},_findTableSumRow:function(){let e=this.getView().byId("idJournalEntriesTable");let t=e.getTable();let n=t.getRows();let o=t.getV+
isibleRowCount();if(!n[o-1]||!n[o-1].getBindingContext()){for(let e=0;e<n.length+1;e++){if(!n[e].getBindingContext()){return e-1}}}return o-1},_findTableSumRowData:function(e){let t=this.getView().byId("idJournalEntriesTable").getTable();let n;if(t.getRo+
ws()[e]&&t.getRows()[e].getBindingContext()){let o=t.getRows()[e].getBindingContext().sPath;n=t.getModel().getProperty(o)}return n},_compareSyncedValues:function(e,t){let n=this.getModel("JournalEntryData").getData();let o=this.getView().byId("idJEValueH+
eader");if(e&&e.LocalCurrency!==n.selectedCurrency&&!e.AmountInLocalCurrency||e&&e.GroupCurrency!==n.selectedCurrency&&!e.AmountInGroupCurrency){i.show(this.getResourceBundle().getText("errorCurrencyColumnNotSelected"));return}if(e&&n.selectedCurrency===+
e.LocalCurrency&&parseInt(n.Value,[10])!==parseInt(e.AmountInLocalCurrency,[10])||e&&n.selectedCurrency===e.GroupCurrency&&parseInt(n.Value,[10])!==parseInt(e.AmountInGroupCurrency,[10])){o.setState("Warning");if(!this.bIsMessageBoxOpen){this._initialize+
WarningMessageBox(t)}}else{o.setState("Success")}},_initializeWarningMessageBox:function(e){this.bIsMessageBoxOpen=true;let t=this;r.warning(this.getResourceBundle().getText("errorMsgSumValueDiffTableSync"),{actions:[r.Action.OK],onClose:function(e){t.bI+
sMessageBoxOpen=false}})}})});                                                                                                                                                                                                                                 