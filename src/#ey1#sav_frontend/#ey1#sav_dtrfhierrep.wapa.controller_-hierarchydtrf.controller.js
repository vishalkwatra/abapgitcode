sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/ListItem","sap/ui/generic/app/navigation/service/NavigationHandl+
er"],function(e,t,a,n,l,r,i,o,s){"use strict";let c=[];return e.extend("ey.sap.fin.cs.hierarchyReportDTRF.controller.hierarchydtrf",{formatter:a,onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("Routehierarchy").a+
ttachMatched(this._onRouteMatched,this);let e=new t;this.setModel(e,"viewConfigDataModel");let a=[{name:this.getI18nText("FSItemText"),key:"CS15"},{name:this.getI18nText("GLAccVHText"),key:"0109"}];var n=new t;this.setModel(n,"HierDatModel");var l=new t;+
this.setModel(l,"HierDatModelGL");let r=new t(a);this.setModel(r,"hierVHModel");let i={cols:[{label:this.getI18nText("labelHierId"),template:"HierarchyId",width:"6%",resizable:"false"},{label:this.getI18nText("labelHierIdDes"),template:"HierarchyText",wi+
dth:"13%",resizable:"false"}]},o=new t(i);this.setModel(o,"VHColumnModel");this._fetchGlobalParameters();this._fetchAdjustmentReasons();this.getView().setModel(new t({results:[{key:"RGAAP",text:this.getI18nText("sBtnTextReportingGAAP")},{key:"SGAAP",text+
:this.getI18nText("sBtnTextStatutoryReporting")}]}),"modelReportingType");this.getView().byId("idHierType").setSelectedKey("CS15");this._fetchValueHelpHierarchyTxt(this.getView().byId("idHierType").getSelectedKey())},_onRouteMatched:function(){this.getBu+
syDialog().close()},_fetchValueHelpHierarchyTxt:function(e){let a=this.getOwnerComponent().getModel("oManageHierModel"),r=this,o=new n({filters:[new n("HierarchyCategory",l.EQ,e),new n("VersionStatus",l.EQ,"A")],and:true}),s=o;a.read("/HierarchyVersionSe+
t",{method:"GET",filters:[s],success:function(e){let a=new t(e.results);r.setModel(a,"hierarCatModel")},error:function(e){i.error(r.getI18nText("errorFetchingHierCatTxtData"))}})},_fetchAdjustmentReasons:function(){let e=this.getOwnerComponent().getModel+
();let t="/xEY1xSAV_C_Recon_Adj_Reason";let a=this;e.read(t,{method:"GET",success:function(e,t){var n=a.getModel("viewConfigDataModel");n.getData().adjustmentReason=e.results;n.refresh()},error:function(e){if(parseInt(e.statusCode,[10])!==404){r.show(a.g+
etI18nText("adjustmentReasonsServiceCallError"))}}})},_filterVHTable:function(e){let t=this;this._oHierIdVHDialog.getTableAsync().then(function(a){if(e.aFilters.length===0){a.getBinding("rows").filter(e);a.getModel().refresh(true)}else{a.getBinding("rows+
").filter(e)}t._oHierIdVHDialog.update()})},_fetchDTRFData:function(){let e=this.getOwnerComponent().getModel(),a=this,r=this.getView(),o=r.getModel("viewConfigDataModel").getData();if(!o.globalParameters||!o.globalParameters.ConsolidationChartofAccounts+
||!o.globalParameters.ConsolidationGroup){i.error(this.getI18nText("errorMaintainGlobalParameter"));return}let s=r.byId("idConsUnit"),c=s.getSelectedKey(),d=r.byId("idCurrency"),g=d.getSelectedKey(),u=r.byId("idFiscalYearFilter"),C=u.getDateValue().getFu+
llYear(),T=r.byId("idPeriodFromInput"),P=r.byId("idPeriodToInput"),h=parseInt(T.getValue(),[10]),A=parseInt(P.getValue(),[10]),B=r.byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel"),f=parseInt(B.getObject().TaxIntention,[+
10]),p=B.getObject().TaxIntention,I=f>100?f:"",y=this.getView().byId("idFSItmSegmentedBtn").getSelectedKey(),Y=this.getView().byId("idGlAccSegmentedBtn").getSelectedKey(),E=this.getView().byId("idFSitmSmartTable").getVisible()?y:Y,D,O,q;D=new n({filters:+
[new n("ConsolidationUnit",l.EQ,c),new n("ConsolidationChartofAccounts",l.EQ,o.globalParameters.ConsolidationChartofAccounts),new n("MainCurrency",l.EQ,g),new n("ReportingType",l.EQ,E)],and:true});q=D;h=h?h<0?0:h>12?12:h:1;A=A?A<0?0:A>12?12:A:12;let S="/+
xEY1xSAV_C_DeferredTaxRollFrwd(p_rbunit='"+c+"',p_toperiod='"+A+"',p_ryear='"+C+"',p_taxintention='"+I+"')/Results";e.read(S,{filters:[q],method:"GET",success:function(e){let n=new t(e.results);a.setModel(n,"oDTRFModel");a._fetchTreeData()},error:functio+
n(e){i.error(a.getI18nText("errorFetchingDTRF"))}})},_fetchTreeData:function(){let e=this.getOwnerComponent().getModel("oManageHierModel"),t=this,a=this.getView(),r=a.byId("idHierCatTextInpt").getSelectedKey(),o=a.byId("idHierType").getSelectedKey(),s=ne+
w n({filters:[new n("HierarchyCategory",l.EQ,o),new n("HierarchyId",l.EQ,r)],and:true});e.read("/HierarchyVersionSet",{filters:[s],method:"GET",success:function(e){t._fetchInitialHierarchy(e.results[0].VersionId)},error:function(e){i.error(t.getI18nText(+
"errorFetchingHierData"))}})},_fetchInitialHierarchy:function(e){let t=this.getOwnerComponent().getModel("oManageHierModel"),a=new n("NodeLevel",l.LE,1),r=this.getView().byId("idHierType").getSelectedKey(),o=this;t.read("/HierarchyVersionSet('"+e+"')/Nod+
es",{filters:[a],method:"GET",success:async function(a){for(let n=0;n<a.results.length;n++){a.results[n].Covered="";a.results[n].PlOpeningBalance=0;a.results[n].EqOpeningBalance=0;a.results[n].OpeningBalanceDTADTL=0;a.results[n].PlYearBalance=0;a.results+
[n].EqYearBalance=0;a.results[n].OPlYearBalance=0;a.results[n].OEqYearBalance=0;a.results[n].CurrentYearMvmnt=0;a.results[n].PlClosingBalance=0;a.results[n].EqClosingBalance=0;a.results[n].ClosingBalanceDTADTL=0;a.results[n].CTAPl=0;a.results[n].CTAEq=0;+
a.results[n].CTA=0;a.results[n].PYAPl=0;a.results[n].PYAEq=0;a.results[n].PYAOpl=0;a.results[n].PYAOeq=0;a.results[n].PYA=0;a.results[n].TRCPl=0;a.results[n].TRCEq=0;a.results[n].TRC=0;a.results[n].MainCurrency="";c.push(a.results[n]);if(a.results[n].Nod+
eParentId){await o.__recCallHierarchy(a.results[n].NodeId,t,o,e)}}if(r==="CS15"){o._calculateAmountFSItem(c)}else{o._calculateAmountGLAcc(c)}o.getView().byId("idTreeHierFSItem").setBusy(false);o.getView().byId("idTreeHierGLAcc").setBusy(false)},error:fun+
ction(e){i.error(o.getI18nText("errorFetchingHierData"))}})},__recCallHierarchy:function(e,t,a,r){return new Promise(function(o,s){let d=new n("NodeParentId",l.EQ,e),g=a,u=r;t.read("/HierarchyVersionSet('"+u+"')/Nodes",{filters:[d],method:"GET",success:a+
sync function(e){e.results.sort(function(e,t){var a=e.DrillState.toUpperCase();var n=t.DrillState.toUpperCase();return a<n?-1:a>n?1:0});if(e.results.length===0){o(e)}for(let a=0;a<e.results.length;a++){e.results[a].Covered="";e.results[a].PlOpeningBalanc+
e=0;e.results[a].EqOpeningBalance=0;e.results[a].OpeningBalanceDTADTL=0;e.results[a].PlYearBalance=0;e.results[a].EqYearBalance=0;e.results[a].OPlYearBalance=0;e.results[a].OEqYearBalance=0;e.results[a].CurrentYearMvmnt=0;e.results[a].PlClosingBalance=0;+
e.results[a].EqClosingBalance=0;e.results[a].ClosingBalanceDTADTL=0;e.results[a].CTAPl=0;e.results[a].CTAEq=0;e.results[a].CTA=0;e.results[a].PYAPl=0;e.results[a].PYAEq=0;e.results[a].PYAOpl=0;e.results[a].PYAOeq=0;e.results[a].PYA=0;e.results[a].TRCPl=0+
;e.results[a].TRCEq=0;e.results[a].TRC=0;e.results[a].MainCurrency="";c.push(e.results[a]);if(e.results[a].DrillState!=="leaf"){await g.__recCallHierarchy(e.results[a].NodeId,t,g,u);if(e.results.length===a+1){o(e)}}else{o(e)}}},error:function(e){i.error(+
g.getI18nText("errorFetchingHierData"));s(e)}})})},_calculateAmountFSItem:function(e){let t=this,a=this.getView().byId("idTreeHierFSItem"),n=e.filter(e=>e.NodeEntity==="FINCS_FSITEM"),l=this.getView().getModel("oDTRFModel").getData();if(n.length===0){for+
(var r=0;r<e.length;r++){e[r].Covered="X"}i.warning(t.getI18nText("warningFetchingFSItem"))}for(let e=0;e<n.length;e++){for(let t=0;t<l.length;t++){if(n[e].NodeLowValue===l[t].FinancialStatementItem){n[e].PlOpeningBalance=n[e].PlOpeningBalance+parseFloat+
(l[t].PlOpeningBalance,[10]);n[e].EqOpeningBalance=n[e].EqOpeningBalance+parseFloat(l[t].EqOpeningBalance,[10]);n[e].OpeningBalanceDTADTL=n[e].OpeningBalanceDTADTL+parseFloat(l[t].OpeningBalanceDTADTL,[10]);n[e].PlYearBalance=n[e].PlYearBalance+parseFloa+
t(l[t].PlYearBalance,[10]);n[e].EqYearBalance=n[e].EqYearBalance+parseFloat(l[t].EqYearBalance,[10]);n[e].OPlYearBalance=n[e].OPlYearBalance+parseFloat(l[t].OPlYearBalance,[10]);n[e].OEqYearBalance=n[e].OEqYearBalance+parseFloat(l[t].OEqYearBalance,[10])+
;n[e].CurrentYearMvmnt=n[e].CurrentYearMvmnt+parseFloat(l[t].CurrentYearMvmnt,[10]);n[e].PlClosingBalance=n[e].PlClosingBalance+parseFloat(l[t].PlClosingBalance,[10]);n[e].EqClosingBalance=n[e].EqClosingBalance+parseFloat(l[t].EqClosingBalance,[10]);n[e]+
.ClosingBalanceDTADTL=n[e].ClosingBalanceDTADTL+parseFloat(l[t].ClosingBalanceDTADTL,[10]);n[e].CTAPl=n[e].CTAPl+parseFloat(l[t].CTAPl,[10]);n[e].CTAEq=n[e].CTAEq+parseFloat(l[t].CTAEq,[10]);n[e].CTA=n[e].CTA+parseFloat(l[t].CTA,[10]);n[e].PYAPl=n[e].PYA+
Pl+parseFloat(l[t].PYAPl,[10]);n[e].PYAEq=n[e].PYAEq+parseFloat(l[t].PYAEq,[10]);n[e].PYAOpl=n[e].PYAOpl+parseFloat(l[t].PYAOpl,[10]);n[e].PYAOeq=n[e].PYAOeq+parseFloat(l[t].PYAOeq,[10]);n[e].PYA=n[e].PYA+parseFloat(l[t].PYA,[10]);n[e].TRCPl=n[e].TRCPl+p+
arseFloat(l[t].TRCPl,[10]);n[e].TRCEq=n[e].TRCEq+parseFloat(l[t].TRCEq,[10]);n[e].TRC=n[e].TRC+parseFloat(l[t].TRC,[10]);n[e].MainCurrency=l[t].MainCurrency}}}for(let t=0;t<n.length;t++){for(let a=0;a<e.length;a++){if(n[t].NodeParentId===e[a].NodeId){n[t+
].Covered="X";e[a].PlOpeningBalance=n[t].PlOpeningBalance+e[a].PlOpeningBalance;e[a].EqOpeningBalance=n[t].EqOpeningBalance+e[a].EqOpeningBalance;e[a].OpeningBalanceDTADTL=n[t].OpeningBalanceDTADTL+e[a].OpeningBalanceDTADTL;e[a].PlYearBalance=n[t].PlYear+
Balance+e[a].PlYearBalance;e[a].EqYearBalance=n[t].EqYearBalance+e[a].EqYearBalance;e[a].OPlYearBalance=n[t].OPlYearBalance+e[a].OPlYearBalance;e[a].OEqYearBalance=n[t].OEqYearBalance+e[a].OEqYearBalance;e[a].CurrentYearMvmnt=n[t].CurrentYearMvmnt+e[a].C+
urrentYearMvmnt;e[a].PlClosingBalance=n[t].PlClosingBalance+e[a].PlClosingBalance;e[a].EqClosingBalance=n[t].EqClosingBalance+e[a].EqClosingBalance;e[a].ClosingBalanceDTADTL=n[t].ClosingBalanceDTADTL+e[a].ClosingBalanceDTADTL;e[a].CTAPl=n[t].CTAPl+e[a].C+
TAPl;e[a].CTAEq=n[t].CTAEq+e[a].CTAEq;e[a].CTA=n[t].CTA+e[a].CTA;e[a].PYAPl=n[t].PYAPl+e[a].PYAPl;e[a].PYAEq=n[t].PYAEq+e[a].PYAEq;e[a].PYAOpl=n[t].PYAOpl+e[a].PYAOpl;e[a].PYAOeq=n[t].PYAOeq+e[a].PYAOeq;e[a].PYA=n[t].PYA+e[a].PYA;e[a].TRCPl=n[t].TRCPl+e[+
a].TRCPl;e[a].TRCEq=n[t].TRCEq+e[a].TRCEq;e[a].TRC=n[t].TRC+e[a].TRC;e[a].MainCurrency=n[t].MainCurrency;let l=e.filter(t=>t.NodeParentId===e[a].NodeId&&t.NodeEntity!=="FINCS_FSITEM");if(l.length===0){e[a].Covered="X"}}if(e[a].Covered===""&&e[a].NodeEnti+
ty!=="FINCS_FSITEM"){let t=e.filter(t=>t.NodeParentId===e[a].NodeId);if(t.length===0){e[a].Covered="X"}}}}var o=[];var s=[];o=e.filter(e=>e.Covered==="X"&&e.NodeEntity!=="FINCS_FSITEM");s=e.filter(e=>e.Covered===""&&e.NodeEntity!=="FINCS_FSITEM");while(s+
.length>0){for(let e=0;e<o.length;e++){for(let t=0;t<s.length;t++){if(s[t].NodeId===o[e].NodeParentId){let a=s[t];if(s.filter(e=>e.NodeParentId===a.NodeId).length===0){a.PlOpeningBalance=a.PlOpeningBalance+o[e].PlOpeningBalance;a.EqOpeningBalance=a.EqOpe+
ningBalance+o[e].EqOpeningBalance;a.OpeningBalanceDTADTL=a.OpeningBalanceDTADTL+o[e].OpeningBalanceDTADTL;a.PlYearBalance=a.PlYearBalance+o[e].PlYearBalance;a.EqYearBalance=a.EqYearBalance+o[e].EqYearBalance;a.OPlYearBalance=a.OPlYearBalance+o[e].OPlYear+
Balance;a.OEqYearBalance=a.OEqYearBalance+o[e].OEqYearBalance;a.CurrentYearMvmnt=a.CurrentYearMvmnt+o[e].CurrentYearMvmnt;a.PlClosingBalance=a.PlClosingBalance+o[e].PlClosingBalance;a.EqClosingBalance=a.EqClosingBalance+o[e].EqClosingBalance;a.ClosingBal+
anceDTADTL=o[e].ClosingBalanceDTADTL+a.ClosingBalanceDTADTL;a.CTAPl=o[e].CTAPl+a.CTAPl;a.CTAEq=o[e].CTAEq+a.CTAEq;a.CTA=o[e].CTA+a.CTA;a.PYAPl=o[e].PYAPl+a.PYAPl;a.PYAEq=o[e].PYAEq+a.PYAEq;a.PYAOpl=o[e].PYAOpl+a.PYAOpl;a.PYAOeq=o[e].PYAOeq+a.PYAOeq;a.PYA+
=o[e].PYA+a.PYA;a.TRCPl=o[e].TRCPl+a.TRCPl;a.TRCEq=o[e].TRCEq+a.TRCEq;a.TRC=o[e].TRC+a.TRC;a.Covered="X";a.MainCurrency=o[e].MainCurrency}}}}s=e.filter(e=>e.Covered===""&&e.NodeEntity!=="FINCS_FSITEM");o=e.filter(e=>e.Covered==="X"&&e.NodeEntity!=="FINCS+
_FSITEM")}for(var r=0;r<e.length;r++){e[r].childs=[]}let c=this._buildTree(e);var d={childs:c};this.getView().getModel("HierDatModel").setData([]);this.getView().getModel("HierDatModel").setData(d);this.getBusyDialog().open();var g=window.setInterval(fun+
ction(){this.onAdjustTableCol(a);window.clearInterval(g)}.bind(this),1e3)},_calculateAmountGLAcc:function(e){let t=this,a=this.getView().byId("idTreeHierGLAcc"),n=e.filter(e=>e.NodeEntity==="GLACCOUNT"),l=this.getView().getModel("oDTRFModel").getData();i+
f(n.length===0){for(var r=0;r<e.length;r++){e[r].Covered="X"}i.warning(t.getI18nText("warningFetchingGLAcc"))}for(let e=0;e<n.length;e++){for(let t=0;t<l.length;t++){if(n[e].NodeLowValue===l[t].GLAccount){n[e].PlOpeningBalance=n[e].PlOpeningBalance+parse+
Float(l[t].PlOpeningBalance,[10]);n[e].EqOpeningBalance=n[e].EqOpeningBalance+parseFloat(l[t].EqOpeningBalance,[10]);n[e].OpeningBalanceDTADTL=n[e].OpeningBalanceDTADTL+parseFloat(l[t].OpeningBalanceDTADTL,[10]);n[e].PlYearBalance=n[e].PlYearBalance+pars+
eFloat(l[t].PlYearBalance,[10]);n[e].EqYearBalance=n[e].EqYearBalance+parseFloat(l[t].EqYearBalance,[10]);n[e].OPlYearBalance=n[e].OPlYearBalance+parseFloat(l[t].OPlYearBalance,[10]);n[e].OEqYearBalance=n[e].OEqYearBalance+parseFloat(l[t].OEqYearBalance,+
[10]);n[e].CurrentYearMvmnt=n[e].CurrentYearMvmnt+parseFloat(l[t].CurrentYearMvmnt,[10]);n[e].PlClosingBalance=n[e].PlClosingBalance+parseFloat(l[t].PlClosingBalance,[10]);n[e].EqClosingBalance=n[e].EqClosingBalance+parseFloat(l[t].EqClosingBalance,[10])+
;n[e].ClosingBalanceDTADTL=n[e].ClosingBalanceDTADTL+parseFloat(l[t].ClosingBalanceDTADTL,[10]);n[e].CTAPl=n[e].CTAPl+parseFloat(l[t].CTAPl,[10]);n[e].CTAEq=n[e].CTAEq+parseFloat(l[t].CTAEq,[10]);n[e].CTA=n[e].CTA+parseFloat(l[t].CTA,[10]);n[e].PYAPl=n[e+
].PYAPl+parseFloat(l[t].PYAPl,[10]);n[e].PYAEq=n[e].PYAEq+parseFloat(l[t].PYAEq,[10]);n[e].PYAOpl=n[e].PYAOpl+parseFloat(l[t].PYAOpl,[10]);n[e].PYAOeq=n[e].PYAOeq+parseFloat(l[t].PYAOeq,[10]);n[e].PYA=n[e].PYA+parseFloat(l[t].PYA,[10]);n[e].TRCPl=n[e].TR+
CPl+parseFloat(l[t].TRCPl,[10]);n[e].TRCEq=n[e].TRCEq+parseFloat(l[t].TRCEq,[10]);n[e].TRC=n[e].TRC+parseFloat(l[t].TRC,[10]);n[e].MainCurrency=l[t].MainCurrency}}}for(let t=0;t<n.length;t++){for(let a=0;a<e.length;a++){if(n[t].NodeParentId===e[a].NodeId+
){n[t].Covered="X";e[a].PlOpeningBalance=n[t].PlOpeningBalance+e[a].PlOpeningBalance;e[a].EqOpeningBalance=n[t].EqOpeningBalance+e[a].EqOpeningBalance;e[a].OpeningBalanceDTADTL=n[t].OpeningBalanceDTADTL+e[a].OpeningBalanceDTADTL;e[a].PlYearBalance=n[t].P+
lYearBalance+e[a].PlYearBalance;e[a].EqYearBalance=n[t].EqYearBalance+e[a].EqYearBalance;e[a].OPlYearBalance=n[t].OPlYearBalance+e[a].OPlYearBalance;e[a].OEqYearBalance=n[t].OEqYearBalance+e[a].OEqYearBalance;e[a].CurrentYearMvmnt=n[t].CurrentYearMvmnt+e+
[a].CurrentYearMvmnt;e[a].PlClosingBalance=n[t].PlClosingBalance+e[a].PlClosingBalance;e[a].EqClosingBalance=n[t].EqClosingBalance+e[a].EqClosingBalance;e[a].ClosingBalanceDTADTL=n[t].ClosingBalanceDTADTL+e[a].ClosingBalanceDTADTL;e[a].CTAPl=n[t].CTAPl+e+
[a].CTAPl;e[a].CTAEq=n[t].CTAEq+e[a].CTAEq;e[a].CTA=n[t].CTA+e[a].CTA;e[a].PYAPl=n[t].PYAPl+e[a].PYAPl;e[a].PYAEq=n[t].PYAEq+e[a].PYAEq;e[a].PYAOpl=n[t].PYAOpl+e[a].PYAOpl;e[a].PYAOeq=n[t].PYAOeq+e[a].PYAOeq;e[a].PYA=n[t].PYA+e[a].PYA;e[a].TRCPl=n[t].TRC+
Pl+e[a].TRCPl;e[a].TRCEq=n[t].TRCEq+e[a].TRCEq;e[a].TRC=n[t].TRC+e[a].TRC;e[a].MainCurrency=n[t].MainCurrency;let l=e.filter(t=>t.NodeParentId===e[a].NodeId&&t.NodeEntity!=="GLACCOUNT");if(l.length===0){e[a].Covered="X"}}if(e[a].Covered===""&&e[a].NodeEn+
tity!=="GLACCOUNT"){let t=e.filter(t=>t.NodeParentId===e[a].NodeId);if(t.length===0){e[a].Covered="X"}}}}var o=[];var s=[];o=e.filter(e=>e.Covered==="X"&&e.NodeEntity!=="GLACCOUNT");s=e.filter(e=>e.Covered===""&&e.NodeEntity!=="GLACCOUNT");while(s.length+
>0){for(let e=0;e<o.length;e++){for(let t=0;t<s.length;t++){if(s[t].NodeId===o[e].NodeParentId){let a=s[t];if(s.filter(e=>e.NodeParentId===a.NodeId).length===0){a.PlOpeningBalance=a.PlOpeningBalance+o[e].PlOpeningBalance;a.EqOpeningBalance=a.EqOpeningBal+
ance+o[e].EqOpeningBalance;a.OpeningBalanceDTADTL=a.OpeningBalanceDTADTL+o[e].OpeningBalanceDTADTL;a.PlYearBalance=a.PlYearBalance+o[e].PlYearBalance;a.EqYearBalance=a.EqYearBalance+o[e].EqYearBalance;a.OPlYearBalance=a.OPlYearBalance+o[e].OPlYearBalance+
;a.OEqYearBalance=a.OEqYearBalance+o[e].OEqYearBalance;a.CurrentYearMvmnt=a.CurrentYearMvmnt+o[e].CurrentYearMvmnt;a.PlClosingBalance=a.PlClosingBalance+o[e].PlClosingBalance;a.EqClosingBalance=a.EqClosingBalance+o[e].EqClosingBalance;a.ClosingBalanceDTA+
DTL=o[e].ClosingBalanceDTADTL+a.ClosingBalanceDTADTL;a.CTAPl=o[e].CTAPl+a.CTAPl;a.CTAEq=o[e].CTAEq+a.CTAEq;a.CTA=o[e].CTA+a.CTA;a.PYAPl=o[e].PYAPl+a.PYAPl;a.PYAEq=o[e].PYAEq+a.PYAEq;a.PYAOpl=o[e].PYAOpl+a.PYAOpl;a.PYAOeq=o[e].PYAOeq+a.PYAOeq;a.PYA=o[e].P+
YA+a.PYA;a.TRCPl=o[e].TRCPl+a.TRCPl;a.TRCEq=o[e].TRCEq+a.TRCEq;a.TRC=o[e].TRC+a.TRC;a.Covered="X";a.MainCurrency=o[e].MainCurrency}}}}s=e.filter(e=>e.Covered===""&&e.NodeEntity!=="GLACCOUNT");o=e.filter(e=>e.Covered==="X"&&e.NodeEntity!=="GLACCOUNT")}for+
(var r=0;r<e.length;r++){e[r].childs=[]}let c=this._buildTree(e);var d={childs:c};this.getView().getModel("HierDatModelGL").setData([]);this.getView().getModel("HierDatModelGL").setData(d);this.getBusyDialog().open();var g=window.setInterval(function(){t+
his.onAdjustTableCol(a);window.clearInterval(g)}.bind(this),1e3)},_buildTree:function(e,t){if(t){for(var a=0;a<e.length;a++){if(String(e[a].NodeId)===String(t.NodeParentId)){e[a].childs.push(t);break}else this._buildTree(e[a].childs,t)}}else{var n=0;whil+
e(n<e.length)if(e[n].NodeParentId)this._buildTree(e,e.splice(n,1)[0]);else n++}return e},_fetchGlobalParameters:function(){var e=this;var t={Default:true};var a=this.getOwnerComponent().getModel();a.callFunction("/GlobalParameter",{method:"GET",urlParame+
ters:t,success:function(t){e.getView().getModel("viewConfigDataModel").setData({globalParameters:t});let a=e.getView().byId("idsmartFilterBar");if(!a.getCurrentVariantId()){e._setFilterBarParameters(t)}},error:function(t){i.error(e.getI18nText("errorRead+
ingGlobalParameters"))}})},_setFilterBarParameters:function(e){let t=this.getView(),n=t.byId("idCurrency");if(e.LocalCurrencyType&&e.LocalCurrency){n.setSelectedKey(e.LocalCurrency)}else{n.setSelectedKey(e.GroupCurrency)}if(e.ConsolidationUnit){t.byId("i+
dConsUnit").setSelectedKey(e.ConsolidationUnit);n.setVisible(true);this._fetchCurrencyData(true);this.fetchReconLedgerData()}if(e.FiscalYear){let a=new Date("06/06/".concat(e.FiscalYear.toString()));t.byId("idFiscalYearFilter").setDateValue(a)}if(e.Inten+
tion){t.byId("idIntentionComboBox").setSelectedKey(e.Intention)}var l=[e.ConsolidationUnit,e.FiscalYear];this._fetchIntentionStatus(l);if(e.PeriodFrom){t.byId("idPeriodFromInput").setValue(a.convertStringToInt(e.PeriodFrom))}if(e.PeriodTo){t.byId("idPeri+
odToInput").setValue(a.convertStringToInt(e.PeriodTo))}},getI18nText:function(e){return this.getResourceBundle().getText(e)},_fetchCurrencyData:function(e){var a=this.getView(),i=a.byId("idConsUnit").getSelectedKey(),o=new n("ConsolidationUnit",l.EQ,i),s+
=this.getModel(),c=this,d=a.byId("idCurrType"),g=a.byId("idCurrency");d.setVisible(true);g.setBusy(true);s.read("/xEY1xSAV_C_CurrLocalGroupVH",{method:"GET",filters:[o],success:function(a,n){g.setBusy(false);c.setModel(new t(a),"currLocalGroupVHModel");i+
f(!e&&a.results.length>0){g.setSelectedKey(a.results[0].Currency)}},error:function(e){g.setBusy(false);r.show(c.getI18nText("errorFetchingCurrency"))}})},_fetchIntentionStatus:function(e){let a=this.getModel();let r=e[0],o=e[1],s="/xEY1xSAV_C_IntentionsS+
tatus(p_bunit='"+r+"')/Set",c=new n("Gjahr",l.EQ,o),d=this,g=d.getView(),u=g.byId("idIntentionComboBox");this.getBusyDialog().open();a.read(s,{method:"GET",sorters:[new sap.ui.model.Sorter("SerialNumber")],filters:[c],success:function(e,a){d.getBusyDialo+
g().close();if(e.results.length===0){u.setSelectedKey("");u.setEnabled(false);i.error(d.getI18nText("IntentionNotYetOpen")+o);return}u.setEnabled(true);let n=d.getView().getModel("viewConfigDataModel").getData().globalParameters;u.setSelectedKey(n.Intent+
ion);u.setSelectedKey("");for(let t=0;t<e.results.length;t++){if(e.results[t].isSelected==="X"){u.setSelectedKey(e.results[t].Intention)}}if(u.getSelectedKey()===""){for(let t=0;t<e.results.length;t++){if(e.results[t].status==="Open"){u.setSelectedKey(e.+
results[t].Intention)}}}let l=new t(e);d.getView().setModel(l,"intentionVHModel");d._managePeriodFieldsEditability(false)},error:function(e){d.getBusyDialog().close();i.error(d.getI18nText("errorFetchingIntentionStatus"))}})},_managePeriodFieldsEditabili+
ty:function(e){let t=this.getView(),n=t.byId("idIntentionComboBox");if(!e){n.setSelectedKey(n.getSelectedKey())}let l=n.getSelectedItem(),r=l.getBindingContext("intentionVHModel").getObject(),i=t.byId("idPeriodToInput"),o=a.convertStringToInt(r.TaxIntent+
ion);if(o!==a.convertStringToInt(0)){i.setEditable(false);i.setValue(a.convertStringToInt(r.PeriodTo))}else{i.setEditable(true)}},fetchReconLedgerData:function(){let e=this.getModel();let t=e.createKey("/xEY1xSAV_C_Recon_Ledger",{bunit:this.byId("idConsU+
nit").getSelectedKey()});let a=this;e.read(t,{method:"GET",success:function(e,t){var n=a.getModel("viewConfigDataModel");n.getData().dtrfData=e;n.refresh()},error:function(e){if(parseInt(e.statusCode,[10])!==404){r.show(a.getI18nText("reconServiceCallErr+
or"))}}})},onSearchButtonPressed:function(e){let t=this.getView();c=[];if(t.byId("idHierCatTextInpt").getSelectedKey()){if(t.byId("idHierType").getSelectedKey()==="CS15"){t.byId("idTreeHierFSItem").setBusy(true)}else{t.byId("idTreeHierGLAcc").setBusy(tru+
e)}this._fetchDTRFData()}else{t.byId("idHierCatTextInpt").setValueState("Error")}},onChangeHierId:function(e){let t=e.getSource().getSelectedKey(),a=this.getView().getModel("hierarCatModel").getData(),n=a.some(e=>e.HierarchyId===t),l=this.getView().byId(+
"idsmartFilterBar");if(n){e.getSource().setValueState("None");l.fireSearch()}else{e.getSource().setValueState("Error")}},onBeforeVariantSaveFilterBar:function(e){let t=this.getView(),a=t.byId("idsmartFilterBar"),n=t.byId("idConsUnit"),l=t.byId("idFiscalY+
earFilter"),r=t.byId("idIntentionComboBox"),i=t.byId("idCurrency"),o=t.byId("idPeriodToInput");a.setFilterData({_CUSTOM:{ConsolidationUnit:n.getSelectedKey(),FiscalYear:l.getValue(),Intention:r.getSelectedKey(),CurrType:i.getSelectedKey(),PeriodTo:o.getV+
alue(),VariantID:a.getCurrentVariantId()}})},onAfterVariantLoadFilterBar:function(e){var t=this.getView();var n=t.byId("idsmartFilterBar");var l=t.byId("idConsUnit");var r=t.byId("idFiscalYearFilter");let i=t.byId("idIntentionComboBox");var o=t.byId("idC+
urrency");let s=this.getView().byId("idPeriodToInput");var c=n.getFilterData()["_CUSTOM"];l.setSelectedKey(c.ConsolidationUnit);r.setValue(c.FiscalYear);i.setSelectedKey(c.Intention);o.setSelectedKey(c.CurrType);s.setValue(a.convertStringToInt(c.PeriodTo+
));if(c.ConsolidationUnit){this.fetchReconLedgerData()}if(c.CurrType){o.setVisible(true);this._fetchCurrencyData(true)}var d=[l,r];this._fetchIntentionStatus(d)},onChangeDatePickerFilter:function(e){let t=e.getSource(),a=this.getView().byId("idConsUnit")+
.getProperty("selectedKey");if(e.getParameter("valid")){t.setValueState("None");let e=t.getDateValue().getFullYear(),n=[a,e];this._fetchIntentionStatus(n)}else{t.setValueState("Error")}},onConsUnitChange:function(e){this._fetchCurrencyData(false);this.fe+
tchReconLedgerData();let t=this.getView().byId("idConsUnit").getProperty("selectedKey");let a=[t,this.getView().byId("idFiscalYearFilter").getDateValue().getFullYear()];this._fetchIntentionStatus(a)},onChangeIntentionComboBox:function(e){let t=this.getVi+
ew(),a=t.byId("idIntentionComboBox"),n=a.getSelectedItem();if(!n){a.setSelectedItem("");return}this._managePeriodFieldsEditability(true)},onChangeHierTypeCB:function(e){let t=e.getSource().getSelectedKey(),a=this.getView();if(t==="CS15"){a.byId("idFSitmS+
martTable").setVisible(true);a.getModel("HierDatModel").setData([]);a.byId("idGLAccSmartTable").setVisible(false)}else{a.byId("idGLAccSmartTable").setVisible(true);a.byId("idFSitmSmartTable").setVisible(false);a.getModel("HierDatModelGL").setData([])}thi+
s._fetchValueHelpHierarchyTxt(t)},onLiveChangePeriodTo:function(){let e=this.getView().byId("idPeriodToInput");let t=parseInt(this.getView().byId("idPeriodFromInput").getValue(),[10]);let a=parseInt(e.getValue(),[10]);e.setValueState("None");if(a<t){e.se+
tValueState("Error");e.setValueStateText(this.getI18nText("periodToLessThanPeriodFromErrorMsg"));return}else if(a>"012"){e.setValueState("Error");e.setValueStateText(this.getI18nText("periodToGreaterThanLastPeriod"));return}},onValueHelpRequested:functio+
n(e){let t=this.getView(),a=t.getModel("VHColumnModel").getData().cols,n=this,l=this.getView().byId("idHierCatTextInpt");if(!this._oHierIdVHDialog){this._oHierIdVHDialog=sap.ui.xmlfragment("ey.sap.fin.cs.hierarchyReportDTRF.fragment.hierarchyIdValueHelp"+
,this);this.getView().addDependent(this._oHierIdVHDialog)}this._oHierIdVHDialog.getTableAsync().then(function(e){e.setModel(t.getModel("hierarCatModel"));e.setModel(t.getModel("VHColumnModel"),"columns");e.bindAggregation("rows","/");e.attachRowSelection+
Change(function(e){let t=e.getParameters(),a=t.rowContext.getProperty().HierarchyId;l.setSelectedKey(a);n._oHierIdVHDialog.close()})});this._oHierIdVHDialog.open()},onValueHelpCancelPress:function(){this._oHierIdVHDialog.close()},onValueHelpAfterClose:fu+
nction(){this._oHierIdVHDialog.destroy();this._oHierIdVHDialog=undefined},onFilterBarSearch:function(e){let t=e.getParameter("selectionSet"),a=t.reduce(function(e,t){if(t.getValue()){e.push(new n({path:t.getName(),operator:l.Contains,value1:t.getValue()}+
))}return e},[]);this._filterVHTable(new n({filters:a,and:true}))},onUpdateRows:function(e){this.getBusyDialog().open();let t=e.getSource();var a=window.setInterval(function(){this.onAdjustTableCol(t);window.clearInterval(a)}.bind(this),1e3)},onAdjustTab+
leCol:function(e){let t=e.getColumns();for(var a=t.length-1;a>=0;a--){e.autoResizeColumn(a)}e.setFixedColumnCount(1);this.getBusyDialog().close()},onChangeButtonReportingType:function(e){let t=this.getView().byId("idsmartFilterBar");if(t.validateMandator+
yFields()){t.fireSearch()}}})});                                                                                                                                                                                                                               