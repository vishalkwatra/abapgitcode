sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/ListItem"],function(e,t,n,i,o,r,a,s){"use strict";return e.exten+
d("ey.sap.fin.cs.temporaryrollfwd.controller.MainReport",{formatter:n,onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("mainreport").attachMatched(this._onRouteMatched,this);this._fetchGlobalParameters();this._fet+
chAdjustmentReasons();this.getView().setModel(new t({results:[{key:"RGAAP",text:this.getI18nText("sBtnTextReportingGAAP")},{key:"SGAAP",text:this.getI18nText("sBtnTextStatutoryReporting")}]}),"modelReportingType")},_onRouteMatched:function(){this.getBusy+
Dialog().close();this.oGlobalSmartTable=this.getView().byId("idTRFMainRepSmartTable");this.oGlobalSmartTable.getTable().setFixedColumnCount(3)},_fetchGlobalParameters:function(){var e=this;var n=this.getOwnerComponent().getModel();var i={Default:true};le+
t o=new t;this.setModel(o,"viewConfigDataModel");n.callFunction("/GlobalParameter",{method:"GET",urlParameters:i,success:function(t){e.getView().getModel("viewConfigDataModel").setData({globalParameters:t});let n=e.getView().byId("idTRFMainRepSmartFilter+
Bar");if(!n.getCurrentVariantId()){e._setFilterBarParameters(t)}},error:function(t){a.error(e.getI18nText("errorReadingGlobalParameters"))}})},_setFilterBarParameters:function(e){let t=this.getView(),i=t.byId("idCurrency");if(e.ConsolidationUnit){t.byId(+
"idConsUnit").setSelectedKey(e.ConsolidationUnit);i.setVisible(true);this._fetchCurrencyData(true);this.fetchReconLedgerData()}if(e.FiscalYear){let n=new Date("06/06/".concat(e.FiscalYear.toString()));t.byId("idFiscalYearFilter").setDateValue(n)}if(e.Int+
ention){t.byId("idIntentionComboBox").setSelectedKey(e.Intention)}var o=[e.ConsolidationUnit,e.FiscalYear];this._fetchIntentionStatus(o);if(e.PeriodFrom){t.byId("idPeriodFromInput").setValue(n.convertStringToInt(e.PeriodFrom))}if(e.PeriodTo){t.byId("idPe+
riodToInput").setValue(n.convertStringToInt(e.PeriodTo))}if(e.LocalCurrencyType&&e.LocalCurrency){i.setSelectedKey(e.LocalCurrency)}else{i.setSelectedKey(e.GroupCurrency)}if(e.ConsolidationUnit&&e.FiscalYear&&e.Intention){this._fetchValidTaxRates({Consol+
idationUnit:e.ConsolidationUnit,PeriodTo:e.PeriodTo,FiscalYear:e.FiscalYear})}},_fetchAdjustmentReasons:function(){let e=this.getOwnerComponent().getModel();let t="/xEY1xSAV_C_Recon_Adj_Reason";let n=this;e.read(t,{method:"GET",success:function(e,t){var +
i=n.getModel("viewConfigDataModel");i.getData().adjustmentReason=e.results;i.refresh()},error:function(e){if(parseInt(e.statusCode,[10])!==404){r.show(n.getI18nText("adjReasonServiceCallError"))}}})},getI18nText:function(e){return this.getResourceBundle(+
).getText(e)},_fetchCurrencyData:function(e){var n=this.getView(),r=n.byId("idConsUnit").getSelectedKey(),a=new i("ConsolidationUnit",o.EQ,r),s=this.getModel(),l=this,d=n.byId("idCurrType"),u=n.byId("idCurrency");d.setVisible(true);u.setBusy(true);s.read+
("/xEY1xSAV_C_CurrLocalGroupVH",{method:"GET",filters:[a],success:function(n,i){u.setBusy(false);l.setModel(new t(n),"currLocalGroupVHModel");if(!e&&n.results.length>0){u.setSelectedKey(n.results[0].Currency)}},error:function(e){u.setBusy(false)}})},_fet+
chIntentionStatus:function(e){let n=this.getModel();let r=e[0],s=e[1],l="/xEY1xSAV_C_IntentionsStatus(p_bunit='"+r+"')/Set",d=new i("Gjahr",o.EQ,s),u=this,g=u.getView(),c=g.byId("idIntentionComboBox");this.getBusyDialog().open();n.read(l,{method:"GET",so+
rters:[new sap.ui.model.Sorter("SerialNumber")],filters:[d],success:function(e,n){u.getBusyDialog().close();if(e.results.length===0){c.setSelectedKey("");c.setEnabled(false);a.error(u.getI18nText("IntentionNotYetOpen")+s);return}c.setEnabled(true);let i=+
u.getView().getModel("viewConfigDataModel").getData().globalParameters;c.setSelectedKey(i.Intention);c.setSelectedKey("");for(let t=0;t<e.results.length;t++){if(e.results[t].isSelected==="X"){c.setSelectedKey(e.results[t].Intention)}}if(c.getSelectedKey(+
)===""){for(let t=0;t<e.results.length;t++){if(e.results[t].status==="Open"){c.setSelectedKey(e.results[t].Intention)}}}let o=new t(e);u.getView().setModel(o,"intentionVHModel");u._managePeriodFieldsEditability(false)},error:function(e){u.getBusyDialog()+
.close();a.error(u.getI18nText("errorFetchingIntentionStatus"))}})},_managePeriodFieldsEditability:function(e){let t=this.getView(),i=t.byId("idIntentionComboBox");if(!e){i.setSelectedKey(i.getSelectedKey())}let o=i.getSelectedItem(),r=o.getBindingContex+
t("intentionVHModel").getObject();let a=t.byId("idPeriodToInput"),s=n.convertStringToInt(r.TaxIntention);if(s!==n.convertStringToInt(0)){this._manageIntentionStatus(r);a.setEditable(false);a.setValue(n.convertStringToInt(r.PeriodTo))}else{this._managePer+
odicIntentionStatus(r.PeriodTo);a.setEditable(true);a.setValue(n.convertStringToInt(r.CurrOpenPeriod))}},_manageIntentionStatus:function(e){let t=this;if(e.status===this.getI18nText("YetToOpen")){t.getBusyDialog().close();a.error(this.getModel("i18n").ge+
tResourceBundle().getText("ThisIntentionNotYetOpen",[e.IntentDescription,e.Gjahr]));return}else{return}},_managePerodicIntentionStatus:function(e){let t=this.getView().byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel").ge+
tObject(),n=parseInt(t.CurrOpenPeriod,[10]);if(e>n){this.getBusyDialog().close();a.error(this.getModel("i18n").getResourceBundle().getText("errorPeriodnotopen",[e,n]));return}else{return}},_fetchCnsldVersion:function(){let e=this.getModel(),n=this.getMod+
el("viewConfigDataModel").getData(),i=n.globalParameters.ConsolidationGroup,o="/xEY1xSAV_C_Get_Version(p_congr='"+i+"')/Set",a=this,s=new t;sap.ui.getCore().setModel(s,"viewCnlVersionModel");e.read(o,{method:"GET",sorters:[new sap.ui.model.Sorter("Fiscal+
Year")],success:function(e,t){sap.ui.getCore().getModel("viewCnlVersionModel").setData({ConsolidationVersion:e})},error:function(e){if(parseInt(e.statusCode,[10])!==404){r.show(a.getI18nText("GetConsolidationVersionServiceCallError"))}}})},_createJournal+
EntriesFilterData:function(e){let t=e.getSource().getBindingContext();if(!t.getProperty("GLAccount")){return}let i=this.getModel("viewConfigDataModel").getData(),o=this.getView().byId("idFiscalYearFilter"),r=o.getDateValue().getFullYear(),a=parseInt(this+
.getView().byId("idPeriodFromInput").getValue(),[10]),s=parseInt(this.getView().byId("idPeriodToInput").getValue(),[10]),l=this.getView().byId("idConsUnit"),d=this.getView().byId("idCurrency"),u=this.getView().byId("idIntentionComboBox").getSelectedItem(+
).getBindingContext("intentionVHModel").getObject(),g=n.convertStringToInt(u.PeriodTo)===0?"":n.convertStringToInt(u.TaxIntention),c=t.getProperty("GLAccount").padStart(10,"0"),h=[],f=false;let I=[],y=i.globalParameters.ConsolidationGroup,C=this.getView(+
).byId("idTRFMainRepSegmentedBtn").getSelectedKey();if(C==="RGAAP"){I=[i.reconData.g2s,i.reconData.s2t]}else{I=[i.reconData.s2t]}let p=e.getSource().getCustomData();for(let e of p){let t=e.getValue();let n=e.getKey();if(n==="mappedAdjReason"){for(let e=0+
;e<i.adjustmentReason.length;e++){if(i.adjustmentReason[e].AdjustmentReason===t){h.push(i.adjustmentReason[e].TransType)}}continue}if(n==="mappedIsOpeningBalanceEntry"){f=true}}let T=e.getSource().getBindingInfo("text").parts,b=T[T.map(e=>e.path.indexOf(+
"MainCurrency")!==0).indexOf(true)].path;let m=this.serviceDataProperty.property;m=m[m.map(e=>e.name).indexOf(b)];let S=m.extensions;S=S[S.map(e=>e.name).indexOf("label")];return{ConsolidationChartOfAccounts:i.globalParameters.ConsolidationChartofAccount+
s,FiscalYear:r,PeriodFrom:a,PeriodTo:s,ConsolidatioUnit:l.getSelectedKey(),ConsolidationLedger:I,FinancialTransactionType:h,Value:t.getProperty(b),Currency:t.getProperty("MainCurrency"),GLAccount:c,ConsolidationVersion:"",SelectedIntention:g,Consolidatio+
nGroup:"",PeriodMode:"PER",RefConsolidationDocumentType:"W",selectedCurrency:d.getSelectedKey(),SectionName:S.value,GLAccountDesc:t.getProperty("GLAccountMdmText"),bIsOpeningBalanceEntry:f,ReportingType:C,Congr:y}},_fetchValidTaxRates:function(e){e=e?e:{+
};let t=this,n=this.getView(),o=n.byId("idConsUnit").getSelectedKey(),s=n.byId("idIntentionComboBox").getSelectedItem(),l=n.byId("idFiscalYearFilter").getDateValue(),d=this.getModel();if(!s){return}let u=e.ConsolidationUnit?e.ConsolidationUnit:o,g=e.Peri+
odTo?e.PeriodTo:s.getBindingContext("intentionVHModel").getObject().PeriodTo,c=e.FiscalYear?e.FiscalYear:l.getFullYear();if(!u||!g||!c){return}let h="/xEY1xSAV_C_Fetch_Tax_Rates(p_toperiod='"+g+"',p_ryear='"+c+"')/Set";d.read(h,{method:"GET",filters:[new+
 i("ConsolidationUnit","EQ",u)],success:function(e){if(e.results.length<1){a.warning(t.getI18nText("warningTaxRatesNotMaintained"))}},error:function(e){r.show(t.getI18nText("warningFetchingTaxRates"))}})},onBeforeRebindTable:function(e){let t=this.getVie+
w(),n=t.getModel("viewConfigDataModel").getData();if(!n.globalParameters||!n.globalParameters.ConsolidationChartofAccounts||!n.globalParameters.ConsolidationGroup){a.error(this.getI18nText("errorMaintainGlobalParameter"));return}let r=t.byId("idConsUnit"+
),s=r.getSelectedKey(),l=t.byId("idCurrency"),d=l.getSelectedKey(),u=t.byId("idFiscalYearFilter"),g=u.getDateValue().getFullYear(),c=t.byId("idPeriodToInput"),h=parseInt(c.getValue(),[10]),f,I,y;if(t.byId("idIntentionComboBox").getEnabled()===false){a.er+
ror(this.getI18nText("IntentionNotYetOpen")+g);this.oGlobalSmartTable.setTableBindingPath("");return}let C=t.byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel"),p=C.getObject(),T=parseInt(p.CurrOpenPeriod,[10]);if(p.status+
===this.getI18nText("YetToOpen")){this.getBusyDialog().close();a.error(this.getModel("i18n").getResourceBundle().getText("ThisIntentionNotYetOpen",[p.IntentDescription,p.Gjahr]));this.oGlobalSmartTable.setTableBindingPath("");return}if(h>T){this.getBusyD+
ialog().close();a.error(this.getModel("i18n").getResourceBundle().getText("errorPeriodnotopen",[h,T]));this.oGlobalSmartTable.setTableBindingPath("");return}let b=parseInt(p.TaxIntention,[10]),m=b>12?b:"",S=p.TaxIntention,V=this.getView().byId("idTRFMain+
RepSegmentedBtn").getSelectedKey();f=new i({filters:[new i("ConsolidationUnit",o.EQ,s),new i("ConsolidationChartofAccounts",o.EQ,n.globalParameters.ConsolidationChartofAccounts),new i("MainCurrency",o.EQ,d),new i("ReportingType",o.EQ,V)],and:true});y=f;i+
f(e.getParameter("bindingParams").filters.length>0){I=new i({filters:e.getParameter("bindingParams").filters});y=new i({filters:[f,I],and:true})}let P="/xEY1xSAV_C_TempRollForward(p_toperiod='"+h+"',p_ryear='"+g+"',p_taxintention='"+m+"',p_rbunit='"+s+"'+
)/Results";this.oGlobalSmartTable.setTableBindingPath(P);let x=e.getParameter("bindingParams");x.filters=[y]},onBeforeVariantSaveFilterBar:function(e){let t=this.getView(),n=t.byId("idTRFMainRepSmartFilterBar"),i=t.byId("idConsUnit"),o=t.byId("idFiscalYe+
arFilter"),r=t.byId("idIntentionComboBox"),a=t.byId("idCurrency"),s=t.byId("idPeriodToInput");n.setFilterData({_CUSTOM:{ConsolidationUnit:i.getSelectedKey(),FiscalYear:o.getValue(),Intention:r.getSelectedKey(),CurrType:a.getSelectedKey(),PeriodTo:s.getVa+
lue(),VariantID:n.getCurrentVariantId()}})},onAfterVariantLoadFilterBar:function(e){var t=this.getView();var i=t.byId("idTRFMainRepSmartFilterBar");var o=t.byId("idConsUnit");var r=t.byId("idFiscalYearFilter");let a=t.byId("idIntentionComboBox");var s=t.+
byId("idCurrency");let l=this.getView().byId("idPeriodToInput");var d=i.getFilterData()["_CUSTOM"];o.setSelectedKey(d.ConsolidationUnit);r.setValue(d.FiscalYear);a.setSelectedKey(d.Intention);s.setSelectedKey(d.CurrType);l.setValue(n.convertStringToInt(d+
.PeriodTo));if(d.ConsolidationUnit){this.fetchReconLedgerData()}if(d.CurrType){s.setVisible(true);this._fetchCurrencyData(true)}if(d.ConsolidationUnit&&d.FiscalYear&&d.Intention){this._fetchValidTaxRates({ConsolidationUnit:d.ConsolidationUnit,PeriodTo:d.+
PeriodTo,FiscalYear:d.FiscalYear})}let u=[d.ConsolidationUnit,d.FiscalYear];this._fetchIntentionStatus(u)},onSearchButtonPressed:function(e){let t=this.getModel().getServiceMetadata().dataServices.schema[0].entityType;this.serviceDataProperty=t.find(e=>e+
.name==="xEY1xSAV_C_TempRollForwardResult")},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh()}else{var t=[];var n=e.getParameter("query");if(n&&n.length>0){t=[new i("GLAccount",o.Contains,n)]}this._applySearch(t)}},onDataR+
eceivedSmartTable:function(e){this.getBusyDialog().open();this.oGlobalSmartTable.getTable().setVisibleRowCount(10);var t=window.setInterval(function(){this.onAdjustTableCol();window.clearInterval(t)}.bind(this),1e3)},onAdjustTableCol:function(){let e=thi+
s.oGlobalSmartTable;var t=e.getTable();var n=t.getColumns();for(var i=n.length-1;i>=0;i--){t.autoResizeColumn(i)}this.getBusyDialog().close()},onChangeDatePickerFilter:function(e){let t=e.getSource(),n=this.getModel("viewConfigDataModel").getData(),i=thi+
s.getView().byId("idConsUnit").getProperty("selectedKey");if(e.getParameter("valid")){t.setValueState("None");let e=t.getDateValue().getFullYear(),n=[i,e];this._fetchIntentionStatus(n)}else{t.setValueState("Error")}if(e.getSource().getValue()){this._fetc+
hValidTaxRates()}},onConsUnitChange:function(e){this._fetchCurrencyData(false);this.fetchReconLedgerData();let t=e.getSource().getSelectedKey(),n=[t,this.getView().byId("idFiscalYearFilter").getDateValue().getFullYear()];this._fetchIntentionStatus(n);if(+
e.getSource().getValue()){this._fetchValidTaxRates()}},onChangeIntentionComboBox:function(e){let t=this.getView(),n=t.byId("idIntentionComboBox"),i=n.getSelectedItem();if(!i){n.setSelectedItem("");return}this._managePeriodFieldsEditability(true);if(e.get+
Source().getValue()){this._fetchValidTaxRates()}},fetchReconLedgerData:function(){let e=this.getModel();let n=e.createKey("/xEY1xSAV_C_Recon_Ledger",{bunit:this.byId("idConsUnit").getSelectedKey()});let i=this;e.read(n,{method:"GET",success:function(e,n)+
{var o=i.getModel("viewConfigDataModel");o.getData().reconData=e;o.refresh();i.getOwnerComponent().setModel(new t(e),"reconLedgerModel");i._fetchCnsldVersion()},error:function(e){if(parseInt(e.statusCode,[10])!==404){r.show(i.getI18nText("reconServiceCal+
lError"))}}})},onLiveChangePeriodTo:function(){let e=this.getView().byId("idPeriodToInput");let t=parseInt(this.getView().byId("idPeriodFromInput").getValue(),[10]);let n=parseInt(e.getValue(),[10]);e.setValueState("None");if(n<t){e.setValueState("Error"+
);e.setValueStateText(this.getI18nText("periodToLessThanPeriodFromErrorMsg"));return}else if(n>"012"){e.setValueState("Error");e.setValueStateText(this.getI18nText("periodToGreaterThanLastPeriod"));return}else{this._managePerodicIntentionStatus(n)}},onPr+
essColumnMenuOpenGLAccount:function(e){let t=e.getParameter("menu").getPopup();t.attachOpened(function(e){let t=e.getSource().getContent().getAggregation("items");let n=t.map(e=>e.getId().toString().indexOf("menu-freeze")!==-1).indexOf(true);t[n].setEnab+
led(false)})},onPressTRFEntryDetails:function(e){var n=this._createJournalEntriesFilterData(e);if(!n){return}var i=new t(n);this.getOwnerComponent().setModel(i,"JournalEntryData");this.oRouter.navTo("JournalEntries")},onChangeButtonReportingType:function+
(e){let t=this.getView().byId("idTRFMainRepSmartFilterBar");if(t.validateMandatoryFields()){t.fireSearch()}}})});                                                                                                                                              