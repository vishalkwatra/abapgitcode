sap.ui.define(["sap/ui/model/Filter","sap/ui/core/Fragment","sap/ui/core/mvc/Controller","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/fin/gl/lib/posting/util/Constants","sap/fin/gl/lib/posting/c+
ontroller/AbstractPostingController"],function(e,t,n,i,o,r,s,a,l){"use strict";var g=sap.ui.controller("fin.gl.documentpost.FIN_GLDOCPOSTExtension.controller.PostingCustom",{onInit:function(){var e={FinsPostingGLHeader:{containerId:""},FinsPostingGLItem:+
{containerId:""},FinsPostingTax:{containerId:""},ScreenVariantButtonSubHeader:{containerId:"fin.gl.documentpost.btnScreenVariantSelect"},TotalBalanceSubHeader:{containerId:"fin.gl.documentpost.totalBalanceSubHeader"}};this.abstractOnInit(e);this.getView(+
).getModel("share").setProperty("/shareOnJamTitle",this.getResourceBundle().getText("shareOnJamTitle"));this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("fullscreen").attachMatched(this._onRouteMatched,this)},_onRouteMatched:functi+
on(e){let t="/ZZ1_LedgerGroupSet",n="/ZZ1_TaxIntentionSet",i=this.byId("sap.fin.gl.lib.posting.items").getItems();this._getValidationData(t,"ledgerGrpVHModel")},_getValidationData:function(e,t){let n=this.getOwnerComponent().getModel(),i=this,s,a=[];n.re+
ad(e,{method:"GET",success:function(e,n){a=e.results;let r=new o(a);i.getView().setModel(r,t)},error:function(e){r.show(this.getResourceBundle().getText("errorGetValidatnData"))}})},_setValue:function(e,t){let n="",i,o,r=null;for(var s=0;s<e.length;s++){+
n=this._getComponentContainerID(e,s);r=this.byId(n).getComponentInstance();if(r){i=r.page.getIdForLabel();o=sap.ui.getCore().byId(i+"_codingBlockGroupElement_ZZ1_LedgerGroup_COB");this._validateSetValue(o,t)}}},_validateSetValue:function(e,t){let n=this.+
getView().getModel("ledgerGrpVHModel").getData(),i=n.find(e=>e.Code===t);if(i){let t=i.Code+" ("+i.Description+")";e.getInnerControls()[0].setText(t)}else{e.getInnerControls()[0].setText("")}},_fetchIntention:function(e,t,n){let i=this.getOwnerComponent(+
).getModel("oAppServicesModel"),o,s=this.getView(),a=this;s.setBusyIndicatorDelay(-1).setBusy(true);i.read("/xEY1xC_INTENTIONS_VH(p_bunit='"+t+"',p_gjahr='"+e+"')/Set",{method:"GET",success:function(e,t){s.setBusy(false);if(e.results.length>0){o=e.result+
s[0].Description+" ("+e.results[0].IntentionCode+")"}n.getInnerControls()[0].setText(o)},error:function(e){s.setBusy(true);r.show(this.getResourceBundle().getText("errorGetTaxIntData"))}})},createCodingBlock:function(e,t){var n;var i;var o=this.getView()+
;var r=true;var s=this.oModel.getProperty("TmpId",o.getBindingContext());var l=this.oModel.getProperty("TmpIdType",o.getBindingContext());var g="";var c=null;var d=null;var u="";var p=null;var h=this.byId("sap.fin.gl.lib.posting.items").getItems();if(t==+
=a.LINE_ITEM_EXPAND){n=e+1}else if(t===a.LINE_ITEM_DELETE){n=h.length}var f=this.oModel.getProperty(o.getBindingContext().getPath());var m=this.getCBAttributeLabelsObject(f);let C=o.getModel("ledgerGrpVHModel").getData();if(l===a.RECURRING_TYPE||l===a.PA+
RKED_TYPE){r=false}for(var I=e;I<n;I++){g=this._getComponentContainerID(h,I);c=this.byId(g).getComponentInstance();if(t===a.LINE_ITEM_EXPAND&&!c){i=true}else if(t===a.LINE_ITEM_DELETE){i=true}if(i){d=h[I].getBindingContext();u=d.getProperty("AccountingDo+
cumentItemRef");p=sap.ui.getCore().createComponent({name:"sap.fin.acc.lib.codingblock.component",componentData:{entitySetName:"FinsPostingGLItems",entityKey:{AccountingDocumentItemRef:u,TmpId:s,TmpIdType:l},attributeLabels:m,editMode:r,enableProfitabilit+
ySegment:true,profitabilitySegmentEntitySetName:"FinsPostingGLItemProfitbltySgmts",profitabilitySegmentFunctionImports:{CHECK:"CheckAndDetermine",OPEN:"ProfitabilitySegmentOpen",DERIVE:"ProfitabilitySegmentDerive",DERIVECLOSE:"ProfitabilitySegmentDeriveA+
ndClose",CLOSE:"ProfitabilitySegmentClose",DELETE:"ProfitabilitySegmentDelete"}}});p.attachCodingBlockAttributeChanged(jQuery.proxy(this.onCodingBlockChange,this));p.attachEnterPressed(jQuery.proxy(this.onsapenter,this));p.onAfterRendering=function(){let+
 e=this.page.getIdForLabel(),t=sap.ui.getCore().byId(e+"_codingBlockGroupElement_ZZ1_LedgerGroup_COB"),n=sap.ui.getCore().byId(e+"_codingBlockGroupElement_ZZ1_TaxIntention_COB"),i=f.LedgerGroup;t.setShowValueHelp(false);t.setShowSuggestion(false);t.setEn+
abled(false);n.setShowValueHelp(false);n.setShowSuggestion(false);n.setEnabled(false);let o=C.find(e=>e.Code===i);if(o){let e=o.Code+" ("+o.Description+")";t.getInnerControls()[0].setText(e)}else{t.getInnerControls()[0].setText("")}};this.byId(g).setComp+
onent(p);this.sCompanyCodeForCodingBlockLabels=f.CompanyCode;this._sLedgerGroupForCodingBlockLabels=f.LedgerGroup}}},onHeaderChanged:function(e){this._bKeyFieldsChanged=true;this._checkAllMandatoryFilled();var t=e.getParameters();if(t.id.match("[A-Za-z]*+
(sfHeaderCompanyCode){1}")||t.id.match("[A-Za-z]*(sfHeaderTransactionCurrency){1}")||t.id.match("[A-Za-z]*(sfHeaderLedgerGroup){1}")){this.fillBalanceTableEntries();this.computeBalance()}if(t.id.match("[A-Za-z]*(sfHeaderTransactionCurrency){1}")){this.up+
dateTransactionCurrencyOnItem()}let n=this.getOwnerComponent().getModel().getProperty(this.getView().getBindingContext().getPath()),i=n.LedgerGroup,o=this.byId("sap.fin.gl.lib.posting.items").getItems();this._setValue(o,i)},submitChanges:function(e,t,n,i+
){let o=e,r=this,s=o.getContent()[0].getComponentInstance().page.getIdForLabel();this.oModel.attachRequestCompleted({sId:s,oControl:r},a,this);function a(e,t){let n=sap.ui.getCore().byId(t.sId+"_codingBlockGroupElement_ZZ1_TaxIntention_COB"),i=e.getParam+
eters().url.split("("),o=t.oControl;if(n){if(i[0]==="FinsPostingGLHeaders"&&e.getParameters().method==="GET"){let t=e.getParameters().url.split("?"),i=e.getSource().getProperty(g+"/FiscalYear"),r=e.getSource().getProperty(g+"/CompanyCode");console.log(o)+
;console.log(i);console.log(r);o._fetchIntention(i,r,n)}}}var l=jQuery.proxy(function(){var e=this.byId("sap.fin.gl.lib.posting.smartTableTax");if(e){e.rebindTable(true)}if(this.mEntityMap.hasOwnProperty("RecrrgAcctgDocOccurrence")){var n=this.byId(this.+
mEntityMap.RecrrgAcctgDocOccurrence.containerId);if(n){n.rebindTable()}}if(t){t()}},this);this.addActionCheckAndDetermine(e.getBindingContext());var g=this.getView().getBindingContext().getPath();var c="";var d=this.oModel.getPendingChanges();jQuery.each+
(d,jQuery.proxy(function(e,t){if(e.indexOf("FinsPostingGLItems")!==-1){c="RecrrgAcctgDocPostingLists,RecurrenceDefinition,Tax"}else if(e.indexOf("FinsPostingTaxes")!==-1){c="Items,RecrrgAcctgDocPostingLists,RecurrenceDefinition"}else if(e.indexOf("Recurr+
enceDefinitions")!==-1){c="Items,RecrrgAcctgDocPostingLists,Tax"}else if(e.indexOf("RecrrgAcctgDocOccurrences")!==-1){c="Items,RecurrenceDefinition,Tax"}else{c="Items,RecrrgAcctgDocPostingLists,RecurrenceDefinition,Tax"}},this));var u;if(c!==""){u={urlPa+
rameters:{$expand:c},groupId:"DEFAULT"};this.oModel.read(g,u)}else if(i){var p=g+"/Items";u={urlParameters:{},groupId:"DEFAULT"};this.oModel.read(p,u)}this.submitRequests(l,n)}});return g});                                                                 