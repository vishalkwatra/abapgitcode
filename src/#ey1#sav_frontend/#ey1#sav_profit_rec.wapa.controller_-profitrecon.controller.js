sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/ListItem","sap/ui/generic/app/navigation/service/NavigationHandl+
er"],function(e,t,o,n,i,r,a,l,s){"use strict";const d="Local",u="Group";let c=[];return e.extend("ey.sap.fin.cs.profitrecon.controller.ProfitRecon",{formatter:o,onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("pr+
ofitrecon").attachMatched(this._onRouteMatched,this);this.bGlobalParamFetch=false;let e=new t;this.setModel(e,"viewConfigDataModel");this.oNavigationHandler=new s(this);this.oNavigationHandler.parseNavigation().done(this._onNavigationDone.bind(this));if(+
this.bGlobalParamFetch){this._fetchGlobalParameters()}this._fetchAdjustmentReasons()},_onRouteMatched:function(){this.getBusyDialog().close()},_getFilterData:function(){let e=this.getView(),t=e.byId("idConsUnit"),o=e.byId("idFiscalYearFilter"),n=e.byId("+
idIntentionComboBox"),i=e.byId("idCurrency"),r=e.byId("idPeriodFromInput"),a=e.byId("idPeriodToInput"),l=i.getSelectedItem().getProperty("additionalText"),s={ConsolidationUnit:t.getSelectedKey(),FiscalYear:o.getDateValue().getFullYear(),Intention:n.getSe+
lectedKey(),TaxIntention:parseInt(n.getSelectedItem().getBindingContext("intentionVHModel").getObject().TaxIntention,[10]),CurrOpenPeriod:parseInt(n.getSelectedItem().getBindingContext("intentionVHModel").getObject().CurrOpenPeriod,[10]),status:n.getSele+
ctedItem().getBindingContext("intentionVHModel").getObject().status,IntentDescription:n.getSelectedItem().getBindingContext("intentionVHModel").getObject().IntentDescription,Country:t.getSelectedItem().getBindingContext().getObject().Country,PeriodTo:a.g+
etValue(),PeriodFrom:r.getValue(),ConsolidationChartofAccounts:"",ConsolidationGroup:""};if(l===d){s.CurrencyType=d;s.LocalCurrencyType=d;s.LocalCurrency=i.getSelectedKey()}else{s.CurrencyType=u;s.GroupCurrencyType=u;s.GroupCurrency=i.getSelectedKey()}re+
turn s},_onNavigationDone:function(e,t,o){let n=this.getView();switch(o){case sap.ui.generic.app.navigation.service.NavType.initial:this.bGlobalParamFetch=true;break;case sap.ui.generic.app.navigation.service.NavType.iAppState:if(e.customData){this.bGlob+
alParamFetch=false;n.getModel("viewConfigDataModel").setData({globalParameters:e.customData});this._setFilterBarParameters(e.customData);this._fetchAllTabData()}break}},_fetchAdjustmentReasons:function(){let e=this.getOwnerComponent().getModel();let t="/+
xEY1xSAV_C_Recon_Adj_Reason";let o=this;e.read(t,{method:"GET",success:function(e,t){var n=o.getModel("viewConfigDataModel");n.getData().adjustmentReason=e.results;n.refresh()},error:function(e){if(parseInt(e.statusCode,[10])!==404){r.show(o.getI18nText(+
"adjustmentReasonsServiceCallError"))}}})},_fetchGlobalParameters:function(){var e=this;var t=this.getOwnerComponent().getModel();t.callFunction("/GlobalParameter",{method:"GET",success:function(t){e.getView().getModel("viewConfigDataModel").setData({glo+
balParameters:t});let o=e.getView().byId("idProfitReconSmartFilterBar");if(!o.getCurrentVariantId()){e._setFilterBarParameters(t)}},error:function(t){a.error(e.getI18nText("errorReadingGlobalParameters"))}})},_setFilterBarParameters:function(e){let t=thi+
s.getView(),n=t.byId("idCurrency");if(e.LocalCurrencyType&&e.LocalCurrency){n.setSelectedKey(e.LocalCurrency)}else{n.setSelectedKey(e.GroupCurrency)}if(e.ConsolidationUnit){t.byId("idConsUnit").setSelectedKey(e.ConsolidationUnit);n.setVisible(true);this.+
_fetchCurrencyData(true);this.fetchReconLedgerData()}if(e.FiscalYear){let o=new Date("06/06/".concat(e.FiscalYear.toString()));t.byId("idFiscalYearFilter").setDateValue(o)}if(e.Intention){t.byId("idIntentionComboBox").setSelectedKey(e.Intention)}var i=[e+
.ConsolidationUnit,e.FiscalYear];this._fetchIntentionStatus(i);if(e.PeriodFrom){t.byId("idPeriodFromInput").setValue(o.convertStringToInt(e.PeriodFrom))}if(e.PeriodTo){t.byId("idPeriodToInput").setValue(o.convertStringToInt(e.PeriodTo))}if(e.Consolidatio+
nUnit&&e.FiscalYear&&e.Intention){if(e.Intention){this._fetchValidTaxRates({ConsolidationUnit:e.ConsolidationUnit,PeriodTo:e.PeriodTo,FiscalYear:e.FiscalYear})}}},getI18nText:function(e){return this.getResourceBundle().getText(e)},_fetchCurrencyData:func+
tion(e){var o=this.getView(),a=o.byId("idConsUnit").getSelectedKey(),l=new n("ConsolidationUnit",i.EQ,a),s=this.getModel(),d=this,u=o.byId("idCurrType"),c=o.byId("idCurrency");u.setVisible(true);c.setBusy(true);s.read("/xEY1xSAV_C_CurrLocalGroupVH",{meth+
od:"GET",filters:[l],success:function(o,n){c.setBusy(false);d.setModel(new t(o),"currLocalGroupVHModel");if(!e&&o.results.length>0){c.setSelectedKey(o.results[0].Currency)}},error:function(e){c.setBusy(false);r.show(d.getI18nText("errorFetchingCurrency")+
)}})},_fetchIntentionStatus:function(e){let o=this.getModel();let r=e[0],l=e[1],s="/xEY1xSAV_C_IntentionsStatus(p_bunit='"+r+"')/Set",d=new n("Gjahr",i.EQ,l),u=this,c=u.getView(),g=c.byId("idIntentionComboBox");this.getBusyDialog().open();o.read(s,{metho+
d:"GET",sorters:[new sap.ui.model.Sorter("SerialNumber")],filters:[d],success:function(e,o){u.getBusyDialog().close();if(e.results.length===0){g.setSelectedKey("");g.setEnabled(false);a.error(u.getI18nText("IntentionNotYetOpen")+l);return}g.setEnabled(tr+
ue);let n=new t(e);u.getView().setModel(n,"intentionVHModel");let i=u.getView().getModel("viewConfigDataModel").getData().globalParameters;g.setSelectedKey(i.Intention);u._managePeriodFieldsEditability(false)},error:function(e){u.getBusyDialog().close();+
a.error(u.getI18nText("errorFetchingIntentionStatus"))}})},_managePeriodFieldsEditability:function(e){let t=this.getView(),n=t.byId("idIntentionComboBox"),i=n.getSelectedItem(),r=i.getBindingContext("intentionVHModel").getObject(),a=t.byId("idPeriodToInp+
ut"),l=o.convertStringToInt(r.TaxIntention);if(l!==o.convertStringToInt(0)){a.setEditable(false);a.setValue(o.convertStringToInt(r.PeriodTo));this._manageIntentionStatus(r)}else{a.setEditable(true);a.setValue(o.convertStringToInt(r.CurrOpenPeriod));let e+
=parseInt(a.getValue(),[10]);this._managePerodicIntentionStatus(e)}},_manageIntentionStatus:function(e){let t=this;if(e.status===this.getI18nText("YetToOpen")){t.getBusyDialog().close();a.error(e.IntentDescription+" "+t.getI18nText("ThisIntentionNotYetOp+
en")+e.Gjahr);return}else{return}},_managePerodicIntentionStatus:function(e){let t=this.getView().byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel").getObject(),o=parseInt(t.CurrOpenPeriod,[10]);if(e>o){this.getBusyDialog+
().close();a.error(this.getModel("i18n").getResourceBundle().getText("errorPeriodnotopen",[e,o]));return}else{return}},_getIntentionForManageTier:function(){let e=this.getView().byId("idPeriodToInput").getValue(),t;if(parseInt(e,[10])<=3){t="Q1"}else if(+
parseInt(e,[10])>3&&parseInt(e,[10])<=6){t="Q2"}else if(parseInt(e,[10])>6&&parseInt(e,[10])<=9){t="Q3"}else{t="TXP"}return t},_getDataFooter:function(e,t,o,n,i){let a={results:[]};if(t.length===o.length){for(var l=0;l<t.length;l++){let r=t[l],s=o[l],d=n+
[l],u=i[l],c=e.map(e=>parseInt(e[r],[10])!==parseInt("0.00",[10])),g={value:c.indexOf(true)===-1?"0.00":e[c.indexOf(true)][r],text:this.getI18nText(s),bLabelCheck:d,bLabelBold:u};a.results.push(g)}}else{r.show(this.getI18nText("errorFooterDetailsInvalid"+
))}return a},_fetchCnsldVersion:function(){let e=this.getModel(),o=this.getModel("viewConfigDataModel").getData(),n=o.globalParameters.ConsolidationGroup,i="/xEY1xSAV_C_Get_Version(p_congr='"+n+"')/Set",a=this,l=new t;sap.ui.getCore().setModel(l,"viewCnl+
VersionModel");e.read(i,{method:"GET",sorters:[new sap.ui.model.Sorter("FiscalYear")],success:function(e,t){sap.ui.getCore().getModel("viewCnlVersionModel").setData({ConsolidationVersion:e})},error:function(e){if(parseInt(e.statusCode,[10])!==404){r.show+
(a.getI18nText("GetConsolidationVersionServiceCallError"))}}})},_createJournalEntriesFilterData:function(e){let t=e.getSource().getCustomData(),n=t[t.map(e=>e.getProperty("key")).indexOf("modelName")].getValue();let i=e.getSource().getBindingContext(n);i+
f(!i.getProperty("GLAccount")){return}let r=this.getModel("viewConfigDataModel").getData(),a=this.getView().byId("idFiscalYearFilter"),l=a.getDateValue().getFullYear(),s=parseInt(this.getView().byId("idPeriodFromInput").getValue(),[10]),d=parseInt(this.g+
etView().byId("idPeriodToInput").getValue(),[10]),u=this.getView().byId("idConsUnit"),c=this.getView().byId("idCurrency"),g=this.getView().byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel").getObject(),T=o.convertStringTo+
Int(g.PeriodTo)===0?"":o.convertStringToInt(g.TaxIntention),C=[],h=[],f=r.globalParameters.ConsolidationGroup;let I=t[t.map(e=>e.getProperty("key")).indexOf("mappedLedger")].getValue();C.push(r.reconData[I]);for(let e of t){let t=e.getValue();let o=e.get+
Key();if(o==="mappedAdjReason"&&(t==="P&L"||t==="EQ"||t==="OP&L"||t==="OPERMANENT"||t==="OEQ"||t==="PERMANENT")){for(let e=0;e<r.adjustmentReason.length;e++){if(r.adjustmentReason[e].AdjustmentReason===t){h.push(r.adjustmentReason[e].TransType)}}continue+
}}let y=i.getProperty("GLAccount").padStart(10,"0");let b=e.getSource().getBindingInfo("text").parts,p=b[b.map(e=>e.path.indexOf("MainCurrency")!==0).indexOf(true)].path;let S=t[t.map(e=>e.getProperty("key")).indexOf("columnHeader")].getValue();return{Co+
nsolidationChartOfAccounts:r.globalParameters.ConsolidationChartofAccounts,FiscalYear:l,PeriodFrom:s||"1",PeriodTo:d||"12",ConsolidatioUnit:u.getSelectedKey(),ConsolidationLedger:C,Value:i.getProperty(p),Currency:i.getProperty("MainCurrency"),GLAccount:y+
,GLAccountDesc:i.getProperty("GLAccountMdmText"),ConsolidationVersion:"",SelectedIntention:T,ConsolidationGroup:"",PeriodMode:"PER",RefConsolidationDocumentType:"W",selectedCurrency:c.getSelectedKey(),SectionName:S,FinancialTransactionType:h,MapLedger:I,+
Congr:f}},_createPTAEntriesFilterData:function(e){let t=e.getSource().getBindingContext("PTATableModel"),o=this.getView().byId("idFiscalYearFilter"),n=o.getDateValue().getFullYear(),i=parseInt(this.getView().byId("idPeriodFromInput").getValue(),[10]),r=p+
arseInt(this.getView().byId("idPeriodToInput").getValue(),[10]),a=this.getView().byId("idConsUnit"),l=t.getProperty("GLAccount"),s=parseInt(this.getView().byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel").getObject().Tax+
Intention,[10]),d=s>12?s:"";let u=e.getSource().getBindingInfo("text").parts,c=u[u.map(e=>e.path.indexOf("MainCurrency")!==0).indexOf(true)].path;return{FiscalYear:n,PeriodFrom:i,PeriodTo:r,ConsolidationUnit:a.getSelectedKey(),Value:t.getProperty(c),Curr+
ency:t.getProperty("MainCurrency"),GLAccount:l,GLAccountDesc:t.getProperty("GLAccountMdmText"),SectionName:this.getI18nText("colHeaderPTAPmnt"),SelectedIntention:d}},_serviceCallPBT:function(e,o){let n=this.getModel(),i=this.getView().byId("idPBT"),a=thi+
s;i.setBusy(true);n.read(o,{method:"GET",filters:[e],success:function(e,o){i.setBusy(false);i.setModel(new t(e),"PBTTableModel");c.push(i.getModel("PBTTableModel"))},error:function(e){i.setBusy(false);r.show(a.getI18nText("GAAPIncLossCYServiceCallError")+
)}})},_serviceCallCYTE:function(e,o){let n=this.getModel(),i=this.getView().byId("idCYTA"),a=this;i.setBusy(true);n.read(o,{method:"GET",filters:[e],success:function(e,o){i.setBusy(false);i.setModel(new t(e),"CYTETableModel");i.setVisibleRowCount(i.getMo+
del("CYTETableModel").getData().results.length);c.push(i.getModel("CYTETableModel"))},error:function(e){i.setBusy(false);r.show(a.getI18nText("CYTEServiceCallError"))}})},_serviceCallCYTEFooter:function(e,o){let n=this.getModel(),i=this.getView().byId("i+
dCYTAFooter"),a=[],l=this;i.setBusy(true);n.read(o,{method:"GET",filters:[e],success:function(e,o){i.setBusy(false);if(e.results.length){a=l._getDataFooter(e.results,["TotalCYTE","GAAPIncomeLossBT","ReconciliationCheck"],["totalCYTELabel","GAAPIncLossBTL+
abel","RecCheckRepGaapLabel"],[false,false,true],[true,true,true])}i.setModel(new t(a),"CYTEFooterTableModel");c.push(i.getModel("CYTEFooterTableModel"))},error:function(e){i.setBusy(false);r.show(l.getI18nText("CYTEServiceCallError"))}})},_serviceCallG2+
S:function(e,o){let n=this.getModel(),i=this.getView().byId("idG2SA"),a=this;i.setBusy(true);n.read(o,{method:"GET",filters:[e],success:function(e,o){i.setBusy(false);i.setModel(new t(e),"G2STableModel");i.setVisibleRowCount(i.getModel("G2STableModel").g+
etData().results.length);c.push(i.getModel("G2STableModel"))},error:function(e){i.setBusy(false);r.show(a.getI18nText("G2SAServiceCallError"))}})},_serviceCallG2SFooter:function(e,o){let n=this.getModel(),i=this.getView().byId("idG2SAFooter"),a=[],l=this+
;i.setBusy(true);n.read(o,{method:"GET",filters:[e],success:function(e,o){i.setBusy(false);if(e.results.length){a=l._getDataFooter(e.results,["TotalG2S","STATIncomeLossBT","ReconciliationCheck"],["totalG2SALabel","STATIncLossBTLabel","RecCheckStatGaapLab+
el"],[false,false,true],[true,true,true])}i.setModel(new t(a),"G2SFooterTableModel");c.push(i.getModel("G2SFooterTableModel"))},error:function(e){i.setBusy(false);r.show(l.getI18nText("G2SAServiceCallError"))}})},_serviceCallS2T:function(e,o){let n=this.+
getModel(),i=this.getView().byId("idS2TA"),a=this;i.setBusy(true);n.read(o,{method:"GET",filters:[e],success:function(e,o){i.setBusy(false);i.setModel(new t(e),"S2TTableModel");i.setVisibleRowCount(i.getModel("S2TTableModel").getData().results.length);c.+
push(i.getModel("S2TTableModel"))},error:function(e){i.setBusy(false);r.show(a.getI18nText("S2TAServiceCallError"))}})},_serviceCallS2TFooter:function(e,o){let n=this.getModel(),i=this.getView().byId("idS2TAFooter"),a=[],l=this;i.setBusy(true);n.read(o,{+
method:"GET",filters:[e],success:function(e,o){i.setBusy(false);if(e.results.length){a=l._getDataFooter(e.results,["TotalS2T","FiscalIncomeLossBT","ReconciliationCheck"],["totalS2TALabel","fiscaalProfitLossBTLabel","RecCheckTaxLabel"],[false,false,true],+
[true,true,true])}i.setModel(new t(a),"S2TFooterTableModel");c.push(i.getModel("S2TFooterTableModel"))},error:function(e){i.setBusy(false);r.show(l.getI18nText("S2TAServiceCallError"))}})},_serviceCallPTA:function(e,o){let n=this.getModel(),i=this.getVie+
w().byId("idTablePTA"),a=this;i.setBusy(true);n.read(o,{method:"GET",filters:[e],success:function(e,o){i.setBusy(false);i.setModel(new t(e),"PTATableModel");i.setVisibleRowCount(e.results.length);c.push(i.getModel("PTATableModel"))},error:function(e){i.s+
etBusy(false);r.show(a.getI18nText("PTAServiceCallError"))}})},_serviceCallPTAFooter:function(e,o){let n=this.getModel(),i=this.getView().byId("idPTAFooter"),a=[],l=this;i.setBusy(true);n.read(o,{method:"GET",filters:[e],success:function(e,o){i.setBusy(f+
alse);if(e.results.length){a=l._getDataFooter(e.results,["TotalPTA"],["TotalPTALabel"],[false],[true])}i.setModel(new t(a),"PTAFooterTableModel");c.push(i.getModel("PTAFooterTableModel"))},error:function(e){i.setBusy(false);r.show(l.getI18nText("S2TAServ+
iceCallError"))}})},_serviceCallOTA:function(e,o){let n=this.getModel(),i=this.getView().byId("idTableOTA"),a=this;i.setBusy(true);n.read(o,{method:"GET",filters:[e],success:function(e,o){i.setBusy(false);i.setModel(new t(e),"OTATableModel");i.setVisible+
RowCount(e.results.length);c.push(i.getModel("OTATableModel"))},error:function(e){i.setBusy(false);r.show(a.getI18nText("OTAServiceCallError"))}})},_serviceCallOTAFooter:function(e,o){let n=this.getModel(),i=this.getView().byId("idOTAFooter"),a=[],l=this+
;i.setBusy(true);n.read(o,{method:"GET",filters:[e],success:function(e,o){i.setBusy(false);if(e.results.length){a=l._getDataFooter(e.results,["TotalOTA","TaxableIncLossBCL","TransferInOut","LossesUtilized","TaxableIncLoss"],["totalOTALabel","taxableIncLo+
ssBCLLabel","transferInOutLabel","lossesUtilizedLabel","taxableIncomeLossLabel"],[false,false,false,false,false],[true,true,false,false,true])}i.setModel(new t(a),"OTAFooterTableModel");c.push(i.getModel("OTAFooterTableModel"))},error:function(e){i.setBu+
sy(false);r.show(l.getI18nText("OTAFooterServiceCallError"))}})},_serviceCallCTE:function(e){let o=this.getModel(),n=this.getView().byId("idTableCTE"),i=this;n.setBusy(true);o.read(e,{method:"GET",sorters:[new sap.ui.model.Sorter("Sequence")],success:fun+
ction(e,o){n.setBusy(false);let i=e.results[e.results.map(e=>e.Sequence).indexOf("")];if(i){e.results.splice(e.results.map(e=>e.Sequence).indexOf(""),1);e.results.push(i)}n.setModel(new t(e),"CTETableModel");n.setVisibleRowCount(e.results.length);c.push(+
n.getModel("CTETableModel"))},error:function(e){n.setBusy(false);r.show(i.getI18nText("CTEServiceCallError"))}})},_serviceCallCTEStatutoryFooter:function(e,o){let n=this.getModel(),i=this.getView().byId("idCTEStatFooter"),a=this,l=[];i.setBusy(true);n.re+
ad(o,{method:"GET",sorters:[new sap.ui.model.Sorter("Sequence")],success:function(e,o){i.setBusy(false);let n=[],r=["labelTotalForCTECurrentYear","labelOtherTaxCreditsUtilized","labelTotalCurrentCorpIncTaxExp","labelCorpIncTaxReceivable","labelWitholding+
TaxCredit","labelCorpIncTaxPayCY","transferInOutLabel","labelSubTotal","labelCTA","labelCorpIncReceivable"],s=[false,false,false,false,false,false,false,false,false,false],d=[true,false,true,true,false,false,false,true,false,true];if(e.results.length>0){+
n=["SumTax","OtherTaxCredit","TotalCurrentCorpIncTaxExp","CorpIncTaxReceivable","WitholdingTaxCredit","CorpIncTaxPayCY","TransferInOut","SubTotal","CTA","CorpIncReceivable"]}else{e.results.push({iZeroEntry:"0.00"});n=["iZeroEntry","iZeroEntry","iZeroEntr+
y","iZeroEntry","iZeroEntry","iZeroEntry","iZeroEntry","iZeroEntry","iZeroEntry","iZeroEntry"]}l=a._getDataFooter(e.results,n,r,s,d);i.setModel(new t(l),"CTEFooterTableModel");c.push(i.getModel("CTEFooterTableModel"))},error:function(e){i.setBusy(false);+
r.show(a.getI18nText("CTEFooterServiceCallError"))}})},fetchReconLedgerData:function(){let e=this.getModel();let t=e.createKey("/xEY1xSAV_C_Recon_Ledger",{bunit:this.byId("idConsUnit").getSelectedKey()});let o=this;e.read(t,{method:"GET",success:function+
(e,t){var n=o.getModel("viewConfigDataModel");n.getData().reconData=e;n.refresh();o._fetchCnsldVersion()},error:function(e){if(parseInt(e.statusCode,[10])!==404){r.show(o.getI18nText("reconServiceCallError"))}}})},_fetchValidTaxRates:function(e){e=e?e:{}+
;let t=this,o=this.getView(),i=o.byId("idConsUnit").getSelectedKey(),l=o.byId("idIntentionComboBox").getSelectedItem(),s=o.byId("idFiscalYearFilter").getDateValue(),d=this.getModel();if(!l){return}let u=e.ConsolidationUnit?e.ConsolidationUnit:i,c=e.Perio+
dTo?e.PeriodTo:l.getBindingContext("intentionVHModel").getObject().PeriodTo,g=e.FiscalYear?e.FiscalYear:s.getFullYear();if(!u||!c||!g){return}let T="/xEY1xSAV_C_Fetch_Tax_Rates(p_toperiod='"+c+"',p_ryear='"+g+"')/Set";d.read(T,{method:"GET",filters:[new +
n("ConsolidationUnit","EQ",u)],success:function(e){if(e.results.length<1){a.warning(t.getI18nText("errorTaxRatesNotMaintained"))}},error:function(e){r.show(t.getI18nText("warningFetchingTaxRates"))}})},_fetchTiers:function(){let e=this,t=this.getView(),o+
=t.byId("idConsUnit").getSelectedItem().getBindingContext().getObject().Country,i=t.byId("idFiscalYearFilter").getDateValue().getFullYear(),l=t.byId("idIntentionComboBox").getSelectedKey(),s=this.getModel();if(l==="PER"){l=this._getIntentionForManageTier+
()}if(!o||!i||!l){return}let d="/xEY1xSAV_C_TIERS";s.read(d,{method:"GET",filters:[new n("CountryKey","EQ",o),new n("FiscalYear","EQ",i),new n("Intention","EQ",l)],success:function(t){if(t.results.length<1){a.warning(e.getI18nText("errorTiersNotMaintaine+
d"))}},error:function(t){r.show(e.getI18nText("warningFetchingTierss"))}})},_EmptyTableCall:function(){let e=this.getView();e.byId("idPBT").getModel("PBTTableModel").setData([]);e.byId("idCYTA").getModel("CYTETableModel").setData([]);e.byId("idCYTAFooter+
").getModel("CYTEFooterTableModel").setData([]);e.byId("idG2SA").getModel("G2STableModel").setData([]);e.byId("idG2SAFooter").getModel("G2SFooterTableModel").setData([]);e.byId("idS2TA").getModel("S2TTableModel").setData([]);e.byId("idS2TAFooter").getMod+
el("S2TFooterTableModel").setData([]);e.byId("idTablePTA").getModel("PTATableModel").setData([]);e.byId("idPTAFooter").getModel("PTAFooterTableModel").setData([]);e.byId("idTableOTA").getModel("OTATableModel").setData([]);e.byId("idOTAFooter").getModel("+
OTAFooterTableModel").setData([]);e.byId("idTableCTE").getModel("CTETableModel").setData([]);e.byId("idCTEStatFooter").getModel("CTEFooterTableModel").setData([])},_fetchAllTabData:function(){let e=this.getView(),t=e.getModel("viewConfigDataModel").getDa+
ta();if(!t.globalParameters||!t.globalParameters.ConsolidationChartofAccounts||!t.globalParameters.ConsolidationGroup){a.error(this.getI18nText("errorMaintainGlobalParameter"));return}let o=e.byId("idConsUnit"),r=o.getSelectedKey(),l=e.byId("idCurrency")+
,s=l.getSelectedKey(),d=l.getSelectedItem()?l.getSelectedItem().getProperty("additionalText"):t.globalParameters.CurrencyType,u=o.getSelectedItem()?o.getSelectedItem().getBindingContext().getObject().Country:t.globalParameters.Country,g=e.byId("idIntenti+
onComboBox").getSelectedKey(),T=e.byId("idFiscalYearFilter"),C=T.getDateValue().getFullYear(),h=e.byId("idPeriodToInput"),f=parseInt(h.getValue(),[10]),I;if(e.byId("idIntentionComboBox").getEnabled()===false){a.error(this.getI18nText("IntentionNotYetOpen+
")+C);if(c.length>0){this._EmptyTableCall()}return}let y=e.byId("idIntentionComboBox").getSelectedItem()?parseInt(e.byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel").getObject().CurrOpenPeriod,[10]):t.globalParameters.Cu+
rrOpenPeriod,b=e.byId("idIntentionComboBox").getSelectedItem()?e.byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel").getObject().status:t.globalParameters.status,p=e.byId("idIntentionComboBox").getSelectedItem()?e.byId("id+
IntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel").getObject().IntentDescription:t.globalParameters.IntentDescription,S=e.byId("idIntentionComboBox").getSelectedItem()?parseInt(e.byId("idIntentionComboBox").getSelectedItem().getB+
indingContext("intentionVHModel").getObject().Gjahr,[10]):t.globalParameters.FiscalYear;if(b===this.getI18nText("YetToOpen")){this.getBusyDialog().close();a.error(p+" "+this.getI18nText("ThisIntentionNotYetOpen")+S);if(c.length>0){this._EmptyTableCall()}+
return}if(f>y){this.getBusyDialog().close();a.error(this.getModel("i18n").getResourceBundle().getText("errorPeriodnotopen",[f,y]));if(c.length>0){this._EmptyTableCall()}return}let _=e.byId("idIntentionComboBox").getSelectedItem()?parseInt(e.byId("idInten+
tionComboBox").getSelectedItem().getBindingContext("intentionVHModel").getObject().TaxIntention,[10]):t.globalParameters.TaxIntention,m=_>100?_:"",x=new n({filters:[new n("ConsolidationUnit",i.EQ,r),new n("ChartOfAccounts",i.EQ,"CANA"),new n("Consolidati+
onChartofAccounts",i.EQ,t.globalParameters.ConsolidationChartofAccounts),new n("MainCurrency",i.EQ,s)],and:true});I=x;if(g==="PER"){g=this._getIntentionForManageTier()}c=[];let M="/xEY1xSAV_C_PR_ProfitBeforeTax(p_toperiod='"+f+"',p_ryear='"+C+"',p_taxint+
ention='"+m+"')/Set";this._serviceCallPBT(I,M);let P="/xEY1xSAV_C_PR_CYTE_Mvmnt(p_toperiod='"+f+"',p_ryear='"+C+"',p_taxintention='"+m+"')/Set";this._serviceCallCYTE(I,P);let V="/xEY1xSAV_C_PR_CYTE_Details(p_toperiod='"+f+"',p_ryear='"+C+"',p_taxintentio+
n='"+m+"')/Set";this._serviceCallCYTEFooter(I,V);let E="/xEY1xSAV_C_PR_G2S_Mvmnt(p_toperiod='"+f+"',p_ryear='"+C+"',p_taxintention='"+m+"')/Set";this._serviceCallG2S(I,E);let F="/xEY1xSAV_C_PR_G2S_Details(p_toperiod='"+f+"',p_ryear='"+C+"',p_taxintention+
='"+m+"')/Set";this._serviceCallG2SFooter(I,F);let w="/xEY1xSAV_C_PR_S2T_Mvmnt(p_toperiod='"+f+"',p_ryear='"+C+"',p_taxintention='"+m+"')/Set";this._serviceCallS2T(I,w);let B="/xEY1xSAV_C_PR_S2T_Details(p_toperiod='"+f+"',p_ryear='"+C+"',p_taxintention='+
"+m+"')/Set";this._serviceCallS2TFooter(I,B);let A=_>12?_:"";let v="/xEY1xSAV_C_PR_PTA_Mvmnt(p_toperiod='"+f+"',p_ryear='"+C+"',p_taxintention='"+m+"')/Set";this._serviceCallPTA(I,v);let D="/xEY1xSAV_C_PR_PTA_Details(p_toperiod='"+f+"',p_ryear='"+C+"',p_+
taxintention='"+m+"')/Set";this._serviceCallPTAFooter(I,D);let Y="/xEY1xSAV_C_PR_OTA_Mvmnts(p_toperiod='"+f+"',p_ryear='"+C+"',p_taxintention='"+m+"')/Set";this._serviceCallOTA(I,Y);let G="/xEY1xSAV_C_PR_OTA_Details(p_toperiod='"+f+"',p_ryear='"+C+"',p_t+
axintention='"+m+"')/Set";this._serviceCallOTAFooter(I,G);let O="/xEY1xSAV_C_PR_CTE_Details(p_cntry='"+u+"',p_ryear='"+C+"',p_toperiod='"+f+"',p_taxintention='"+m+"',p_currtype='"+d+"',p_intention='"+g+"')/Set";this._serviceCallCTE(O);let R="/xEY1xSAV_C_+
PR_CTE_Total(p_cntry='"+u+"',p_ryear='"+C+"',p_toperiod='"+f+"',p_taxintention='"+m+"',p_currtype='"+d+"',p_intention='"+g+"')/Set";this._serviceCallCTEStatutoryFooter([],R)},onPressNavtoManageTier:function(){let e=this.getView(),t=this,o=this.getView().+
getModel("viewConfigDataModel").getData().globalParameters,n=e.byId("idConsUnit"),i=n.getSelectedItem(),r,l,s,d,u=e.byId("idFiscalYearFilter"),c=u.getDateValue(),g=e.byId("idIntentionComboBox"),T=g.getSelectedKey(),C=this._getFilterData();C.Consolidation+
ChartofAccounts=o.ConsolidationChartofAccounts;C.ConsolidationGroup=o.ConsolidationGroup;if(T==="PER"){T=this._getIntentionForManageTier()}if(i){d=n.getSelectedKey();r=i.getBindingContext().getObject().Country}else{d="";r=""}if(c){l=c.getFullYear().toStr+
ing()}else{l=""}if(T){s=T}else{s=""}let h={ConsolidationUnit:d,FiscalYear:l,Intention:s,Country:r};var f={customData:C};var I=function(e){a.error(t.getI18nText("navigationError"))};this.oNavigationHandler.navigate("ManageTier","manage",h,f,I)},onSearchBu+
ttonPressed:function(e){this._fetchAllTabData();this._fetchTiers()},onPressJournalEntriesDetail:function(e){var o=this._createJournalEntriesFilterData(e);if(!o){return}var n=new t(o);this.getOwnerComponent().setModel(n,"JournalEntryData");this.oRouter.na+
vTo("JournalEntries")},onPressPTAEntriesDetail:function(e){var o=this._createPTAEntriesFilterData(e);if(o.GLAccount===this.getI18nText("BalanceCheckSumLabel")){return}var n=new t(o);this.getOwnerComponent().setModel(n,"PTAEntryConfigData");this.oRouter.n+
avTo("PTAEntries")},onBeforeVariantSaveFilterBar:function(e){let t=this.getView(),o=t.byId("idProfitReconSmartFilterBar"),n=t.byId("idConsUnit"),i=t.byId("idFiscalYearFilter"),r=t.byId("idIntentionComboBox"),a=t.byId("idCurrency"),l=t.byId("idPeriodToInp+
ut");o.setFilterData({_CUSTOM:{ConsolidationUnit:n.getSelectedKey(),FiscalYear:i.getValue(),Intention:r.getSelectedKey(),CurrType:a.getSelectedKey(),PeriodTo:l.getValue(),VariantID:o.getCurrentVariantId()}})},onAfterVariantLoadFilterBar:function(e){var t+
=this.getView();var n=t.byId("idProfitReconSmartFilterBar");var i=t.byId("idConsUnit");var r=t.byId("idFiscalYearFilter");let a=t.byId("idIntentionComboBox");var l=t.byId("idCurrency");let s=this.getView().byId("idPeriodToInput");var d=n.getFilterData()[+
"_CUSTOM"];i.setSelectedKey(d.ConsolidationUnit);r.setValue(d.FiscalYear);a.setSelectedKey(d.Intention);l.setSelectedKey(d.CurrType);s.setValue(o.convertStringToInt(d.PeriodTo));if(d.ConsolidationUnit){this.fetchReconLedgerData()}if(d.CurrType){l.setVisi+
ble(true);this._fetchCurrencyData(true)}if(d.ConsolidationUnit&&d.FiscalYear&&d.Intention){this._fetchValidTaxRates({ConsolidationUnit:d.ConsolidationUnit,PeriodTo:d.PeriodTo,FiscalYear:d.FiscalYear.getFullYear()})}let u=[d.ConsolidationUnit,d.FiscalYear+
.getFullYear()];this._fetchIntentionStatus(u)},onChangeDatePickerFilter:function(e){let t=e.getSource(),o=this.getModel("viewConfigDataModel").getData(),n=o.globalParameters.ConsolidationUnit;if(e.getParameter("valid")){t.setValueState("None");let e=t.ge+
tDateValue().getFullYear(),o=[n,e];this._fetchIntentionStatus(o)}else{t.setValueState("Error")}if(e.getSource().getValue()){this._fetchValidTaxRates()}},onConsUnitChange:function(e){this._fetchCurrencyData(false);this.fetchReconLedgerData();if(e.getSourc+
e().getValue()){this._fetchValidTaxRates()}},onChangeIntentionComboBox:function(e){let t=this.getView(),o=t.byId("idIntentionComboBox"),n=o.getSelectedItem();if(!n){o.setSelectedItem("");return}this._managePeriodFieldsEditability(true);if(e.getSource().g+
etValue()){this._fetchValidTaxRates()}},onLiveChangePeriodTo:function(){let e=this.getView().byId("idPeriodToInput");let t=parseInt(this.getView().byId("idPeriodFromInput").getValue(),[10]);let o=parseInt(e.getValue(),[10]);e.setValueState("None");if(isN+
aN(o)){return}if(o<t){e.setValueState("Error");e.setValueStateText(this.getI18nText("periodToLessThanPeriodFromErrorMsg"));return}else if(o>"012"){e.setValueState("Error");e.setValueStateText(this.getI18nText("periodToGreaterThanLastPeriod"));return}else+
{this._managePerodicIntentionStatus(o)}}})});                                                                                                                                                                                                                  