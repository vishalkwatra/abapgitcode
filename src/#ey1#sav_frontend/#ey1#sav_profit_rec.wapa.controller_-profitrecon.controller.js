sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/ListItem","sap/ui/generic/app/navigation/service/NavigationHandl+
er"],function(e,t,o,i,n,r,a,l,s){"use strict";const d="Local",u="Group";let c=[];return e.extend("ey.sap.fin.cs.profitrecon.controller.ProfitRecon",{formatter:o,onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("pr+
ofitrecon").attachMatched(this._onRouteMatched,this);this.bGlobalParamFetch=false;let e=new t;this.setModel(e,"viewConfigDataModel");this.oNavigationHandler=new s(this);this.oNavigationHandler.parseNavigation().done(this._onNavigationDone.bind(this));if(+
this.bGlobalParamFetch){this._fetchGlobalParameters()}this._fetchAdjustmentReasons()},_onRouteMatched:function(){this.getBusyDialog().close()},_getFilterData:function(){let e=this.getView(),t=e.byId("idConsUnit"),o=e.byId("idFiscalYearFilter"),i=e.byId("+
idIntentionComboBox"),n=e.byId("idCurrency"),r=e.byId("idPeriodFromInput"),a=e.byId("idPeriodToInput"),l=n.getSelectedItem().getProperty("additionalText"),s={ConsolidationUnit:t.getSelectedKey(),FiscalYear:o.getDateValue().getFullYear(),Intention:i.getSe+
lectedKey(),TaxIntention:parseInt(i.getSelectedItem().getBindingContext("intentionVHModel").getObject().TaxIntention,[10]),CurrOpenPeriod:parseInt(i.getSelectedItem().getBindingContext("intentionVHModel").getObject().CurrOpenPeriod,[10]),status:i.getSele+
ctedItem().getBindingContext("intentionVHModel").getObject().status,IntentDescription:i.getSelectedItem().getBindingContext("intentionVHModel").getObject().IntentDescription,Country:t.getSelectedItem().getBindingContext().getObject().Country,PeriodTo:a.g+
etValue(),PeriodFrom:r.getValue(),ConsolidationChartofAccounts:"",ConsolidationGroup:""};if(l===d){s.CurrencyType=d;s.LocalCurrencyType=d;s.LocalCurrency=n.getSelectedKey()}else{s.CurrencyType=u;s.GroupCurrencyType=u;s.GroupCurrency=n.getSelectedKey()}re+
turn s},_onNavigationDone:function(e,t,o){let i=this.getView();switch(o){case sap.ui.generic.app.navigation.service.NavType.initial:this.bGlobalParamFetch=true;break;case sap.ui.generic.app.navigation.service.NavType.iAppState:if(e.customData){this.bGlob+
alParamFetch=false;i.getModel("viewConfigDataModel").setData({globalParameters:e.customData});this._setFilterBarParameters(e.customData);this._fetchAllTabData()}break}},_fetchAdjustmentReasons:function(){let e=this.getOwnerComponent().getModel();let t="/+
xEY1xSAV_C_Recon_Adj_Reason";let o=this;e.read(t,{method:"GET",success:function(e,t){var i=o.getModel("viewConfigDataModel");i.getData().adjustmentReason=e.results;i.refresh()},error:function(e){if(parseInt(e.statusCode,[10])!==404){r.show(o.getI18nText(+
"adjustmentReasonsServiceCallError"))}}})},_fetchGlobalParameters:function(){var e=this;var t=this.getOwnerComponent().getModel();var o={Default:true};t.callFunction("/GlobalParameter",{method:"GET",urlParameters:o,success:function(t){e.getView().getMode+
l("viewConfigDataModel").setData({globalParameters:t});let o=e.getView().byId("idProfitReconSmartFilterBar");if(!o.getCurrentVariantId()){e._setFilterBarParameters(t)}},error:function(t){a.error(e.getI18nText("errorReadingGlobalParameters"))}})},_setFilt+
erBarParameters:function(e){let t=this.getView(),i=t.byId("idCurrency");if(e.LocalCurrencyType&&e.LocalCurrency){i.setSelectedKey(e.LocalCurrency)}else{i.setSelectedKey(e.GroupCurrency)}if(e.ConsolidationUnit){t.byId("idConsUnit").setSelectedKey(e.Consol+
idationUnit);i.setVisible(true);this._fetchCurrencyData(true);this.fetchReconLedgerData()}if(e.FiscalYear){let o=new Date("06/06/".concat(e.FiscalYear.toString()));t.byId("idFiscalYearFilter").setDateValue(o)}if(e.Intention){t.byId("idIntentionComboBox")+
.setSelectedKey(e.Intention)}var n=[e.ConsolidationUnit,e.FiscalYear];this._fetchIntentionStatus(n);if(e.PeriodFrom){t.byId("idPeriodFromInput").setValue(o.convertStringToInt(e.PeriodFrom))}if(e.PeriodTo){t.byId("idPeriodToInput").setValue(o.convertStrin+
gToInt(e.PeriodTo))}if(e.ConsolidationUnit&&e.FiscalYear&&e.Intention){if(e.Intention){this._fetchValidTaxRates({ConsolidationUnit:e.ConsolidationUnit,PeriodTo:e.PeriodTo,FiscalYear:e.FiscalYear})}}},getI18nText:function(e){return this.getResourceBundle(+
).getText(e)},_fetchCurrencyData:function(e){var o=this.getView(),a=o.byId("idConsUnit").getSelectedKey(),l=new i("ConsolidationUnit",n.EQ,a),s=this.getModel(),d=this,u=o.byId("idCurrType"),c=o.byId("idCurrency");u.setVisible(true);c.setBusy(true);s.read+
("/xEY1xSAV_C_CurrLocalGroupVH",{method:"GET",filters:[l],success:function(o,i){c.setBusy(false);d.setModel(new t(o),"currLocalGroupVHModel");if(!e&&o.results.length>0){c.setSelectedKey(o.results[0].Currency)}},error:function(e){c.setBusy(false);r.show(d+
.getI18nText("errorFetchingCurrency"))}})},_fetchIntentionStatus:function(e){let o=this.getModel();let r=e[0],l=e[1],s="/xEY1xSAV_C_IntentionsStatus(p_bunit='"+r+"')/Set",d=new i("Gjahr",n.EQ,l),u=this,c=u.getView(),g=c.byId("idIntentionComboBox");this.g+
etBusyDialog().open();o.read(s,{method:"GET",sorters:[new sap.ui.model.Sorter("SerialNumber")],filters:[d],success:function(e,o){u.getBusyDialog().close();if(e.results.length===0){g.setSelectedKey("");g.setEnabled(false);a.error(u.getI18nText("IntentionN+
otYetOpen")+l);return}g.setEnabled(true);let i=new t(e);u.getView().setModel(i,"intentionVHModel");let n=u.getView().getModel("viewConfigDataModel").getData().globalParameters;g.setSelectedKey(n.Intention);g.setSelectedKey("");for(let t=0;t<e.results.len+
gth;t++){if(e.results[t].isSelected==="X"){g.setSelectedKey(e.results[t].Intention)}}if(g.getSelectedKey()===""){for(let t=0;t<e.results.length;t++){if(e.results[t].status==="Open"){g.setSelectedKey(e.results[t].Intention)}}}u._managePeriodFieldsEditabil+
ity(false)},error:function(e){u.getBusyDialog().close();a.error(u.getI18nText("errorFetchingIntentionStatus"))}})},_managePeriodFieldsEditability:function(e){let t=this.getView(),i=t.byId("idIntentionComboBox"),n=i.getSelectedItem(),r=n.getBindingContext+
("intentionVHModel").getObject(),a=t.byId("idPeriodToInput"),l=o.convertStringToInt(r.TaxIntention);if(l!==o.convertStringToInt(0)){a.setEditable(false);a.setValue(o.convertStringToInt(r.PeriodTo));this._manageIntentionStatus(r)}else{a.setEditable(true);+
a.setValue(o.convertStringToInt(r.CurrOpenPeriod));let e=parseInt(a.getValue(),[10]);this._managePerodicIntentionStatus(e)}},_manageIntentionStatus:function(e){let t=this;if(e.status===this.getI18nText("YetToOpen")){t.getBusyDialog().close();a.error(this+
.getModel("i18n").getResourceBundle().getText("ThisIntentionNotYetOpen",[e.IntentDescription,e.Gjahr]));return}else{return}},_managePerodicIntentionStatus:function(e){let t=this.getView().byId("idIntentionComboBox").getSelectedItem().getBindingContext("i+
ntentionVHModel").getObject(),o=parseInt(t.CurrOpenPeriod,[10]);if(e>o){this.getBusyDialog().close();a.error(this.getModel("i18n").getResourceBundle().getText("errorPeriodnotopen",[e,o]));return}else{return}},_getIntentionForManageTier:function(){let e=t+
his.getView().byId("idPeriodToInput").getValue(),t;if(parseInt(e,[10])<=3){t="Q1"}else if(parseInt(e,[10])>3&&parseInt(e,[10])<=6){t="Q2"}else if(parseInt(e,[10])>6&&parseInt(e,[10])<=9){t="Q3"}else{t="TXP"}return t},_getDataFooter:function(e,t,o,i,n){le+
t a={results:[]};if(t.length===o.length){for(var l=0;l<t.length;l++){let r=t[l],s=o[l],d=i[l],u=n[l],c=e.map(e=>parseInt(e[r],[10])!==parseInt("0.00",[10])),g={value:c.indexOf(true)===-1?"0.00":e[c.indexOf(true)][r],text:this.getI18nText(s),bLabelCheck:d+
,bLabelBold:u};a.results.push(g)}}else{r.show(this.getI18nText("errorFooterDetailsInvalid"))}return a},_fetchCnsldVersion:function(){let e=this.getModel(),o=this.getModel("viewConfigDataModel").getData(),i=o.globalParameters.ConsolidationGroup,n="/xEY1xS+
AV_C_Get_Version(p_congr='"+i+"')/Set",a=this,l=new t;sap.ui.getCore().setModel(l,"viewCnlVersionModel");e.read(n,{method:"GET",sorters:[new sap.ui.model.Sorter("FiscalYear")],success:function(e,t){sap.ui.getCore().getModel("viewCnlVersionModel").setData+
({ConsolidationVersion:e})},error:function(e){if(parseInt(e.statusCode,[10])!==404){r.show(a.getI18nText("GetConsolidationVersionServiceCallError"))}}})},_createJournalEntriesFilterData:function(e){let t=e.getSource().getCustomData(),i=t[t.map(e=>e.getPr+
operty("key")).indexOf("modelName")].getValue();let n=e.getSource().getBindingContext(i);if(!n.getProperty("GLAccount")){return}let r=this.getModel("viewConfigDataModel").getData(),a=this.getView().byId("idFiscalYearFilter"),l=a.getDateValue().getFullYea+
r(),s=parseInt(this.getView().byId("idPeriodFromInput").getValue(),[10]),d=parseInt(this.getView().byId("idPeriodToInput").getValue(),[10]),u=this.getView().byId("idConsUnit"),c=this.getView().byId("idCurrency"),g=this.getView().byId("idIntentionComboBox+
").getSelectedItem().getBindingContext("intentionVHModel").getObject(),T=o.convertStringToInt(g.PeriodTo)===0?"":o.convertStringToInt(g.TaxIntention),h=[],C=[],f=r.globalParameters.ConsolidationGroup;let I=t[t.map(e=>e.getProperty("key")).indexOf("mapped+
Ledger")].getValue();h.push(r.reconData[I]);for(let e of t){let t=e.getValue();let o=e.getKey();if(o==="mappedAdjReason"&&(t==="P&L"||t==="EQ"||t==="OP&L"||t==="OPERMANENT"||t==="OEQ"||t==="PERMANENT")){for(let e=0;e<r.adjustmentReason.length;e++){if(r.a+
djustmentReason[e].AdjustmentReason===t){C.push(r.adjustmentReason[e].TransType)}}continue}}let y=n.getProperty("GLAccount").padStart(10,"0");let b=e.getSource().getBindingInfo("text").parts,p=b[b.map(e=>e.path.indexOf("MainCurrency")!==0).indexOf(true)]+
.path;let S=t[t.map(e=>e.getProperty("key")).indexOf("columnHeader")].getValue();return{ConsolidationChartOfAccounts:r.globalParameters.ConsolidationChartofAccounts,FiscalYear:l,PeriodFrom:s||"1",PeriodTo:d||"12",ConsolidatioUnit:u.getSelectedKey(),Conso+
lidationLedger:h,Value:n.getProperty(p),Currency:n.getProperty("MainCurrency"),GLAccount:y,GLAccountDesc:n.getProperty("GLAccountMdmText"),ConsolidationVersion:"",SelectedIntention:T,ConsolidationGroup:"",PeriodMode:"PER",RefConsolidationDocumentType:"W"+
,selectedCurrency:c.getSelectedKey(),SectionName:S,FinancialTransactionType:C,MapLedger:I,Congr:f}},_createPTAEntriesFilterData:function(e){let t=e.getSource().getBindingContext("PTATableModel"),o=this.getView().byId("idFiscalYearFilter"),i=o.getDateValu+
e().getFullYear(),n=parseInt(this.getView().byId("idPeriodFromInput").getValue(),[10]),r=parseInt(this.getView().byId("idPeriodToInput").getValue(),[10]),a=this.getView().byId("idConsUnit"),l=t.getProperty("GLAccount"),s=parseInt(this.getView().byId("idI+
ntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel").getObject().TaxIntention,[10]),d=s>12?s:"";let u=e.getSource().getBindingInfo("text").parts,c=u[u.map(e=>e.path.indexOf("MainCurrency")!==0).indexOf(true)].path;return{FiscalYear:+
i,PeriodFrom:n,PeriodTo:r,ConsolidationUnit:a.getSelectedKey(),Value:t.getProperty(c),Currency:t.getProperty("MainCurrency"),GLAccount:l,GLAccountDesc:t.getProperty("GLAccountMdmText"),SectionName:this.getI18nText("colHeaderPTAPmnt"),SelectedIntention:d}+
},_serviceCallPBT:function(e,o){let i=this.getModel(),n=this.getView().byId("idPBT"),a=this;n.setBusy(true);i.read(o,{method:"GET",filters:[e],success:function(e,o){n.setBusy(false);n.setModel(new t(e),"PBTTableModel");c.push(n.getModel("PBTTableModel"))+
},error:function(e){n.setBusy(false);r.show(a.getI18nText("GAAPIncLossCYServiceCallError"))}})},_serviceCallCYTE:function(e,o){let i=this.getModel(),n=this.getView().byId("idCYTA"),a=this;n.setBusy(true);i.read(o,{method:"GET",filters:[e],success:functio+
n(e,o){n.setBusy(false);n.setModel(new t(e),"CYTETableModel");n.setVisibleRowCount(n.getModel("CYTETableModel").getData().results.length);c.push(n.getModel("CYTETableModel"))},error:function(e){n.setBusy(false);r.show(a.getI18nText("CYTEServiceCallError"+
))}})},_serviceCallCYTEFooter:function(e,o){let i=this.getModel(),n=this.getView().byId("idCYTAFooter"),a=[],l=this;n.setBusy(true);i.read(o,{method:"GET",filters:[e],success:function(e,o){n.setBusy(false);if(e.results.length){a=l._getDataFooter(e.result+
s,["TotalCYTE","GAAPIncomeLossBT","ReconciliationCheck"],["totalCYTELabel","GAAPIncLossBTLabel","RecCheckRepGaapLabel"],[false,false,true],[true,true,true])}n.setModel(new t(a),"CYTEFooterTableModel");c.push(n.getModel("CYTEFooterTableModel"))},error:fun+
ction(e){n.setBusy(false);r.show(l.getI18nText("CYTEServiceCallError"))}})},_serviceCallG2S:function(e,o){let i=this.getModel(),n=this.getView().byId("idG2SA"),a=this;n.setBusy(true);i.read(o,{method:"GET",filters:[e],success:function(e,o){n.setBusy(fals+
e);n.setModel(new t(e),"G2STableModel");n.setVisibleRowCount(n.getModel("G2STableModel").getData().results.length);c.push(n.getModel("G2STableModel"))},error:function(e){n.setBusy(false);r.show(a.getI18nText("G2SAServiceCallError"))}})},_serviceCallG2SFo+
oter:function(e,o){let i=this.getModel(),n=this.getView().byId("idG2SAFooter"),a=[],l=this;n.setBusy(true);i.read(o,{method:"GET",filters:[e],success:function(e,o){n.setBusy(false);if(e.results.length){a=l._getDataFooter(e.results,["TotalG2S","STATIncome+
LossBT","ReconciliationCheck"],["totalG2SALabel","STATIncLossBTLabel","RecCheckStatGaapLabel"],[false,false,true],[true,true,true])}n.setModel(new t(a),"G2SFooterTableModel");c.push(n.getModel("G2SFooterTableModel"))},error:function(e){n.setBusy(false);r+
.show(l.getI18nText("G2SAServiceCallError"))}})},_serviceCallS2T:function(e,o){let i=this.getModel(),n=this.getView().byId("idS2TA"),a=this;n.setBusy(true);i.read(o,{method:"GET",filters:[e],success:function(e,o){n.setBusy(false);n.setModel(new t(e),"S2T+
TableModel");n.setVisibleRowCount(n.getModel("S2TTableModel").getData().results.length);c.push(n.getModel("S2TTableModel"))},error:function(e){n.setBusy(false);r.show(a.getI18nText("S2TAServiceCallError"))}})},_serviceCallS2TFooter:function(e,o){let i=th+
is.getModel(),n=this.getView().byId("idS2TAFooter"),a=[],l=this;n.setBusy(true);i.read(o,{method:"GET",filters:[e],success:function(e,o){n.setBusy(false);if(e.results.length){a=l._getDataFooter(e.results,["TotalS2T","FiscalIncomeLossBT","ReconciliationCh+
eck"],["totalS2TALabel","fiscaalProfitLossBTLabel","RecCheckTaxLabel"],[false,false,true],[true,true,true])}n.setModel(new t(a),"S2TFooterTableModel");c.push(n.getModel("S2TFooterTableModel"))},error:function(e){n.setBusy(false);r.show(l.getI18nText("S2T+
AServiceCallError"))}})},_serviceCallPTA:function(e,o){let i=this.getModel(),n=this.getView().byId("idTablePTA"),a=this;n.setBusy(true);i.read(o,{method:"GET",filters:[e],success:function(e,o){n.setBusy(false);n.setModel(new t(e),"PTATableModel");n.setVi+
sibleRowCount(e.results.length);c.push(n.getModel("PTATableModel"))},error:function(e){n.setBusy(false);r.show(a.getI18nText("PTAServiceCallError"))}})},_serviceCallPTAFooter:function(e,o){let i=this.getModel(),n=this.getView().byId("idPTAFooter"),a=[],l+
=this;n.setBusy(true);i.read(o,{method:"GET",filters:[e],success:function(e,o){n.setBusy(false);if(e.results.length){a=l._getDataFooter(e.results,["TotalPTA"],["TotalPTALabel"],[false],[true])}n.setModel(new t(a),"PTAFooterTableModel");c.push(n.getModel(+
"PTAFooterTableModel"))},error:function(e){n.setBusy(false);r.show(l.getI18nText("S2TAServiceCallError"))}})},_serviceCallOTA:function(e,o){let i=this.getModel(),n=this.getView().byId("idTableOTA"),a=this;n.setBusy(true);i.read(o,{method:"GET",filters:[e+
],success:function(e,o){n.setBusy(false);n.setModel(new t(e),"OTATableModel");n.setVisibleRowCount(e.results.length);c.push(n.getModel("OTATableModel"))},error:function(e){n.setBusy(false);r.show(a.getI18nText("OTAServiceCallError"))}})},_serviceCallOTAF+
ooter:function(e,o){let i=this.getModel(),n=this.getView().byId("idOTAFooter"),a=[],l=this;n.setBusy(true);i.read(o,{method:"GET",filters:[e],success:function(e,o){n.setBusy(false);if(e.results.length){a=l._getDataFooter(e.results,["TotalOTA","TaxableInc+
LossBCL","TransferInOut","LossesUtilized","TaxableIncLoss"],["totalOTALabel","taxableIncLossBCLLabel","transferInOutLabel","lossesUtilizedLabel","taxableIncomeLossLabel"],[false,false,false,false,false],[true,true,false,false,true])}n.setModel(new t(a),"+
OTAFooterTableModel");c.push(n.getModel("OTAFooterTableModel"))},error:function(e){n.setBusy(false);r.show(l.getI18nText("OTAFooterServiceCallError"))}})},_serviceCallCTE:function(e){let o=this.getModel(),i=this.getView().byId("idTableCTE"),n=this;i.setB+
usy(true);o.read(e,{method:"GET",sorters:[new sap.ui.model.Sorter("Sequence")],success:function(e,o){i.setBusy(false);let n=e.results[e.results.map(e=>e.Sequence).indexOf("")];if(n){e.results.splice(e.results.map(e=>e.Sequence).indexOf(""),1);e.results.p+
ush(n)}i.setModel(new t(e),"CTETableModel");i.setVisibleRowCount(e.results.length);c.push(i.getModel("CTETableModel"))},error:function(e){i.setBusy(false);r.show(n.getI18nText("CTEServiceCallError"))}})},_serviceCallCTEStatutoryFooter:function(e,o){let i+
=this.getModel(),n=this.getView().byId("idCTEStatFooter"),a=this,l=[];n.setBusy(true);i.read(o,{method:"GET",sorters:[new sap.ui.model.Sorter("Sequence")],success:function(e,o){n.setBusy(false);let i=[],r=["labelTotalForCTECurrentYear","labelOtherTaxCred+
itsUtilized","labelTotalCurrentCorpIncTaxExp","labelCorpIncTaxReceivable","labelWitholdingTaxCredit","labelCorpIncTaxPayCY","transferInOutLabel","labelSubTotal","labelCTA","labelCorpIncReceivable"],s=[false,false,false,false,false,false,false,false,false+
,false],d=[true,false,true,true,false,false,false,true,false,true];if(e.results.length>0){i=["SumTax","OtherTaxCredit","TotalCurrentCorpIncTaxExp","CorpIncTaxReceivable","WitholdingTaxCredit","CorpIncTaxPayCY","TransferInOut","SubTotal","CTA","CorpIncRec+
eivable"]}else{e.results.push({iZeroEntry:"0.00"});i=["iZeroEntry","iZeroEntry","iZeroEntry","iZeroEntry","iZeroEntry","iZeroEntry","iZeroEntry","iZeroEntry","iZeroEntry","iZeroEntry"]}l=a._getDataFooter(e.results,i,r,s,d);n.setModel(new t(l),"CTEFooterT+
ableModel");c.push(n.getModel("CTEFooterTableModel"))},error:function(e){n.setBusy(false);r.show(a.getI18nText("CTEFooterServiceCallError"))}})},fetchReconLedgerData:function(){let e=this.getModel();let t=e.createKey("/xEY1xSAV_C_Recon_Ledger",{bunit:thi+
s.byId("idConsUnit").getSelectedKey()});let o=this;e.read(t,{method:"GET",success:function(e,t){var i=o.getModel("viewConfigDataModel");i.getData().reconData=e;i.refresh();o._fetchCnsldVersion()},error:function(e){if(parseInt(e.statusCode,[10])!==404){r.+
show(o.getI18nText("reconServiceCallError"))}}})},_fetchValidTaxRates:function(e){e=e?e:{};let t=this,o=this.getView(),n=o.byId("idConsUnit").getSelectedKey(),l=o.byId("idIntentionComboBox").getSelectedItem(),s=o.byId("idFiscalYearFilter").getDateValue()+
,d=this.getModel();if(!l){return}let u=e.ConsolidationUnit?e.ConsolidationUnit:n,c=e.PeriodTo?e.PeriodTo:l.getBindingContext("intentionVHModel").getObject().PeriodTo,g=e.FiscalYear?e.FiscalYear:s.getFullYear();if(!u||!c||!g){return}let T="/xEY1xSAV_C_Fet+
ch_Tax_Rates(p_toperiod='"+c+"',p_ryear='"+g+"')/Set";d.read(T,{method:"GET",filters:[new i("ConsolidationUnit","EQ",u)],success:function(e){if(e.results.length<1){a.warning(t.getI18nText("errorTaxRatesNotMaintained"))}},error:function(e){r.show(t.getI18+
nText("warningFetchingTaxRates"))}})},_fetchTiers:function(){let e=this,t=this.getView(),o=t.byId("idConsUnit").getSelectedItem().getBindingContext().getObject().Country,n=t.byId("idFiscalYearFilter").getDateValue().getFullYear(),l=t.byId("idIntentionCom+
boBox").getSelectedKey(),s=this.getModel();if(l==="PER"){l=this._getIntentionForManageTier()}if(!o||!n||!l){return}let d="/xEY1xSAV_C_TIERS";s.read(d,{method:"GET",filters:[new i("CountryKey","EQ",o),new i("FiscalYear","EQ",n),new i("Intention","EQ",l)],+
success:function(t){if(t.results.length<1){a.warning(e.getI18nText("errorTiersNotMaintained"))}},error:function(t){r.show(e.getI18nText("warningFetchingTierss"))}})},_EmptyTableCall:function(){let e=this.getView();e.byId("idPBT").getModel("PBTTableModel"+
).setData([]);e.byId("idCYTA").getModel("CYTETableModel").setData([]);e.byId("idCYTAFooter").getModel("CYTEFooterTableModel").setData([]);e.byId("idG2SA").getModel("G2STableModel").setData([]);e.byId("idG2SAFooter").getModel("G2SFooterTableModel").setDat+
a([]);e.byId("idS2TA").getModel("S2TTableModel").setData([]);e.byId("idS2TAFooter").getModel("S2TFooterTableModel").setData([]);e.byId("idTablePTA").getModel("PTATableModel").setData([]);e.byId("idPTAFooter").getModel("PTAFooterTableModel").setData([]);e+
.byId("idTableOTA").getModel("OTATableModel").setData([]);e.byId("idOTAFooter").getModel("OTAFooterTableModel").setData([]);e.byId("idTableCTE").getModel("CTETableModel").setData([]);e.byId("idCTEStatFooter").getModel("CTEFooterTableModel").setData([])},+
_fetchAllTabData:function(){let e=this.getView(),t=e.getModel("viewConfigDataModel").getData();if(!t.globalParameters||!t.globalParameters.ConsolidationChartofAccounts||!t.globalParameters.ConsolidationGroup){a.error(this.getI18nText("errorMaintainGlobal+
Parameter"));return}let o=e.byId("idConsUnit"),r=o.getSelectedKey(),l=e.byId("idCurrency"),s=l.getSelectedKey(),d=l.getSelectedItem()?l.getSelectedItem().getProperty("additionalText"):t.globalParameters.CurrencyType,u=o.getSelectedItem()?o.getSelectedIte+
m().getBindingContext().getObject().Country:t.globalParameters.Country,g=e.byId("idIntentionComboBox").getSelectedKey(),T=e.byId("idFiscalYearFilter"),h=T.getDateValue().getFullYear(),C=e.byId("idPeriodToInput"),f=parseInt(C.getValue(),[10]),I;if(e.byId(+
"idIntentionComboBox").getEnabled()===false){a.error(this.getI18nText("IntentionNotYetOpen")+h);if(c.length>0){this._EmptyTableCall()}return}let y=e.byId("idIntentionComboBox").getSelectedItem()?parseInt(e.byId("idIntentionComboBox").getSelectedItem().ge+
tBindingContext("intentionVHModel").getObject().CurrOpenPeriod,[10]):t.globalParameters.CurrOpenPeriod,b=e.byId("idIntentionComboBox").getSelectedItem()?e.byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel").getObject().sta+
tus:t.globalParameters.status,p=e.byId("idIntentionComboBox").getSelectedItem()?e.byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel").getObject().IntentDescription:t.globalParameters.IntentDescription,S=e.byId("idIntention+
ComboBox").getSelectedItem()?parseInt(e.byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel").getObject().Gjahr,[10]):t.globalParameters.FiscalYear;if(b===this.getI18nText("YetToOpen")){this.getBusyDialog().close();a.error(t+
his.getModel("i18n").getResourceBundle().getText("ThisIntentionNotYetOpen",[p,S]));a.error(p+" "+this.getI18nText("ThisIntentionNotYetOpen")+S);if(c.length>0){this._EmptyTableCall()}return}if(f>y){this.getBusyDialog().close();a.error(this.getModel("i18n"+
).getResourceBundle().getText("errorPeriodnotopen",[f,y]));if(c.length>0){this._EmptyTableCall()}return}let _=e.byId("idIntentionComboBox").getSelectedItem()?parseInt(e.byId("idIntentionComboBox").getSelectedItem().getBindingContext("intentionVHModel").g+
etObject().TaxIntention,[10]):t.globalParameters.TaxIntention,m=_>100?_:"",x=new i({filters:[new i("ConsolidationUnit",n.EQ,r),new i("ConsolidationChartofAccounts",n.EQ,t.globalParameters.ConsolidationChartofAccounts),new i("MainCurrency",n.EQ,s)],and:tr+
ue});I=x;if(g==="PER"){g=this._getIntentionForManageTier()}c=[];let M="/xEY1xSAV_C_PR_ProfitBeforeTax(p_toperiod='"+f+"',p_ryear='"+h+"',p_taxintention='"+m+"')/Set";this._serviceCallPBT(I,M);let P="/xEY1xSAV_C_PR_CYTE_Mvmnt(p_toperiod='"+f+"',p_ryear='"+
+h+"',p_taxintention='"+m+"')/Set";this._serviceCallCYTE(I,P);let V="/xEY1xSAV_C_PR_CYTE_Details(p_toperiod='"+f+"',p_ryear='"+h+"',p_taxintention='"+m+"')/Set";this._serviceCallCYTEFooter(I,V);let F="/xEY1xSAV_C_PR_G2S_Mvmnt(p_toperiod='"+f+"',p_ryear='+
"+h+"',p_taxintention='"+m+"')/Set";this._serviceCallG2S(I,F);let E="/xEY1xSAV_C_PR_G2S_Details(p_toperiod='"+f+"',p_ryear='"+h+"',p_taxintention='"+m+"')/Set";this._serviceCallG2SFooter(I,E);let w="/xEY1xSAV_C_PR_S2T_Mvmnt(p_toperiod='"+f+"',p_ryear='"++
h+"',p_taxintention='"+m+"')/Set";this._serviceCallS2T(I,w);let B="/xEY1xSAV_C_PR_S2T_Details(p_toperiod='"+f+"',p_ryear='"+h+"',p_taxintention='"+m+"')/Set";this._serviceCallS2TFooter(I,B);let A=_>12?_:"";let v="/xEY1xSAV_C_PR_PTA_Mvmnt(p_toperiod='"+f++
"',p_ryear='"+h+"',p_taxintention='"+m+"')/Set";this._serviceCallPTA(I,v);let D="/xEY1xSAV_C_PR_PTA_Details(p_toperiod='"+f+"',p_ryear='"+h+"',p_taxintention='"+m+"')/Set";this._serviceCallPTAFooter(I,D);let Y="/xEY1xSAV_C_PR_OTA_Mvmnts(p_toperiod='"+f+"+
',p_ryear='"+h+"',p_taxintention='"+m+"')/Set";this._serviceCallOTA(I,Y);let G="/xEY1xSAV_C_PR_OTA_Details(p_toperiod='"+f+"',p_ryear='"+h+"',p_taxintention='"+m+"')/Set";this._serviceCallOTAFooter(I,G);let O="/xEY1xSAV_C_PR_CTE_Details(p_cntry='"+u+"',p+
_ryear='"+h+"',p_toperiod='"+f+"',p_taxintention='"+m+"',p_currtype='"+d+"',p_intention='"+g+"')/Set";this._serviceCallCTE(O);let R="/xEY1xSAV_C_PR_CTE_Total(p_cntry='"+u+"',p_ryear='"+h+"',p_toperiod='"+f+"',p_taxintention='"+m+"',p_currtype='"+d+"',p_i+
ntention='"+g+"')/Set";this._serviceCallCTEStatutoryFooter([],R)},onPressNavtoManageTier:function(){let e=this.getView(),t=this,o=this.getView().getModel("viewConfigDataModel").getData().globalParameters,i=e.byId("idConsUnit"),n=i.getSelectedItem(),r,l,s+
,d,u=e.byId("idFiscalYearFilter"),c=u.getDateValue(),g=e.byId("idIntentionComboBox"),T=g.getSelectedKey(),h=this._getFilterData();h.ConsolidationChartofAccounts=o.ConsolidationChartofAccounts;h.ConsolidationGroup=o.ConsolidationGroup;if(T==="PER"){T=this+
._getIntentionForManageTier()}if(n){d=i.getSelectedKey();r=n.getBindingContext().getObject().Country}else{d="";r=""}if(c){l=c.getFullYear().toString()}else{l=""}if(T){s=T}else{s=""}let C={ConsolidationUnit:d,FiscalYear:l,Intention:s,Country:r};var f={cus+
tomData:h};var I=function(e){a.error(t.getI18nText("navigationError"))};this.oNavigationHandler.navigate("ManageTier","manage",C,f,I)},onSearchButtonPressed:function(e){this._fetchAllTabData();this._fetchTiers()},onPressJournalEntriesDetail:function(e){v+
ar o=this._createJournalEntriesFilterData(e);if(!o){return}var i=new t(o);this.getOwnerComponent().setModel(i,"JournalEntryData");this.oRouter.navTo("JournalEntries")},onPressPTAEntriesDetail:function(e){var o=this._createPTAEntriesFilterData(e);if(o.GLA+
ccount===this.getI18nText("BalanceCheckSumLabel")){return}var i=new t(o);this.getOwnerComponent().setModel(i,"PTAEntryConfigData");this.oRouter.navTo("PTAEntries")},onBeforeVariantSaveFilterBar:function(e){let t=this.getView(),o=t.byId("idProfitReconSmar+
tFilterBar"),i=t.byId("idConsUnit"),n=t.byId("idFiscalYearFilter"),r=t.byId("idIntentionComboBox"),a=t.byId("idCurrency"),l=t.byId("idPeriodToInput");o.setFilterData({_CUSTOM:{ConsolidationUnit:i.getSelectedKey(),FiscalYear:n.getValue(),Intention:r.getSe+
lectedKey(),CurrType:a.getSelectedKey(),PeriodTo:l.getValue(),VariantID:o.getCurrentVariantId()}})},onAfterVariantLoadFilterBar:function(e){var t=this.getView();var i=t.byId("idProfitReconSmartFilterBar");var n=t.byId("idConsUnit");var r=t.byId("idFiscal+
YearFilter");let a=t.byId("idIntentionComboBox");var l=t.byId("idCurrency");let s=this.getView().byId("idPeriodToInput");var d=i.getFilterData()["_CUSTOM"];n.setSelectedKey(d.ConsolidationUnit);r.setValue(d.FiscalYear);a.setSelectedKey(d.Intention);l.set+
SelectedKey(d.CurrType);s.setValue(o.convertStringToInt(d.PeriodTo));if(d.ConsolidationUnit){this.fetchReconLedgerData()}if(d.CurrType){l.setVisible(true);this._fetchCurrencyData(true)}if(d.ConsolidationUnit&&d.FiscalYear&&d.Intention){this._fetchValidTa+
xRates({ConsolidationUnit:d.ConsolidationUnit,PeriodTo:d.PeriodTo,FiscalYear:d.FiscalYear.getFullYear()})}let u=[d.ConsolidationUnit,d.FiscalYear.getFullYear()];this._fetchIntentionStatus(u)},onChangeDatePickerFilter:function(e){let t=e.getSource(),o=thi+
s.getModel("viewConfigDataModel").getData(),i=o.globalParameters.ConsolidationUnit;i=this.getView().byId("idConsUnit").getProperty("selectedKey");if(e.getParameter("valid")){t.setValueState("None");let e=t.getDateValue().getFullYear();e=this.getView().by+
Id("idFiscalYearFilter").getDateValue().getFullYear();let o=[i,e];this._fetchIntentionStatus(o)}else{t.setValueState("Error")}if(e.getSource().getValue()){this._fetchValidTaxRates()}},onConsUnitChange:function(e){this._fetchCurrencyData(false);this.fetch+
ReconLedgerData();if(e.getSource().getValue()){this._fetchValidTaxRates()}let t=this.getView().byId("idConsUnit").getProperty("selectedKey");let o=[t,this.getView().byId("idFiscalYearFilter").getDateValue().getFullYear()];this._fetchIntentionStatus(o)},o+
nChangeIntentionComboBox:function(e){let t=this.getView(),o=t.byId("idIntentionComboBox"),i=o.getSelectedItem();if(!i){o.setSelectedItem("");return}this._managePeriodFieldsEditability(true);if(e.getSource().getValue()){this._fetchValidTaxRates()}},onLive+
ChangePeriodTo:function(){let e=this.getView().byId("idPeriodToInput");let t=parseInt(this.getView().byId("idPeriodFromInput").getValue(),[10]);let o=parseInt(e.getValue(),[10]);e.setValueState("None");if(isNaN(o)){return}if(o<t){e.setValueState("Error")+
;e.setValueStateText(this.getI18nText("periodToLessThanPeriodFromErrorMsg"));return}else if(o>"012"){e.setValueState("Error");e.setValueStateText(this.getI18nText("periodToGreaterThanLastPeriod"));return}else{this._managePerodicIntentionStatus(o)}}})});  